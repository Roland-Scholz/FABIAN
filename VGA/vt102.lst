
ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 1





       MCS-51 Family Macro Assembler   A S E M - 5 1   V 1.3
       =====================================================



	Source File:	C:\github\FABIAN\VGA\vt102.a51
	Object File:	C:\github\FABIAN\VGA\vt102.hex
	List File:	C:\github\FABIAN\VGA\vt102.lst



 Line  I  Addr  Code            Source

    1:				;===============================================
    2:				; AT89S52 code for emulating a VT102 terminal
    3:				; 2023-24 Roland Scholz (rolandscholz@gmx.de)
    4:				; no warranties
    5:				; do whatever you want with this code
    6:				; assembled with M-IDE Studio for MCS-51
    7:				;===============================================
    8:
    9:						$NOMOD51
   10:						$INCLUDE (89S52.MCU)
   11: 1			;   AT89S52 processor definition file
   12: 1			;   =================================
   13: 1
   14: 1	N	 80	P0	DATA	080H
   15: 1	N	 81	SP	DATA	081H
   16: 1	N	 82	DP0L	DATA	082H
   17: 1	N	 83	DP0H	DATA	083H
   18: 1	N	 84	DP1L	DATA	084H
   19: 1	N	 85	DP1H	DATA	085H
   20: 1	N	 87	PCON	DATA	087H
   21: 1	N	 88	TCON	DATA	088H
   22: 1	N	 89	TMOD	DATA	089H
   23: 1	N	 8A	TL0	DATA	08AH
   24: 1	N	 8B	TL1	DATA	08BH
   25: 1	N	 8C	TH0	DATA	08CH
   26: 1	N	 8D	TH1	DATA	08DH
   27: 1	N	 8E	AUXR	DATA	08EH
   28: 1	N	 90	P1	DATA	090H
   29: 1	N	 98	SCON	DATA	098H
   30: 1	N	 99	SBUF	DATA	099H
   31: 1	N	 A0	P2	DATA	0A0H
   32: 1	N	 A2	AUXR1	DATA	0A2H
   33: 1	N	 A6	WDTRST	DATA	0A6H
   34: 1	N	 A8	IE	DATA	0A8H
   35: 1	N	 B0	P3	DATA	0B0H
   36: 1	N	 B8	IP	DATA	0B8H
   37: 1	N	 C8	T2CON	DATA	0C8H
   38: 1	N	 C9	T2MOD	DATA	0C9H
   39: 1	N	 CA	RCAP2L	DATA	0CAH
   40: 1	N	 CB	RCAP2H	DATA	0CBH
   41: 1	N	 CC	TL2	DATA	0CCH
   42: 1	N	 CD	TH2	DATA	0CDH
   43: 1	N	 D0	PSW	DATA	0D0H

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 2



 Line  I  Addr  Code            Source

   44: 1	N	 E0	ACC	DATA	0E0H
   45: 1	N	 F0	B	DATA	0F0H
   46: 1
   47: 1	N	 88	IT0	BIT	088H
   48: 1	N	 89	IE0	BIT	089H
   49: 1	N	 8A	IT1	BIT	08AH
   50: 1	N	 8B	IE1	BIT	08BH
   51: 1	N	 8C	TR0	BIT	08CH
   52: 1	N	 8D	TF0	BIT	08DH
   53: 1	N	 8E	TR1	BIT	08EH
   54: 1	N	 8F	TF1	BIT	08FH
   55: 1	N	 90	T2	BIT	090H
   56: 1	N	 91	T2EX	BIT	091H
   57: 1	N	 95	MOSI	BIT	095H
   58: 1	N	 96	MISO	BIT	096H
   59: 1	N	 97	SCK	BIT	097H
   60: 1	N	 98	RI	BIT	098H
   61: 1	N	 99	TI	BIT	099H
   62: 1	N	 9A	RB8	BIT	09AH
   63: 1	N	 9B	TB8	BIT	09BH
   64: 1	N	 9C	REN	BIT	09CH
   65: 1	N	 9D	SM2	BIT	09DH
   66: 1	N	 9E	SM1	BIT	09EH
   67: 1	N	 9F	SM0	BIT	09FH
   68: 1	N	 A8	EX0	BIT	0A8H
   69: 1	N	 A9	ET0	BIT	0A9H
   70: 1	N	 AA	EX1	BIT	0AAH
   71: 1	N	 AB	ET1	BIT	0ABH
   72: 1	N	 AC	ES	BIT	0ACH
   73: 1	N	 AD	ET2	BIT	0ADH
   74: 1	N	 AF	EA	BIT	0AFH
   75: 1	N	 B0	RXD	BIT	0B0H
   76: 1	N	 B1	TXD	BIT	0B1H
   77: 1	N	 B2	INT0	BIT	0B2H
   78: 1	N	 B3	INT1	BIT	0B3H
   79: 1	N	 B4	T0	BIT	0B4H
   80: 1	N	 B5	T1	BIT	0B5H
   81: 1	N	 B6	WR	BIT	0B6H
   82: 1	N	 B7	RD	BIT	0B7H
   83: 1	N	 B8	PX0	BIT	0B8H
   84: 1	N	 B9	PT0	BIT	0B9H
   85: 1	N	 BA	PX1	BIT	0BAH
   86: 1	N	 BB	PT1	BIT	0BBH
   87: 1	N	 BC	PS	BIT	0BCH
   88: 1	N	 BD	PT2	BIT	0BDH
   89: 1	N	 C8	CPRL2	BIT	0C8H
   90: 1	N	 C9	CT2	BIT	0C9H
   91: 1	N	 CA	TR2	BIT	0CAH
   92: 1	N	 CB	EXEN2	BIT	0CBH
   93: 1	N	 CC	TCLK	BIT	0CCH
   94: 1	N	 CD	RCLK	BIT	0CDH
   95: 1	N	 CE	EXF2	BIT	0CEH
   96: 1	N	 CF	TF2	BIT	0CFH
   97: 1	N	 D0	P	BIT	0D0H
   98: 1	N	 D2	OV	BIT	0D2H
   99: 1	N	 D3	RS0	BIT	0D3H

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 3



 Line  I  Addr  Code            Source

  100: 1	N	 D4	RS1	BIT	0D4H
  101: 1	N	 D5	F0	BIT	0D5H
  102: 1	N	 D6	AC	BIT	0D6H
  103: 1	N	 D7	CY	BIT	0D7H
  104: 1
  105: 1	N      0000	RESET	CODE	000H
  106: 1	N      0003	EXTI0	CODE	003H
  107: 1	N      000B	TIMER0	CODE	00BH
  108: 1	N      0013	EXTI1	CODE	013H
  109: 1	N      001B	TIMER1	CODE	01BH
  110: 1	N      0023	SINT	CODE	023H
  111: 1	N      002B	TIMER2	CODE	02BH
  112:
  113:		N      0001	HARDWARE	equ	1
  114:
  115:		N      0080	stack		equ	80h
  116:		D      0083	dph		equ	DP0H
  117:		D      0082	dpl		equ	DP0L
  118:
  119:		N      0050	WIDTH		equ	80
  120:		N      0018	HEIGHT		equ	24
  121:
  122:		N      0000	ST_IDLE		equ	0
  123:		N      0002	ST_ESC		equ	2
  124:		N      0004	ST_CSI		equ	4
  125:		N      0006	ST_ESC_Q	equ	6
  126:		N      0008	ST_ESC_HASH	equ	8
  127:		N      000A	ST_CMD_ARG	equ	10
  128:		N      000C	ST_ESC_LBRACK	equ	12
  129:		N      000E	ST_CSI_Q	equ	14
  130:		N      0010	ST_ESC_RBRACK	equ	16
  131:
  132:		N      000A	C_TIME		equ	10
  133:
  134:		N      0007	C_BELL		equ	7
  135:		N      0008	C_BACKSP	equ	8
  136:		N      0009	C_TAB		equ	9
  137:		N      000A	C_NEWLINE	equ	10
  138:		N      000B	C_VT		equ	11
  139:		N      000C	C_FF		equ	12
  140:		N      000D	C_CR		equ	13
  141:		N      000E	C_SO		equ	14
  142:		N      000F	C_SI		equ	15
  143:		N      0011	C_XON		equ	17
  144:		N      0013	C_XOFF		equ	19
  145:		N      001B	C_ESC		equ	27
  146:		N      007F	C_DEL		equ	07fh
  147:
  148:		N      001C	CCHM		equ	01Ch	;move cursor home
  149:		N      001D	CCBT		equ	01Dh	;move cursor to bottom
  150:		N      001E	CCLM		equ	01Eh	;move cursor to left margin
  151:		N      001F	CCRM		equ	01Fh	;move cursor to right margin
  152:
  153:								;SUPERF equ 0
  154:
  155:		N      0001	CLS		equ	001h	;clear screen

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 4



 Line  I  Addr  Code            Source

  156:		N      0008	BACK		equ	008h	;backspace
  157:		N      0009	TABU		equ	009h	;tabulator
  158:		N      000A	LF		equ	00Ah	;$9B	;end of line (RETURN)
  159:		N      001B	ESC		equ	01Bh	;escape key
  160:		N      001C	CCUP		equ	01Ch	;cursor up
  161:		N      001D	CCDN		equ	01Dh	;cursor down
  162:		N      001E	CCLF		equ	01Eh	;cursor left
  163:		N      001F	CCRT		equ	01Fh	;cursor right
  164:		N      0020	CSPACE		equ	020h	;space
  165:		N      009D	CILN		equ	09Dh	;insert line
  166:		N      00FE	CDCH		equ	0FEh	;delete character
  167:		N      00FF	CICH		equ	0FFh	;insert character
  168:
  169:		N      0080	F1		equ	080h	;key code for F1
  170:		N      0081	F2		equ	081h	;key code for F2
  171:		N      0082	F3		equ	082h	;key code for F3
  172:		N      0083	F4		equ	083h	;key code for F4
  173:		N      0084	F5		equ	084h	;key code for F5
  174:		N      0085	F6		equ	085h	;key code for F6
  175:		N      0086	F7		equ	086h	;key code for F7
  176:		N      0087	F8		equ	087h	;key code for F8
  177:		N      0088	F9		equ	088h	;key code for F9
  178:		N      0089	F10		equ	089h	;key code for F10
  179:		N      008A	F11		equ	08ah	;key code for F11
  180:		N      008B	F12		equ	08bh	;key code for F12
  181:
  182:				;	special key scan-codes
  183:		N      0011	ALTGR		equ	011h	;extended!
  184:		N      0011	ALR		equ	011h
  185:		N      0012	CLSHIFT		equ	012h
  186:		N      0014	CLSTRG		equ	014h
  187:		N      0059	CRSHIFT		equ	059h
  188:		N      0058	CCAPS		equ	058h
  189:
  190:		N      00E0	EXTENDED	equ	0e0h
  191:		N      00F0	BREAK		equ	0f0h
  192:
  193:						;	0	;Error (ignored)
  194:		N      0001	DECCKM		equ	1	;Cursor key
  195:		N      0002	DECANM		equ	2	;ANSI/VT52
  196:		N      0003	DECCOLM		equ	3	;Column
  197:		N      0004	DECSCLM		equ	4	;Scrolling
  198:		N      0005	DECSCNM		equ	5	;Screen
  199:		N      0006	DECOM		equ	6	;Origin
  200:		N      0007	DECAWM		equ	7	;Auto wrap
  201:		N      0008	DECARM		equ	8	;Auto repeating
  202:		N      0009	DECINLM		equ	9	;Interlace
  203:		N      0004	IRM		equ	4	;Insert Replace mode
  204:		N      0014	LNM		equ	20	;new line mode
  205:
  206:
  207:		N      0020	VARS		equ	020h
  208:
  209:		N      0020	flags		equ	020h
  210:		B      0000	special		equ	flags.0
  211:		B      0001	lastchar	equ	flags.1

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 5



 Line  I  Addr  Code            Source

  212:		B      0002	lchartmp	equ	flags.2
  213:		B      0003	inverse		equ	flags.3
  214:		B      0004	xonoff		equ	flags.4
  215:		B      0005	serbusy		equ	flags.5
  216:
  217:		N      0021	flags1		equ	021h
  218:		B      0008	keyavail	equ	flags1.0
  219:		B      0009	keyrxextended	equ	flags1.1
  220:		B      000A	keyrxbreak	equ	flags1.2
  221:		B      000B	keyrxshift	equ	flags1.3
  222:		B      000C	keyrxaltgr	equ	flags1.4
  223:		B      000D	keyrxstrg	equ	flags1.5
  224:
  225:		N      0022	flags2		equ	022h
  226:		B      0010	wrap		equ	flags2.0
  227:		B      0011	origin		equ	flags2.1
  228:		B      0012	newlinemode	equ	flags2.2
  229:		B      0013	insert		equ	flags2.3
  230:		B      0014	baudflag	equ	flags2.4
  231:
  232:		N      0023	retstate	equ	023h
  233:		N      0025	nargs		equ	025h
  234:		N      0026	arg0		equ	026h
  235:		N      0027	arg1		equ	027h
  236:		N      0028	arg2		equ	028h
  237:		N      0029	arg3		equ	029h
  238:		N      002A	dummy		equ	02ah
  239:		N      002B	scursorx	equ	02bh
  240:		N      002C	scursory	equ	02ch
  241:		N      002D	color		equ	02dh
  242:		N      002E	cursorpos	equ	02eh
  243:		N      002F	cursorpos1	equ	02fh
  244:		N      0030	cursorsave	equ	030h
  245:		N      0031	top		equ	031h
  246:		N      0032	bottom		equ	032h
  247:		N      0033	state		equ	033h
  248:		N      0034	serstart	equ	034h
  249:		N      0035	serend		equ	035h
  250:		N      0036	sercount	equ	036h
  251:		N      0037	cursorx		equ	037h
  252:		N      0038	cursory		equ	038h
  253:		N      0039	t0cnt		equ	039h
  254:		N      003A	keyrxcnt	equ	03ah
  255:		N      003B	keyrxval	equ	03bh
  256:		N      003C	oldstatus	equ	03ch
  257:		N      003D	baudidx		equ	03dh
  258:
  259:		N      0040	serbuf		equ	040h
  260:
  261:		N      0050	tabutab		equ	050h	;10-bytes tabulator
  262:
  263:		N      005A	free0		equ	05ah
  264:		N      005B	free1		equ	05bh
  265:		N      005C	free2		equ	05ch
  266:		N      005D	free3		equ	05dh
  267:		N      005E	free4		equ	05eh

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 6



 Line  I  Addr  Code            Source

  268:		N      005F	free5		equ	05fh
  269:
  270:		N      0000			org	0
  271:
  272:		N      0000		IF HARDWARE = 0
  273:						ljmp	start
  274:					ENDIF
  275:		N      2003			org	2003h
  276:	  2003	01 79				ajmp	exint0
  277:
  278:		N      200B			org	200bh
  279:	  200B	01 5C				ajmp	timer0int
  280:
  281:		N      2023			org	02023h
  282:
  283:	  2023	C0 D0		serint:		push	psw
  284:	  2025	C0 E0				push	acc
  285:	  2027	C0 00				push	0
  286:
  287:	  2029	30 98 22			jnb	ri, serintti	;ri active?
  288:	  202C	C2 98				clr	ri		;yes
  289:
  290:	  202E	A8 35				mov	r0, serend
  291:	  2030	08				inc	r0
  292:	  2031	B8 50 00			cjne	r0, #serbuf+16, $+3
  293:	  2034	40 02				jc	serint1
  294:	  2036	78 40				mov	r0, #serbuf
  295:	  2038	A6 99		serint1:	mov	@r0, sbuf
  296:	  203A	88 35				mov	serend, r0
  297:	  203C	05 36				inc	sercount
  298:	  203E	E5 36				mov	a, sercount
  299:	  2040	B4 08 0B			cjne	a, #8, serintti
  300:	  2043	75 99 13			mov	SBUF, #C_XOFF
  301:	  2046	D2 04				setb	xonoff
  302:	  2048	78 50				mov	r0, #80
  303:	  204A	D8 FE				djnz	r0, $
  304:	  204C	C2 99				clr	ti
  305:
  306:	  204E	30 99 04	serintti:	jnb 	ti, serintex
  307:	  2051	C2 99				clr	ti
  308:	  2053	C2 05				clr	serbusy
  309:
  310:	  2055	D0 00		serintex:	pop	0
  311:	  2057	D0 E0				pop	acc
  312:	  2059	D0 D0				pop	psw
  313:	  205B	32				reti
  314:
  315:
  316:
  317:				;===============================================
  318:				; Timer 0 Interrupt 0
  319:				;===============================================
  320:	  205C	D5 39 19	timer0int:	djnz	t0cnt, timer0int_ex
  321:	  205F	75 39 0A			mov	t0cnt, #C_TIME
  322:	  2062	C0 D0				push	psw
  323:	  2064	C0 E0				push	acc

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 7



 Line  I  Addr  Code            Source

  324:	  2066	C0 00				push	ar0
  325:
  326:	  2068	85 2F A0			mov	p2, cursorpos+1
  327:	  206B	A8 2E				mov	r0, cursorpos
  328:	  206D	E2				movx	a, @r0
  329:	  206E	E5 90				mov	a, p1
  330:	  2070	F4				cpl	a
  331:	  2071	F2				movx	@r0, a
  332:
  333:	  2072	D0 00				pop	ar0
  334:	  2074	D0 E0				pop	acc
  335:	  2076	D0 D0				pop	psw
  336:	  2078	32		timer0int_ex:	reti
  337:
  338:
  339:
  340:				;===============================================
  341:				; External Interrupt 0 (falling edge)
  342:				; collect bits sent from keyboard
  343:				; lsb first
  344:				; 8E1, start-bit (low), 8 data-bits, even-parity, stop-bit (high)
  345:				;===============================================
  346:	  2079	C0 D0		exint0:		push	psw
  347:	  207B	C0 E0				push	acc
  348:
  349:	  207D	E5 3A				mov	a, keyrxcnt
  350:	  207F	70 03				jnz	exint0b			;first bit?
  351:	  2081	20 B4 1D			jb	t0, exint0ex		;not zero, no startbit
  352:
  353:	  2084	04		exint0b:	inc	a
  354:	  2085	F5 3A				mov	keyrxcnt, a
  355:	  2087	B4 0A 00			cjne	a, #10, $+3
  356:	  208A	40 0E				jc	exint0a			;< 10, collect bits
  357:	  208C	B4 0B 12			cjne	a, #11, exint0ex	;skip parity-bit
  358:	  208F	75 3A 00			mov	keyrxcnt, #0
  359:	  2092	30 B4 0C			jnb	t0, exint0ex		;no stop bit?
  360:	  2095	12 29 AE			call	keydecode
  361:	  2098	80 07				sjmp 	exint0ex
  362:
  363:	  209A	E5 3B		exint0a:	mov	a, keyrxval
  364:	  209C	A2 B4				mov	c, t0
  365:	  209E	13				rrc	a
  366:	  209F	F5 3B				mov	keyrxval, a
  367:
  368:	  20A1	D0 E0		exint0ex:	pop	acc
  369:	  20A3	D0 D0				pop	psw
  370:	  20A5	32				reti
  371:
  372:
  373:
  374:		N      2100	LOCAT		equ	02100h
  375:
  376:		N      2100			org	LOCAT
  377:
  378:		N      2100			ORG    LOCAT
  379:	  2100	A5 E5 E0 A5			DB     0A5H,0E5H,0E0H,0A5H	;SIGNITURE BYTES

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 8



 Line  I  Addr  Code            Source

  380:	  2104	23 00 00 00			DB     35,0,0,0			;ID (35=PROG), id (253=startup)
  381:	  2108	00 00 00 00			DB     0,0,0,0			;PROMPT CODE VECTOR
  382:	  210C	00 00 00 00			DB     0,0,0,0			;RESERVED
  383:	  2110	00 00 00 00			DB     0,0,0,0			;RESERVED
  384:	  2114	00 00 00 00			DB     0,0,0,0			;RESERVED
  385:	  2118	00 00 00 00			DB     0,0,0,0			;USER DEFINED
  386:	  211C	FF FF FF FF			DB     255,255,255,255		;LENGTH AND CHECKSUM (255=UNUSED)
  387:	  2120	56 54 31 30			DB     "VT100",0		;MAX 31 CHARACTERS, PLUS THE ZERO
	  2124	30 00
  388:
  389:		N      2140			ORG    LOCAT+64			;EXECUTABLE CODE BEGINS HERE
  390:
  391:	  2140			start:
  392:	  2140	75 81 80			mov	sp, #stack		;set stack
  393:										;1  1  0  1	0    1    1   1
  394:	  2143	75 B0 D7			mov	p3, #0d7h		;RD WR T1 T0	INT1 INT0 TXD RXD
  395:				;		clr	T0
  396:				;		clr	T1			;E 6845 = low
  397:				;		clr	INT0			;charset 0
  398:				;		clr	INT1			;screen 0
  399:	  2146	E4				clr	a
  400:	  2147	F5 A2				mov	AUXR1, a
  401:	  2149	F5 A8				mov	ie, a
  402:
  403:
  404:				;		setb	PS			;make PS high priority
  405:										;enbale all, serial, timer0, extint0
  406:	  214B	75 A8 93			mov	ie, #093h		;ea - ET2 ES  ET1 EX1 ET0 EX0
  407:	  214E	D2 88				setb	it0			;set int0 to falling edge
  408:
  409:	  2150	F1 0E				acall	term_reset
  410:
  411:	  2152	74 11				mov	a, #C_XON
  412:	  2154	12 29 40			call	cout
  413:
  414:	  2157	12 28 A2	init:		call	init6845
  415:	  215A	12 28 ED			call	copyFont
  416:	  215D	12 29 06			call	testScreen
  417:
  418:	  2160	90 80 00			mov	dptr, #8000h
  419:	  2163	E0				movx	a, @dptr
  420:	  2164	E5 90				mov	a, p1
  421:	  2166	14				dec	a
  422:	  2167	60 06				jz	init_loop
  423:	  2169	90 00 00			mov	dptr, #0h
  424:	  216C	E0				movx	a, @dptr
  425:	  216D	80 E8				sjmp	init
  426:
  427:	  216F	12 29 50	init_loop:	call	cin
  428:	  2172	B4 78 02			cjne	a, #'x', init_1
  429:	  2175	80 0B				sjmp	init_2
  430:
  431:	  2177	B4 79 F5	init_1:		cjne	a, #'y', init_loop
  432:
  433:	  217A	12 29 50	loop_test:	call	cin
  434:	  217D	12 29 40			call	cout

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 9



 Line  I  Addr  Code            Source

  435:	  2180	80 F8				sjmp	loop_test
  436:
  437:
  438:	  2182	D2 8C		init_2:		setb	tr0				;start timer0
  439:	  2184	F1 0E				acall	term_reset
  440:
  441:				;		mov	dptr, #msg1
  442:				;		call	print
  443:
  444:	  2186	30 08 31	main_loop:	jnb	keyavail, main_serin		;key available?
  445:	  2189	C2 08				clr	keyavail			;clear key available
  446:	  218B	E5 3B				mov	a, keyrxval
  447:	  218D	B4 84 02			cjne	a, #F5, main_F6			;F5 ?
  448:	  2190	21 82				ajmp	init_2				;reset terminal
  449:	  2192	B4 85 17	main_F6:	cjne	a, #F6, main_cout		;F6 ?
  450:	  2195	A8 3D				mov	r0, baudidx			;switch baud
  451:	  2197	08				inc	r0
  452:	  2198	B8 05 02			cjne	r0, #5, main_F6a
  453:	  219B	78 00				mov	r0, #0
  454:	  219D	88 3D		main_F6a:	mov	baudidx, r0
  455:	  219F	12 2B 97			call	getbaud
  456:	  21A2	C2 8E				clr	tr1
  457:	  21A4	F5 8D				mov	TH1, a
  458:	  21A6	F5 8C				mov	TH0, a
  459:	  21A8	D2 8E				setb	tr1
  460:	  21AA	80 24				sjmp	main_status
  461:
  462:	  21AC	12 29 40	main_cout:	call	cout				;send out over serial
  463:	  21AF	B4 0D 08			cjne	a, #C_CR, main_serin		;CR sent?
  464:	  21B2	30 12 05			jnb	newlinemode, main_serin
  465:	  21B5	74 0A				mov	a, #C_NEWLINE			;send LF, too
  466:	  21B7	12 29 40			call	cout
  467:
  468:	  21BA	E5 34		main_serin:	mov	a, serstart			;serin available?
  469:	  21BC	B5 35 02			cjne	a, serend, loop_cin
  470:	  21BF	80 C5				sjmp	main_loop			;no serin available
  471:
  472:	  21C1	12 29 50	loop_cin:	call	cin				;read from serial
  473:	  21C4	12 21 D5			call	ansiout				;output to terminal's CRT
  474:
  475:	  21C7	E5 22				mov	a, flags2			;have flags changed?
  476:	  21C9	65 3C				xrl	a, oldstatus
  477:	  21CB	60 B9				jz	main_loop			;no
  478:	  21CD	85 22 3C			mov	oldstatus, flags2
  479:	  21D0	12 2B B6	main_status:	call	prtstatus			;print status-line
  480:	  21D3	80 B1				sjmp	main_loop
  481:
  482:
  483:				;===============================================
  484:				; ansiout: dispatch according to state
  485:				;===============================================
  486:	  21D5	FF		ansiout:	mov	r7, a			;save acc in r7
  487:
  488:	  21D6	E5 33				mov	a, state
  489:	  21D8	60 20				jz	do_idle			;speed up
  490:	  21DA	24 0C				add	a, #ansi_tab-ansiout1+1	;fetch low-byte

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 10



 Line  I  Addr  Code            Source

  491:	  21DC	83				movc	a, @a+pc
  492:	  21DD	C0 E0		ansiout1:	push	acc			;2
  493:	  21DF	E5 33				mov	a, state		;2
  494:	  21E1	24 04				add	a, #ansi_tab-ansiout2	;2
  495:	  21E3	83				movc	a, @a+pc		;1 fetch, high-byte
  496:	  21E4	C0 E0		ansiout2:	push	acc			;2
  497:	  21E6	EF				mov	a, r7			;1
  498:	  21E7	22				ret				;1
  499:
  500:	  21E8	21 FA 22 F3	ansi_tab:	dw	do_idle, do_esc, do_csi, do_esc_q, do_esc_hash, do_cmd_arg, do_esc_lbrack, d
	  21EC	23 53 26 49	o_csi_q
	  21F0	26 4D 26 65
	  21F4	26 59 26 00
  501:	  21F8	26 59				dw	do_esc_rbrack
  502:
  503:
  504:				;===============================================
  505:				; state IDLE
  506:				;===============================================
  507:	  21FA	A2 01		do_idle:	mov	C, lastchar
  508:	  21FC	92 02				mov	lchartmp, C
  509:	  21FE	C2 01				clr	lastchar
  510:
  511:	  2200	E4				clr	a
  512:	  2201	F8				mov	r0, a				;x-offset
  513:	  2202	F9				mov	r1, a				;y-offset
  514:	  2203	FA				mov	r2, a				;scrolling, 0 = no
  515:
  516:	  2204	BF 7F 03	do_idle_del:	cjne	r7, #C_DEL, do_idle_pre
  517:	  2207	18				dec	r0
  518:	  2208	C1 A2				ajmp	ansi_move
  519:
  520:	  220A	BF 20 00	do_idle_pre:	cjne	r7, #32, $+3			;speed up
  521:	  220D	50 62				jnc	draw_char
  522:
  523:	  220F	BF 07 01			cjne	r7, #C_BELL, do_idle_bs
  524:	  2212	22				ret					;no bell yet
  525:
  526:	  2213	BF 08 03	do_idle_bs:	cjne	r7, #C_BACKSP, do_idle_tab	;backspace
  527:	  2216	18				dec	r0
  528:	  2217	C1 A2				ajmp	ansi_move
  529:
  530:	  2219	BF 09 21	do_idle_tab:	cjne	r7, #C_TAB, do_idle_nl		;tabulator
  531:	  221C	F1 53				acall	tab_set_r0_r1
  532:	  221E	E4		do_idle_tab3:	clr	a
  533:	  221F	09				inc	r1
  534:	  2220	05 37				inc	cursorx
  535:	  2222	B9 08 0E			cjne	r1, #8, do_idle_tab1
  536:	  2225	08				inc	r0
  537:	  2226	F9				mov	r1, a
  538:	  2227	B8 5A 09			cjne	r0, #tabutab+10, do_idle_tab1
  539:	  222A	F8				mov	r0, a
  540:	  222B	F5 37				mov	cursorx, a
  541:	  222D	09				inc	r1
  542:	  222E	0A				inc	r2				;scroll on
  543:	  222F	D1 A2				acall	ansi_move

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 11



 Line  I  Addr  Code            Source

  544:	  2231	F1 53				acall	tab_set_r0_r1
  545:	  2233	F1 63		do_idle_tab1:	acall	getbit
  546:	  2235	56				anl	a, @r0
  547:	  2236	60 E6				jz	do_idle_tab3			;bit not found
  548:	  2238	E4		do_idle_tab2:	clr	a
  549:	  2239	F8				mov	r0, a
  550:	  223A	F9				mov	r1, a
  551:	  223B	C1 A2				ajmp	ansi_move
  552:
  553:
  554:	  223D	BF 0A 07	do_idle_nl:	cjne	r7, #C_NEWLINE, do_idle_cr
  555:	  2240	75 37 00	do_newline:	mov	cursorx, #0
  556:	  2243	09				inc	r1
  557:	  2244	0A				inc	r2
  558:	  2245	C1 A2				ajmp	ansi_move
  559:
  560:	  2247	BF 0D 09	do_idle_cr:	cjne	r7, #C_CR, do_idle_esc
  561:	  224A	75 37 00	do_cr:		mov	cursorx, #0
  562:	  224D	D1 A2				acall	ansi_move
  563:	  224F	20 12 EE			jb	newlinemode, do_newline		;per default, CR
  564:	  2252	22				ret
  565:
  566:	  2253	BF 1B 05	do_idle_esc:	cjne	r7, #C_ESC, do_idle_so
  567:	  2256	75 33 02			mov	state, #ST_ESC
  568:	  2259	E1 6F				ajmp	clearargs
  569:
  570:	  225B	BF 0E 03	do_idle_so:	cjne	r7, #C_SO, do_idle_si
  571:	  225E	D2 00				setb	special
  572:	  2260	22				ret
  573:
  574:	  2261	BF 0F 03	do_idle_si:	cjne	r7, #C_SI, do_idle_vt
  575:	  2264	C2 00				clr	special
  576:	  2266	22				ret
  577:
  578:	  2267	BF 0B 02	do_idle_vt:	cjne	r7, #C_VT, do_idle_ff
  579:	  226A	80 D4				sjmp	do_newline
  580:
  581:	  226C	BF 0C 02	do_idle_ff:	cjne	r7, #C_FF, do_idle_end
  582:	  226F	80 CF				sjmp	do_newline
  583:
  584:	  2271			do_idle_end:	;ajmp	draw_char
  585:
  586:
  587:
  588:	  2271	C0 07		draw_char:	push	ar7				;save r7 (received byte)
  589:	  2273	12 28 6B			call	cursor_off			;reset + disable cursor
  590:
  591:	  2276	0A				inc	r2				;with scroll
  592:	  2277	30 02 05			jnb	lchartmp, char_out		;last char in line?
  593:	  227A	30 10 02			jnb	wrap, char_out			;wrap turned on?
  594:	  227D	51 40				acall	do_newline
  595:
  596:				;===============================================
  597:				; draws a char in ACC at cursor position
  598:				;===============================================
  599:	  227F	12 28 8E	char_out:	call	comp_dptr

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 12



 Line  I  Addr  Code            Source

  600:
  601:	  2282	D0 01				pop	ar1
  602:
  603:	  2284	30 00 0E			jnb	special, char_out_3	;special not set?
  604:	  2287	B9 60 00			cjne	r1, #060h, $+3
  605:	  228A	40 09				jc	char_out_3		;<60h, do nothing
  606:	  228C	B9 7F 00			cjne	r1, #07fh, $+3
  607:	  228F	50 04				jnc	char_out_3		;>=7fh, do nothing
  608:	  2291	E9				mov	a, r1
  609:	  2292	94 5E				subb	a, #5eh			;carry set! subtract 5fh
  610:	  2294	F9				mov	r1, a
  611:	  2295	30 13 3D	char_out_3:	jnb	insert, char_out_4	;insert mode?
  612:
  613:	  2298	C3				clr	c
  614:	  2299	74 4F				mov	a, #WIDTH-1
  615:	  229B	95 37				subb	a, cursorx
  616:	  229D	33				rlc	a			;* 2
  617:	  229E	60 35				jz	char_out_4
  618:	  22A0	F8				mov	r0, a			;R0: number of chars to copy in
  619:	  22A1	04				inc	a
  620:
  621:	  22A2	25 84				add	a, dp1l			;add r0, to dptr1 (destination)
  622:	  22A4	F5 84				mov	dp1l, a
  623:	  22A6	E5 85				mov	a, dp1h
  624:	  22A8	34 00				addc	a, #0
  625:	  22AA	F5 85				mov	dp1h, a
  626:
  627:	  22AC	E5 84				mov	a, dp1l			;dptr0 = dptr1 - 2 (source)
  628:	  22AE	94 02				subb	a, #2
  629:	  22B0	F5 82				mov	dp0l, a
  630:	  22B2	E5 85				mov	a, dp1h
  631:	  22B4	94 00				subb	a, #0
  632:	  22B6	F5 83				mov	dp0h, a
  633:
  634:
  635:
  636:
  637:	  22B8	E0		char_out_2:	movx	a, @dptr		;copy r0 bytes from right to left
  638:	  22B9	05 A2				inc	auxr1
  639:	  22BB	E5 90				mov	a, p1
  640:	  22BD	F0				movx	@dptr, a
  641:	  22BE	05 A2				inc	auxr1
  642:	  22C0	E5 82				mov	a, dp0l
  643:	  22C2	70 02				jnz	char_out_2a
  644:	  22C4	15 83				dec	dp0h
  645:	  22C6	15 82		char_out_2a:	dec	dp0l
  646:	  22C8	E5 84				mov	a, dp1l
  647:	  22CA	70 02				jnz	char_out_2b
  648:	  22CC	15 85				dec	dp1h
  649:	  22CE	15 84		char_out_2b:	dec	dp1l
  650:	  22D0	D8 E6				djnz	r0, char_out_2
  651:	  22D2	12 28 8E			call	comp_dptr
  652:
  653:	  22D5	E9		char_out_4:	mov	a, r1
  654:	  22D6	05 A2				inc	auxr1
  655:	  22D8	F0				movx	@dptr, a

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 13



 Line  I  Addr  Code            Source

  656:	  22D9	A3				inc	dptr
  657:	  22DA	E5 2D				mov	a, color
  658:	  22DC	30 03 01			jnb	inverse, char_out_1
  659:	  22DF	C4				swap	a
  660:	  22E0	F0		char_out_1:	movx	@dptr, a
  661:	  22E1	05 A2				inc	auxr1
  662:
  663:	  22E3	E5 37				mov	a, cursorx
  664:	  22E5	B4 4F 02			cjne	a, #WIDTH-1, draw_char_1
  665:	  22E8	D2 01				setb	lastchar
  666:
  667:	  22EA	78 01		draw_char_1:	mov	r0, #1
  668:	  22EC	79 00				mov	r1, #0
  669:	  22EE	12 28 4B			call	draw_cursor
  670:	  22F1	C1 A2				ajmp	ansi_move
  671:
  672:				;===============================================
  673:				; state ESC
  674:				;===============================================
  675:	  22F3	75 33 00	do_esc:		mov	state, #ST_IDLE
  676:	  22F6	B4 1B 03			cjne	a, #C_ESC, do_esc_csi
  677:	  22F9	02 00 00			jmp	0h
  678:
  679:	  22FC	B4 5B 04	do_esc_csi:	cjne	a, #'[', do_esc_7	;switch to CSI state
  680:	  22FF	75 33 04			mov	state, #ST_CSI
  681:	  2302	22				ret
  682:
  683:	  2303	B4 37 07	do_esc_7:	cjne	a, #'7', do_esc_8	;save cursor
  684:	  2306	85 37 2B			mov	scursorx, cursorx
  685:	  2309	85 38 2C			mov	scursory, cursory
  686:	  230C	22				ret
  687:
  688:	  230D	B4 38 09	do_esc_8:	cjne	a, #'8', do_esc_D	;restore cursor
  689:	  2310	85 2B 37			mov	cursorx, scursorx
  690:	  2313	85 2C 38			mov	cursory, scursory
  691:	  2316	02 28 48			jmp	move_cursor
  692:
  693:	  2319	B4 44 05	do_esc_D:	cjne	a, #'D', do_esc_M	;move cursor down and scroll
  694:	  231C	0A				inc	r2			;with scrolling
  695:	  231D	74 42				mov	a, #'B'
  696:	  231F	61 60				ajmp	do_csi_keys		;do cursor down
  697:
  698:	  2321	B4 4D 05	do_esc_M:	cjne	a, #'M', do_esc_ha	;move cursor up and scroll
  699:	  2324	0A				inc	r2			;with scrolling
  700:	  2325	74 41				mov	a, #'A'
  701:	  2327	61 60				ajmp	do_csi_keys		;do cursor up
  702:
  703:	  2329	B4 23 04	do_esc_ha:	cjne	a, #'#', do_esc_lbr
  704:	  232C	75 33 08			mov	state, #ST_ESC_HASH
  705:	  232F	22				ret
  706:
  707:	  2330	B4 28 04	do_esc_lbr:	cjne	a, #'(', do_esc_rbr
  708:	  2333	75 33 0C			mov	state, #ST_ESC_LBRACK
  709:	  2336	22				ret
  710:
  711:	  2337	B4 29 04	do_esc_rbr:	cjne	a, #')', do_esc_c

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 14



 Line  I  Addr  Code            Source

  712:	  233A	75 33 10			mov	state, #ST_ESC_RBRACK
  713:	  233D	22				ret
  714:
  715:	  233E	B4 63 02	do_esc_c:	cjne	a, #'c', do_esc_H
  716:	  2341	E1 0E				ajmp	term_reset
  717:
  718:	  2343	B4 48 07	do_esc_H:	cjne	a, #'H', do_esc_Z
  719:	  2346	F1 53				acall	tab_set_r0_r1
  720:	  2348	F1 63				acall	getbit
  721:	  234A	46				orl	a, @r0
  722:	  234B	F6				mov	@r0, a
  723:	  234C	22				ret
  724:
  725:	  234D	B4 5A 02	do_esc_Z:	cjne	a, #'Z', do_esc_ex
  726:	  2350	81 72				ajmp	do_csi_cc2
  727:
  728:	  2352	22		do_esc_ex:	ret
  729:
  730:				;===============================================
  731:				; state CSI
  732:				;===============================================
  733:	  2353			do_csi:
  734:	  2353	D1 F8				acall	isparm			;is parameter?
  735:	  2355	50 09				jnc	do_csi_keys		;no
  736:	  2357	85 33 23			mov	retstate, state
  737:	  235A	75 33 0A			mov	state, #ST_CMD_ARG
  738:	  235D	02 26 65			jmp	do_cmd_arg
  739:
  740:	  2360	78 00		do_csi_keys:	mov	r0, #0			;x (column)
  741:	  2362	79 00				mov	r1, #0			;y (row
  742:	  2364	75 33 00			mov	state, #ST_IDLE
  743:
  744:	  2367	B4 41 09			cjne	a, #'A', do_csi_B	;cursor up
  745:	  236A	D1 8E				acall	args_gr_zero
  746:	  236C	E5 26				mov	a, arg0
  747:	  236E	F4				cpl	a
  748:	  236F	04				inc	a
  749:	  2370	F9				mov	r1, a
  750:	  2371	C1 A2				ajmp	ansi_move
  751:
  752:
  753:	  2373	B4 42 06	do_csi_B: 	cjne	a, #'B', do_csi_C	;cursor down
  754:	  2376	D1 8E				acall	args_gr_zero
  755:	  2378	A9 26				mov	r1, arg0
  756:	  237A	C1 A2				ajmp	ansi_move
  757:
  758:
  759:	  237C	B4 43 06	do_csi_C:	cjne	a, #'C', do_csi_D	;cursor right
  760:	  237F	D1 8E				acall	args_gr_zero
  761:	  2381	A8 26				mov	r0, arg0
  762:	  2383	C1 A2				ajmp	ansi_move
  763:
  764:
  765:	  2385	B4 44 09	do_csi_D:	cjne	a, #'D', do_csi_H 	;cursor left
  766:	  2388	D1 8E				acall	args_gr_zero
  767:	  238A	E5 26				mov	a, arg0

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 15



 Line  I  Addr  Code            Source

  768:	  238C	F4				cpl	a
  769:	  238D	04				inc	a
  770:	  238E	F8				mov	r0, a
  771:	  238F	C1 A2				ajmp	ansi_move
  772:
  773:
  774:	  2391	B4 48 02	do_csi_H:	cjne	a, #'H', do_csi_H1	;position cursor
  775:	  2394	80 03				sjmp	do_csi_H2
  776:	  2396	B4 66 0E	do_csi_H1:	cjne	a, #'f', do_csi_s
  777:	  2399	D1 8E		do_csi_H2:	acall	args_gr_zero
  778:	  239B	E5 26				mov	a, arg0
  779:	  239D	14				dec	a
  780:	  239E	F5 38				mov	cursory, a
  781:	  23A0	E5 27				mov	a, arg1
  782:	  23A2	14				dec	a
  783:	  23A3	F5 37				mov	cursorx, a
  784:	  23A5	C1 A2				ajmp	ansi_move
  785:
  786:
  787:	  23A7	B4 73 07	do_csi_s:	cjne	a, #'s', do_csi_u	;save cursor
  788:	  23AA	85 37 2B			mov	scursorx, cursorx
  789:	  23AD	85 38 2C			mov	scursory, cursory
  790:	  23B0	22				ret
  791:
  792:
  793:	  23B1	B4 75 08	do_csi_u:	cjne	a, #'u', do_csi_m	;restore cursor
  794:	  23B4	85 2B 37			mov	cursorx, scursorx
  795:	  23B7	85 2C 38			mov	cursory, scursory
  796:	  23BA	C1 A2				ajmp	ansi_move
  797:
  798:
  799:	  23BC	B4 6D 5E	do_csi_m:	cjne	a, #'m', do_csi_n	;color handling
  800:	  23BF	A9 25				mov	r1, nargs
  801:	  23C1	B9 00 06			cjne	r1, #0, do_csi_ma
  802:	  23C4	75 2D F0			mov	color, #0f0h		;no args, reset
  803:	  23C7	C2 03				clr	inverse
  804:	  23C9	22				ret
  805:	  23CA	78 26		do_csi_ma:	mov	r0, #arg0
  806:	  23CC	E6		do_csi_mc:	mov	a, @r0
  807:	  23CD	B4 00 07			cjne	a, #0, do_csi_md	;if arg = 0, all attrs off
  808:	  23D0	75 2D F0			mov	color, #0f0h
  809:	  23D3	C2 03				clr	inverse
  810:	  23D5	81 19				ajmp	do_csi_mx3		;loop nargs
  811:	  23D7	B4 1E 00	do_csi_md:	cjne	a, #30, do_csi_mb
  812:	  23DA	50 02		do_csi_mb:	jnc	do_csi_me		;arg >= 30
  813:	  23DC	80 2A				sjmp	do_csi_mx		;loop nargs
  814:	  23DE	B4 26 00	do_csi_me:	cjne	a, #38, do_csi_mf
  815:	  23E1	50 36		do_csi_mf:	jnc	do_csi_mx3		;>= 38	loop nargs
  816:	  23E3	94 1D				subb	a, #29			; - 30 (carry set!)
  817:	  23E5	C4				swap	a
  818:	  23E6	FA				mov	r2, a
  819:	  23E7	E5 2D				mov	a, color
  820:	  23E9	54 0F				anl	a, #0fh
  821:	  23EB	4A				orl	a, r2
  822:	  23EC	F5 2D				mov	color, a
  823:	  23EE	81 19				ajmp	do_csi_mx3		;loop nargs

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 16



 Line  I  Addr  Code            Source

  824:	  23F0	B4 28 00	do_csi_mg:	cjne	a, #40, $+3
  825:	  23F3	50 02				jnc	do_csi_mh		;>= 40
  826:	  23F5	81 08				ajmp	do_csi_mx		;loop nargs
  827:	  23F7	B4 30 00	do_csi_mh:	cjne	a, #48, $+3
  828:	  23FA	50 0C				jnc	do_csi_mx		;>= 48 loop
  829:	  23FC	94 27				subb	a, #39			;- 40 (carry set!)
  830:	  23FE	FA				mov	r2, a
  831:	  23FF	F5 2D				mov	color, a
  832:	  2401	54 F0				anl	a, #0f0h
  833:	  2403	4A				orl	a, r2
  834:	  2404	F5 2D				mov	color, a
  835:	  2406	81 19				ajmp	do_csi_mx3		; loop nargs
  836:	  2408	B4 07 02	do_csi_mx:	cjne	a, #7, do_csi_mx1	; inverse
  837:	  240B	D2 03				setb	inverse
  838:	  240D	B4 01 03	do_csi_mx1:	cjne	a, #1, do_csi_mx2	; bold
  839:	  2410	75 2D 30			mov	color, #30h
  840:	  2413	B4 05 03	do_csi_mx2:	cjne	a, #5, do_csi_mx3
  841:	  2416	75 2D 10			mov	color, #10h
  842:	  2419	08		do_csi_mx3:	inc	r0
  843:	  241A	D9 B0				djnz	r1, do_csi_mc
  844:	  241C	22				ret
  845:
  846:	  241D	B4 6E 4F	do_csi_n:	cjne	a, #'n', do_csi_cc	;terminal status report
  847:	  2420	E5 26				mov	a, arg0
  848:	  2422	B4 05 0E			cjne	a, #5, do_csi_n6
  849:	  2425	78 01				mov	r0, #1			;always OK: "ESC [ 0 n"
  850:	  2427	E8		do_csi_n1:	mov	a, r0
  851:	  2428	12 24 62			call	getreport
  852:	  242B	12 29 40			call	cout
  853:	  242E	08				inc	r0
  854:	  242F	B8 05 F5			cjne	r0, #5, do_csi_n1
  855:	  2432	22				ret
  856:	  2433	B4 06 39	do_csi_n6:	cjne	a, #6, do_csi_cc		;report cursor position
  857:	  2436	74 1B				mov	a, #ESC
  858:	  2438	12 29 40			call	cout
  859:	  243B	74 5B				mov	a, #'['
  860:	  243D	12 29 40			call	cout
  861:	  2440	E5 38				mov	a, cursory
  862:	  2442	95 31				subb	a, top
  863:	  2444	12 24 56			call	sendpos
  864:	  2447	74 3B				mov	a, #';'
  865:	  2449	12 29 40			call	cout
  866:	  244C	E5 37				mov	a, cursorx
  867:	  244E	12 24 56			call	sendpos
  868:	  2451	74 52				mov	a, #'R'
  869:	  2453	02 29 40			jmp	cout
  870:
  871:	  2456	04		sendpos:	inc	a
  872:	  2457	12 28 81			call	hex2dez
  873:	  245A	E8				mov	a, r0
  874:	  245B	12 29 40			call	cout
  875:	  245E	E9				mov	a, r1
  876:	  245F	02 29 40			jmp	cout
  877:
  878:	  2462	83		getreport:	movc	a, @a+pc
  879:	  2463	22				ret

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 17



 Line  I  Addr  Code            Source

  880:	  2464	1B 5B 30 6E	reportok:	db	ESC, "[0n"		;terminal OK
  881:	  2468	1B 5B 3F 31	reportda:	db	ESC, "[?1;0c"		;device attributes (VT100, no options)
	  246C	3B 30 63
  882:
  883:	  246F	B4 63 0D	do_csi_cc:	cjne	a, #'c', do_csi_r
  884:	  2472	78 05		do_csi_cc2:	mov	r0, #5			;reportda
  885:	  2474	E8		do_csi_cc1:	mov	a, r0
  886:	  2475	91 62				call	getreport
  887:	  2477	12 29 40			call	cout
  888:	  247A	08				inc	r0
  889:	  247B	B8 0C F6			cjne	r0, #5+7, do_csi_cc1
  890:	  247E	22				ret
  891:
  892:	  247F	B4 72 43	do_csi_r:	cjne	a, #'r', do_csi_J	;set scroll margins
  893:	  2482	E5 25				mov	a, nargs
  894:	  2484	70 08				jnz	do_csi_ra		;nargs > 0
  895:	  2486	75 31 00			mov	top, #0
  896:	  2489	75 32 17			mov	bottom, #HEIGHT-1
  897:	  248C	80 28				sjmp	do_csi_rc
  898:	  248E	D1 8E		do_csi_ra:	acall	args_gr_zero
  899:	  2490	B4 02 00			cjne	a, #2, $+3
  900:	  2493	50 0A				jnc	do_csi_rb		;>= 2 args
  901:	  2495	85 26 31			mov	top, arg0
  902:	  2498	15 31				dec	top
  903:	  249A	75 32 17			mov	bottom, #HEIGHT-1
  904:	  249D	80 17				sjmp	do_csi_rc
  905:	  249F	E5 26		do_csi_rb:	mov	a, arg0
  906:	  24A1	95 27				subb	a, arg1			;carry clear!
  907:	  24A3	50 20				jnc	do_csi_J		; a >= b
  908:	  24A5	85 26 31			mov	top, arg0
  909:	  24A8	15 31				dec	top
  910:
  911:	  24AA	E5 27				mov	a, arg1
  912:	  24AC	B4 19 00			cjne	a, #HEIGHT+1, $+3
  913:	  24AF	40 02				jc	do_csi_re
  914:	  24B1	74 18				mov	a, #HEIGHT
  915:	  24B3	14		do_csi_re:	dec	a
  916:	  24B4	F5 32				mov	bottom, a
  917:
  918:	  24B6	E4		do_csi_rc:	clr	a			;cursor home
  919:	  24B7	F8				mov	r0, a
  920:	  24B8	F9				mov	r1, a
  921:	  24B9	F5 37				mov	cursorx, a
  922:	  24BB	F5 38				mov	cursory, a
  923:	  24BD	30 11 03			jnb	origin, do_csi_rd
  924:	  24C0	85 31 38			mov	cursory, top
  925:	  24C3	C1 A2		do_csi_rd:	ajmp	ansi_move
  926:
  927:
  928:	  24C5	B4 4A 35	do_csi_J:	cjne	a, #'J', do_csi_ques		;ED – Erase In Display
  929:	  24C8	A8 26				mov	r0, arg0
  930:	  24CA	B8 00 0F	do_csi_Ja:	cjne	r0, #0, do_csi_Jb
  931:	  24CD	A8 38		do_csi_Jc:	mov	r0, cursory			;Erase from the active position to the end o
				f the screen, inclusive (default)
  932:	  24CF	79 17				mov	r1, #HEIGHT-1			;y from cursory to HEIGHT-1
  933:	  24D1	AA 37				mov	r2, cursorx			;start position x

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 18



 Line  I  Addr  Code            Source

  934:	  24D3	74 50				mov	a, #WIDTH			;chars to erase first line
  935:	  24D5	9A				subb	a, r2
  936:	  24D6	FB				mov	r3, a
  937:	  24D7	7D 50				mov	r5, #WIDTH			;chars to erase last line
  938:	  24D9	02 28 17			jmp	clear_lines
  939:
  940:	  24DC	B8 01 0E	do_csi_Jb:	cjne	r0, #1, do_csi_Jd
  941:	  24DF	78 00				mov	r0, #0				;Erase from start of the screen to the activ
				e position, inclusive
  942:	  24E1	A9 38				mov	r1, cursory
  943:	  24E3	7A 00				mov	r2, #0
  944:	  24E5	7B 50				mov	r3, #WIDTH			;chars to erase first line
  945:	  24E7	AD 37				mov	r5, cursorx
  946:	  24E9	0D				inc	r5				;chars to erase last line
  947:	  24EA	02 28 17			jmp	clear_lines
  948:
  949:	  24ED	B8 02 0D	do_csi_Jd:	cjne	r0, #2, do_csi_ques
  950:	  24F0	78 00				mov	r0, #0				;Erase all of the display – all lines are er
				ased and the cursor does not move.
  951:	  24F2	79 17				mov	r1, #HEIGHT-1
  952:	  24F4	7A 00				mov	r2, #0
  953:	  24F6	7B 50				mov	r3, #WIDTH			;chars to erase first line
  954:	  24F8	7D 50				mov	r5, #WIDTH			;chars to erase first line
  955:	  24FA	02 28 17			jmp	clear_lines
  956:
  957:	  24FD	B4 3F 04	do_csi_ques:	cjne	a, #'?', do_csi_K
  958:	  2500	75 33 0E			mov	state, #ST_CSI_Q
  959:	  2503	22				ret
  960:
  961:	  2504	B4 4B 29	do_csi_K:	cjne	a, #'K', do_csi_g
  962:	  2507	A8 38				mov	r0, cursory
  963:	  2509	A9 38				mov	r1, cursory
  964:	  250B	E5 26				mov	a, arg0
  965:	  250D	B4 00 09			cjne	a, #0, do_csi_Ka		;Erase from the active position to the end o
				f the line, inclusive (default)
  966:	  2510	AA 37				mov	r2, cursorx
  967:	  2512	74 50				mov	a, #WIDTH
  968:	  2514	9A				subb	a, r2
  969:	  2515	FD				mov	r5, a
  970:	  2516	02 28 17			jmp	clear_lines
  971:	  2519	B4 01 08	do_csi_Ka:	cjne	a, #1, do_csi_Kb		;Erase from the start of the screen to the a
				ctive position, inclusive
  972:	  251C	7A 00				mov	r2, #0
  973:	  251E	AD 37				mov	r5, cursorx
  974:	  2520	0D				inc	r5
  975:	  2521	02 28 17			jmp	clear_lines
  976:	  2524	B4 02 07	do_csi_Kb:	cjne	a, #2, do_csi_end1		;Erase all of the line, inclusive
  977:	  2527	7A 00				mov	r2, #0
  978:	  2529	7D 50				mov	r5, #WIDTH
  979:	  252B	02 28 17			jmp	clear_lines
  980:	  252E	A1 FF		do_csi_end1:	ajmp	do_csi_end
  981:
  982:	  2530	B4 67 10	do_csi_g:	cjne	a, #'g', do_csi_L
  983:	  2533	E5 26				mov	a, arg0
  984:	  2535	B4 03 02			cjne	a, #3, do_csi_g1
  985:	  2538	E1 47				ajmp	cleartabu			;clear all tabs

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 19



 Line  I  Addr  Code            Source

  986:	  253A	F1 53		do_csi_g1:	acall	tab_set_r0_r1
  987:	  253C	F1 63				acall	getbit
  988:	  253E	F4				cpl	a
  989:	  253F	56				anl	a, @r0
  990:	  2540	F6				mov	@r0, a
  991:	  2541	A1 FF				ajmp	do_csi_end
  992:
  993:	  2543	B4 4C 24	do_csi_L:	cjne	a, #'L', do_csi_MM		;insert line
  994:	  2546	D1 8E				acall	args_gr_zero
  995:	  2548	E5 38				mov	a, cursory			;check if within bounds
  996:	  254A	B5 31 00			cjne	a, top, $+3
  997:	  254D	40 DF				jc	do_csi_end1
  998:	  254F	B5 32 00			cjne	a, bottom, $+3
  999:	  2552	80 02				sjmp	do_csi_L1
 1000:	  2554	50 D8				jnc	do_csi_end1
 1001:	  2556	12 28 6B	do_csi_L1:	call	cursor_off
 1002:	  2559	A8 26				mov	r0, arg0
 1003:	  255B	7B FF		do_csi_L2:	mov	r3, #-1
 1004:	  255D	C3				clr	c
 1005:	  255E	E5 32				mov	a, bottom
 1006:	  2560	95 38				subb	a, cursory
 1007:	  2562	FC				mov	r4, a
 1008:	  2563	F1 89				acall	scroll_r4
 1009:	  2565	D8 F4				djnz	r0, do_csi_L2
 1010:	  2567	02 28 59			jmp	cursor_on
 1011:
 1012:	  256A	B4 4D 2B	do_csi_MM:	cjne	a, #'M', do_csi_hh		;delete line
 1013:	  256D	D1 8E				acall	args_gr_zero
 1014:	  256F	E5 38				mov	a, cursory			;check if within bounds
 1015:	  2571	B5 31 00			cjne	a, top, $+3
 1016:	  2574	40 B8				jc	do_csi_end1
 1017:	  2576	B5 32 00			cjne	a, bottom, $+3
 1018:	  2579	80 02				sjmp	do_csi_MM1
 1019:	  257B	50 B1				jnc	do_csi_end1
 1020:	  257D	12 28 6B	do_csi_MM1:	call	cursor_off
 1021:	  2580	A8 26				mov	r0, arg0
 1022:	  2582	C0 31				push	top
 1023:	  2584	7B 01		do_csi_MM2:	mov	r3, #1
 1024:	  2586	C3				clr	c
 1025:	  2587	E5 32				mov	a, bottom
 1026:	  2589	95 38				subb	a, cursory
 1027:	  258B	FC				mov	r4, a
 1028:	  258C	85 38 31			mov	top, cursory
 1029:	  258F	F1 89				acall	scroll_r4
 1030:	  2591	D8 F1				djnz	r0, do_csi_MM2
 1031:	  2593	D0 31				pop	top
 1032:	  2595	02 28 59			jmp	cursor_on
 1033:
 1034:	  2598	75 33 00	do_csi_hh:	mov	state, #ST_IDLE			;h set NEWLINE / INSERT
 1035:	  259B	85 22 3C			mov	oldstatus, flags2
 1036:
 1037:	  259E	B4 68 16			cjne	a, #'h', do_csi_ll		;set mode
 1038:	  25A1	78 26				mov	r0, #arg0
 1039:	  25A3	A9 25				mov	r1, nargs
 1040:	  25A5	B9 00 01			cjne	r1, #0, do_csi_hh1		;>= 1 arg
 1041:	  25A8	22				ret

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 20



 Line  I  Addr  Code            Source

 1042:	  25A9	B6 14 02	do_csi_hh1:	cjne	@r0, #LNM, do_csi_hh2
 1043:	  25AC	D2 12				setb	newlinemode			;set newlinemode
 1044:	  25AE	B6 04 02	do_csi_hh2:	cjne	@r0, #IRM, do_csi_hhx
 1045:	  25B1	D2 13				setb	insert				;set insert mode
 1046:	  25B3	08		do_csi_hhx:	inc	r0
 1047:	  25B4	D9 F3				djnz	r1, do_csi_hh1
 1048:	  25B6	22				ret
 1049:
 1050:	  25B7	B4 6C 16	do_csi_ll:	cjne	a, #'l', do_csi_P		;h reset NEWLINE / INSERT
 1051:	  25BA	78 26				mov	r0, #arg0
 1052:	  25BC	A9 25				mov	r1, nargs
 1053:	  25BE	B9 00 01			cjne	r1, #0, do_csi_ll1
 1054:	  25C1	22				ret
 1055:	  25C2	B6 14 02	do_csi_ll1:	cjne	@r0, #LNM, do_csi_ll2
 1056:	  25C5	C2 12				clr	newlinemode			;clear newlinemode
 1057:	  25C7	B6 04 02	do_csi_ll2:	cjne	@r0, #IRM, do_csi_llx
 1058:	  25CA	C2 13				clr	insert				;clear insert mode
 1059:	  25CC	08		do_csi_llx:	inc	r0
 1060:	  25CD	D9 F3				djnz	r1, do_csi_ll1
 1061:	  25CF	22				ret
 1062:
 1063:	  25D0	B4 50 2C	do_csi_P:	cjne	a, #'P', do_csi_end		;Delete Character (DCH)
 1064:	  25D3	D1 8E				acall	args_gr_zero
 1065:	  25D5	A9 26				mov	r1, arg0
 1066:	  25D7	C3		do_csi_P2:	clr	c
 1067:	  25D8	74 4F				mov	a, #WIDTH-1
 1068:	  25DA	95 37				subb	a, cursorx
 1069:	  25DC	60 21				jz	do_csi_end			;nothing to do
 1070:	  25DE	23				rl	a
 1071:	  25DF	F8				mov	r0, a
 1072:	  25E0	12 28 8E			call	comp_dptr			;compute dptr1
 1073:	  25E3	85 84 82			mov	dp0l, dp1l			;copy to dptr0
 1074:	  25E6	85 85 83			mov	dp0h, dp1h
 1075:	  25E9	A3				inc	dptr				;
 1076:	  25EA	A3				inc	dptr				;dptr0 = dptr1 + 2
 1077:
 1078:	  25EB	E0		do_csi_P1:	movx	a, @dptr
 1079:	  25EC	E5 90				mov	a, P1
 1080:	  25EE	A3				inc	dptr
 1081:	  25EF	05 A2				inc	auxr1
 1082:	  25F1	F0				movx	@dptr, a
 1083:	  25F2	A3				inc	dptr
 1084:	  25F3	05 A2				inc	auxr1
 1085:	  25F5	D8 F4				djnz	r0, do_csi_P1
 1086:	  25F7	05 A2				inc	auxr1
 1087:	  25F9	E4				clr	a
 1088:	  25FA	F0				movx	@dptr, a
 1089:	  25FB	05 A2				inc	auxr1
 1090:	  25FD	D9 D8				djnz	r1, do_csi_P2
 1091:	  25FF	22		do_csi_end:	ret
 1092:
 1093:				;		mov	a, r0
 1094:				;		call	phex
 1095:				;		mov	a, dp0h
 1096:				;		call	phex
 1097:				;		mov	a, dp0l

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 21



 Line  I  Addr  Code            Source

 1098:				;		call	phex
 1099:				;		call	space
 1100:				;		mov	a, dp1h
 1101:				;		call	phex
 1102:				;		mov	a, dp1l
 1103:				;		call	phex
 1104:				;		call	space
 1105:				;		call	space
 1106:
 1107:				;===============================================
 1108:				; state CSI_questionmark "ESC [ ?"
 1109:				;===============================================
 1110:	  2600	D1 F8		do_csi_q:	acall	isparm				;is parameter?
 1111:	  2602	50 08				jnc	do_csi_q_h			;no
 1112:	  2604	85 33 23			mov	retstate, state
 1113:	  2607	75 33 0A			mov	state, #ST_CMD_ARG
 1114:	  260A	C1 65				ajmp	do_cmd_arg
 1115:
 1116:	  260C	75 33 00	do_csi_q_h:	mov	state, #ST_IDLE
 1117:	  260F	85 22 3C			mov	oldstatus, flags2
 1118:
 1119:	  2612	B4 68 18			cjne	a, #'h', do_csi_q_l		;set mode
 1120:	  2615	78 26				mov	r0, #arg0
 1121:	  2617	A9 25				mov	r1, nargs
 1122:	  2619	B9 00 01			cjne	r1, #0, do_csi_q_h1		;>= 1 arg
 1123:	  261C	22				ret
 1124:	  261D	B6 07 02	do_csi_q_h1:	cjne	@r0, #DECAWM, do_csi_q_h2	;set auto wrap
 1125:	  2620	D2 10				setb	wrap
 1126:	  2622	B6 06 04	do_csi_q_h2:	cjne	@r0, #DECOM, do_csi_q_hx	;set origin
 1127:	  2625	D2 11				setb	origin
 1128:	  2627	81 B6				ajmp	do_csi_rc			;position cursor home
 1129:	  2629	08		do_csi_q_hx:	inc	r0
 1130:	  262A	D9 F1				djnz	r1, do_csi_q_h1
 1131:	  262C	22				ret
 1132:
 1133:	  262D	B4 6C 18	do_csi_q_l:	cjne	a, #'l', do_csi_q_end		;reset mode
 1134:	  2630	78 26				mov	r0, #arg0
 1135:	  2632	A9 25				mov	r1, nargs
 1136:	  2634	B9 00 02			cjne	r1, #0, do_csi_q_l1
 1137:	  2637	80 C6				sjmp	do_csi_end
 1138:	  2639	B6 07 02	do_csi_q_l1:	cjne	@r0, #DECAWM, do_csi_q_l2	;reset auto wrap
 1139:	  263C	C2 10				clr	wrap
 1140:	  263E	B6 06 04	do_csi_q_l2:	cjne	@r0, #DECOM, do_csi_q_lx	;reset origin
 1141:	  2641	C2 11				clr	origin
 1142:	  2643	81 B6				ajmp	do_csi_rc			;position cursor home
 1143:	  2645	08		do_csi_q_lx:	inc	r0
 1144:	  2646	D9 F1				djnz	r1, do_csi_q_l1
 1145:	  2648	22		do_csi_q_end:	ret
 1146:
 1147:
 1148:				;===============================================
 1149:				; state ESC_questionmark "ESC ?"
 1150:				;===============================================
 1151:	  2649			do_esc_q:
 1152:	  2649	75 33 00			mov	state, #ST_IDLE
 1153:	  264C	22				ret

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 22



 Line  I  Addr  Code            Source

 1154:
 1155:				;===============================================
 1156:				; state ESC_hash "ESC #"
 1157:				;===============================================
 1158:	  264D	75 33 00	do_esc_hash:	mov	state, #ST_IDLE
 1159:
 1160:	  2650	B4 38 05			cjne	a, #'8', do_esc_hash_end
 1161:	  2653	7C 45				mov	r4, #'E'
 1162:	  2655	02 28 0C			jmp	fill_screen
 1163:
 1164:	  2658			do_esc_hash_end:
 1165:	  2658	22				ret
 1166:
 1167:
 1168:				;===============================================
 1169:				; state ESC right-bracket "ESC )"
 1170:				;===============================================
 1171:	  2659			do_esc_rbrack:
 1172:				;===============================================
 1173:				; state ESC left-bracket "ESC ("
 1174:				;===============================================
 1175:	  2659	75 33 00	do_esc_lbrack:	mov	state, #ST_IDLE
 1176:
 1177:	  265C	B4 30 03			cjne	a, #'0', do_esc_lb_1
 1178:	  265F	D2 00				setb	special
 1179:	  2661	22				ret
 1180:	  2662	C2 00		do_esc_lb_1:	clr	special
 1181:	  2664	22				ret
 1182:
 1183:
 1184:				;===============================================
 1185:				; state command arg
 1186:				;===============================================
 1187:	  2665			do_cmd_arg:
 1188:	  2665	F9				mov	r1, a			;save a
 1189:	  2666	74 26				mov	a, #arg0		;pointer to vars
 1190:	  2668	25 25				add	a, nargs
 1191:	  266A	F8				mov	r0, a
 1192:	  266B	E9				mov	a, r1
 1193:	  266C	F1 03				acall	isdigit
 1194:	  266E	50 0A				jnc	do_cmd_arg_1		;no digit
 1195:				;		inc	argcnt
 1196:	  2670	E6				mov	a, @r0
 1197:	  2671	75 F0 0A			mov	b, #10
 1198:	  2674	A4				mul	ab
 1199:	  2675	29				add	a, r1
 1200:	  2676	94 30				subb	a, #'0'
 1201:	  2678	F6				mov	@r0, a
 1202:	  2679	22				ret
 1203:	  267A	B4 3B 03	do_cmd_arg_1:	cjne	a, #';', do_cmd_arg_2
 1204:	  267D	05 25				inc	nargs
 1205:				;		mov	a, argcnt
 1206:				;		jnz	do_cmd_arg_3
 1207:				;		mov	@r0, #1
 1208:				;do_cmd_arg_3:	mov	argcnt, #0
 1209:	  267F	22				ret

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 23



 Line  I  Addr  Code            Source

 1210:	  2680	B4 1B 04	do_cmd_arg_2:	cjne	a, #C_ESC, do_cmd_arg_3
 1211:	  2683	75 33 02			mov	state, #ST_ESC
 1212:	  2686	22				ret
 1213:	  2687	05 25		do_cmd_arg_3:	inc	nargs
 1214:	  2689	85 23 33			mov	state, retstate
 1215:	  268C			do_cmd_arg_4:	;mov	retstate, #0
 1216:	  268C	21 D5				ajmp	ansiout
 1217:
 1218:
 1219:				;
 1220:				; set arg0-3 to one if zero
 1221:				;
 1222:	  268E	C0 00		args_gr_zero:	push	ar0
 1223:	  2690	C0 01				push	ar1
 1224:	  2692	78 26				mov	r0, #arg0
 1225:	  2694	79 04				mov	r1, #4
 1226:	  2696	B6 00 01	args_gr_zero_2:	cjne	@r0, #0, args_gr_zero_1
 1227:	  2699	06				inc	@r0
 1228:	  269A	08		args_gr_zero_1:	inc	r0
 1229:	  269B	D9 F9				djnz	r1, args_gr_zero_2
 1230:	  269D	D0 01				pop	ar1
 1231:	  269F	D0 00				pop	ar0
 1232:	  26A1	22				ret
 1233:
 1234:				; r0: x - offset
 1235:				; r1: y - offset
 1236:				; r2: 0: without scroll, 1: with scroll
 1237:				; r3: scroll occured
 1238:				; r4: 0 = within bounds, 1 = out of bounds
 1239:	  26A2			ansi_move:
 1240:						;acall	cursor_off
 1241:
 1242:	  26A2	7B 00				mov	r3, #0			;no scroll
 1243:	  26A4	AC 31				mov	r4, top
 1244:	  26A6	AD 32				mov	r5, bottom
 1245:
 1246:				;
 1247:				; check new x-posiion
 1248:				;
 1249:	  26A8	E8				mov	a, r0
 1250:	  26A9	25 37				add	a, cursorx		;< 0?
 1251:	  26AB	30 E7 01			jnb	acc.7, ansi_move_x1	;no, check width
 1252:	  26AE	E4				clr	a
 1253:	  26AF	B4 50 00	ansi_move_x1:	cjne	a, #WIDTH, $+3		;>= WIDTH ?
 1254:	  26B2	40 02				jc	ansi_move_x3		;< WIDTH
 1255:	  26B4	74 4F				mov	a, #WIDTH-1		;=WIDTH, set to WIDTH-1
 1256:	  26B6	F5 37		ansi_move_x3:	mov	cursorx, a
 1257:
 1258:				;
 1259:				; check if within margins
 1260:				;
 1261:	  26B8	20 11 13			jb	origin, ansi_move_y	;if origin, no out-of-margins
 1262:	  26BB	E5 38				mov	a, cursory		;check margins
 1263:	  26BD	B5 31 00			cjne	a, top, $+3
 1264:	  26C0	40 07				jc	ansi_move_m1		;< top!
 1265:	  26C2	B5 32 02			cjne	a, bottom, $+5

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 24



 Line  I  Addr  Code            Source

 1266:	  26C5	80 07				sjmp	ansi_move_y		;= bottom
 1267:	  26C7	40 05				jc	ansi_move_y		;< bottom
 1268:	  26C9	E4		ansi_move_m1:	clr	a
 1269:	  26CA	FA				mov	r2, a			;no scroll
 1270:	  26CB	FC				mov	r4, a
 1271:	  26CC	7D 17				mov	r5, #HEIGHT-1
 1272:
 1273:				;
 1274:				; check y-position
 1275:				;
 1276:	  26CE	E9		ansi_move_y:	mov	a, r1
 1277:	  26CF	25 38				add	a, cursory		;
 1278:	  26D1	20 E7 05			jb	acc.7, ansi_move_y2	;< 0
 1279:	  26D4	B5 04 00			cjne	a, ar4, $+3		;
 1280:	  26D7	50 04				jnc	ansi_move_y1		;>= top
 1281:	  26D9	C3		ansi_move_y2:	clr	c
 1282:	  26DA	9C				subb	a, r4
 1283:	  26DB	FB				mov	r3, a
 1284:	  26DC	EC				mov	a, r4			;< top, set to top
 1285:
 1286:	  26DD	B5 05 02	ansi_move_y1:	cjne	a, ar5, $+5		;= bottom ?
 1287:	  26E0	80 05				sjmp	ansi_move_y3		;yes
 1288:	  26E2	40 03				jc	ansi_move_y3		;< bottom?
 1289:	  26E4	9D				subb	a, r5			;no, >bottom
 1290:	  26E5	FB				mov	r3, a
 1291:	  26E6	ED				mov	a, r5			;set to bottom
 1292:	  26E7	F5 38		ansi_move_y3:	mov	cursory, a
 1293:	  26E9	12 28 6B			call	cursor_off
 1294:
 1295:	  26EC	EA				mov	a, r2			;is scrolling enabled ?
 1296:	  26ED	60 05				jz	ansi_move_ex		;no, exit
 1297:	  26EF	EB				mov	a, r3			;did scrolling occur?
 1298:	  26F0	60 02				jz	ansi_move_ex		;no, exit
 1299:
 1300:	  26F2	F1 83				acall	scroll
 1301:
 1302:	  26F4	12 28 4B	ansi_move_ex:	call	draw_cursor
 1303:	  26F7	22				ret
 1304:
 1305:				;ansi_line_left:
 1306:						;call	phex
 1307:				;		ret
 1308:
 1309:	  26F8	F1 03		isparm:		acall	isdigit
 1310:	  26FA	40 04				jc	isparmex
 1311:	  26FC	B4 3B 02			cjne	a, #';', isparm1
 1312:	  26FF	D3				setb	c
 1313:	  2700	22		isparmex:	ret
 1314:	  2701	C3		isparm1:	clr	c
 1315:	  2702	22				ret
 1316:				;
 1317:				; is acc beteen '0' and '9'?
 1318:				; if so, return carry clear, set otherwise
 1319:				;
 1320:	  2703	B4 30 00	isdigit:	cjne	a, #'0', isdigit1
 1321:	  2706	50 02		isdigit1:	jnc	isdigit2		;>= '0'

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 25



 Line  I  Addr  Code            Source

 1322:	  2708	B3				cpl	c
 1323:	  2709	22				ret				;carry set
 1324:	  270A	B4 3A 00	isdigit2:	cjne	a, #'9'+1, isdigit3
 1325:	  270D	22		isdigit3:	ret				;= '9' carry clear
 1326:
 1327:
 1328:
 1329:				;===============================================
 1330:				; reset terminal
 1331:				;===============================================
 1332:	  270E	C2 AF		term_reset:	clr	ea
 1333:	  2710	F1 2F				acall	clear_vars
 1334:	  2712	75 2D F0			mov	color, #0f0h
 1335:	  2715	75 32 17			mov	bottom, #HEIGHT-1
 1336:	  2718	75 34 40			mov	serstart, #serbuf
 1337:	  271B	75 35 40			mov	serend, #serbuf
 1338:	  271E	75 39 0A			mov	t0cnt, #C_TIME
 1339:
 1340:	  2721	F1 39				acall	resettabu
 1341:	  2723	12 28 0A			call	clear_screen
 1342:	  2726	D2 AF				setb	ea
 1343:
 1344:	  2728	12 2B B6			call	prtstatus
 1345:	  272B	12 28 4B			call	draw_cursor
 1346:	  272E	22				ret
 1347:
 1348:				;
 1349:				; clear 32 vars from "state" on
 1350:				;
 1351:	  272F	78 20		clear_vars:	mov	r0, #VARS	;clear term-vars
 1352:	  2731	79 40				mov	r1, #64
 1353:	  2733	76 00		clear_v1:	mov	@r0, #0
 1354:	  2735	08				inc	r0
 1355:	  2736	D9 FB				djnz	r1, clear_v1
 1356:	  2738	22				ret
 1357:
 1358:
 1359:	  2739	78 50		resettabu:	mov	r0, #tabutab
 1360:	  273B	79 0A				mov	r1, #10
 1361:	  273D	76 80		resettabu1:	mov	@r0, #128
 1362:	  273F	08				inc	r0
 1363:	  2740	D9 FB				djnz	r1, resettabu1
 1364:	  2742	89 50				mov	tabutab, r1	;R1 = 0
 1365:	  2744	05 59				inc	tabutab+9	;128 + 1 = 129
 1366:	  2746	22				ret
 1367:
 1368:
 1369:	  2747	78 50		cleartabu:	mov	r0, #tabutab
 1370:	  2749	79 0A				mov	r1, #10
 1371:	  274B	76 00		cleartabu1:	mov	@r0, #0
 1372:	  274D	08				inc	r0
 1373:	  274E	D9 FB				djnz	r1, cleartabu1
 1374:	  2750	05 59				inc	tabutab+9	;tabutab+9 = 1
 1375:	  2752	22				ret
 1376:
 1377:				;

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 26



 Line  I  Addr  Code            Source

 1378:				; compute
 1379:				; r0 = cursorx / 8 (byte holding tab-info) + tabutab
 1380:				; r1 = cursorx AND 7 (bi tposition within byte)
 1381:				;
 1382:	  2753	E5 37		tab_set_r0_r1:	mov	a, cursorx
 1383:	  2755	03				rr	a
 1384:	  2756	03				rr	a
 1385:	  2757	03				rr	a
 1386:	  2758	54 0F				anl	a, #0fh
 1387:	  275A	24 50				add	a, #tabutab
 1388:	  275C	F8				mov	r0, a				;address byte
 1389:	  275D	E5 37				mov	a, cursorx
 1390:	  275F	54 07				anl	a, #7
 1391:	  2761	F9				mov	r1, a
 1392:	  2762	22				ret
 1393:
 1394:
 1395:	  2763	E9		getbit:		mov	a, r1
 1396:	  2764	04				inc	a
 1397:	  2765	83				movc	a, @a+pc
 1398:	  2766	22				ret
 1399:	  2767	80 40 20 10	getbittab:	db	128, 64, 32, 16, 8, 4, 2, 1
	  276B	08 04 02 01
 1400:
 1401:
 1402:	  276F	78 25		clearargs:	mov	r0, #nargs
 1403:	  2771	79 05				mov	r1, #5
 1404:	  2773	76 00		clearargs1:	mov	@r0, #0
 1405:	  2775	08				inc	r0
 1406:	  2776	D9 FB				djnz	r1, clearargs1
 1407:	  2778	22				ret
 1408:
 1409:
 1410:	  2779	E4		print:		clr	a
 1411:	  277A	93				movc	a, @a+dptr
 1412:	  277B	70 01				jnz	print1
 1413:	  277D	22				ret
 1414:	  277E	31 D5		print1:		acall	ansiout
 1415:	  2780	A3				inc	dptr
 1416:	  2781	80 F6				sjmp	print
 1417:
 1418:				;msg1:		db	C_ESC, "[J", C_ESC, "[5;5H", 0
 1419:				;msg4:		db	C_ESC,"[5;65H", C_ESC,"[31mH", C_ESC,"[32mello ", C_ESC, "[mWorld", C_ESC, "
				[AJ", C_ESC, "[23;65Ha", C_ESC, "[H"
 1420:				;msg2:		db	"Hello world!", C_NEWLINE,0
 1421:				;msg3:		db	C_ESC, "[5C", C_ESC, "[7D", 0
 1422:
 1423:				;===============================================
 1424:				; pyhsical routines
 1425:				;===============================================
 1426:
 1427:				;===============================================
 1428:				; scrolls one line up or down
 1429:				; clear first or last line
 1430:				; r3 positive (0-127) scroll-up, scroll-down otherwise
 1431:				; r4 numbers of lines to scroll

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 27



 Line  I  Addr  Code            Source

 1432:				; ----------------------------------------------
 1433:				; r5 used for x-count
 1434:				;===============================================
 1435:	  2783	C3		scroll:		clr	c
 1436:	  2784	E5 32				mov	a, bottom
 1437:	  2786	95 31				subb	a, top
 1438:	  2788	FC				mov	r4, a			;number of lines to scroll
 1439:	  2789			scroll_r4:
 1440:	  2789	BB 80 00			cjne	r3, #128, $+3
 1441:	  278C	40 47				jc	scroll_up		;<128, positive, scroll up
 1442:
 1443:	  278E	E5 32				mov	a, bottom
 1444:	  2790	14				dec	a
 1445:	  2791	75 F0 A0			mov	b, #WIDTH*2
 1446:	  2794	A4				mul	ab
 1447:	  2795	24 9F				add	a, #(WIDTH*2)-1
 1448:	  2797	F5 82				mov	dp0l, a
 1449:	  2799	E5 F0				mov	a, b
 1450:	  279B	34 80				addc 	a, #80h
 1451:	  279D	F5 83				mov	dp0h, a
 1452:
 1453:	  279F	E5 82				mov	a, dp0l
 1454:	  27A1	24 A0				add	a, #WIDTH*2
 1455:	  27A3	F5 84				mov	dp1l, a
 1456:	  27A5	E5 83				mov	a, dp0h
 1457:	  27A7	34 00				addc	a, #0
 1458:	  27A9	F5 85				mov	dp1h, a
 1459:
 1460:				;		call	phex16
 1461:				;		mov	a, dp1h
 1462:				;		call	phex
 1463:				;		mov	a, dp1l
 1464:				;		call	phex
 1465:				;		jmp	cursor_on
 1466:
 1467:	  27AB	EC				mov	a, r4
 1468:	  27AC	60 1F				jz	scroll_down_6
 1469:	  27AE			scroll_down_4:
 1470:	  27AE	7D A0				mov	r5, #WIDTH*2
 1471:	  27B0			scroll_down_1:
 1472:	  27B0	E0				movx	a, @dptr
 1473:	  27B1	E5 90				mov	a, P1
 1474:	  27B3	05 A2				inc	auxr1
 1475:	  27B5	F0				movx	@dptr, a
 1476:	  27B6	05 A2				inc	auxr1
 1477:
 1478:	  27B8	E5 82				mov	a, dp0l
 1479:	  27BA	70 02				jnz	scroll_down_2
 1480:	  27BC	15 83				dec	dp0h
 1481:	  27BE	15 82		scroll_down_2:	dec	dp0l
 1482:
 1483:	  27C0	E5 84				mov	a, dp1l
 1484:	  27C2	70 02				jnz	scroll_down_3
 1485:	  27C4	15 85				dec	dp1h
 1486:	  27C6	15 84		scroll_down_3:	dec	dp1l
 1487:

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 28



 Line  I  Addr  Code            Source

 1488:	  27C8	DD E6				djnz	r5, scroll_down_1
 1489:	  27CA	DC E2				djnz	r4, scroll_down_4
 1490:
 1491:	  27CC	A3				inc	dptr
 1492:
 1493:						;call	phex16
 1494:	  27CD			scroll_down_6:
 1495:	  27CD	7D A0				mov	r5, #WIDTH*2
 1496:	  27CF	E4				clr	a
 1497:	  27D0	F0		scroll_down_5:	movx	@dptr, a
 1498:	  27D1	A3				inc	dptr
 1499:	  27D2	DD FC				djnz	r5, scroll_down_5
 1500:
 1501:						;ajmp	cursor_on		;reactivate cursor
 1502:	  27D4	22				ret
 1503:
 1504:	  27D5			scroll_up:
 1505:	  27D5	E5 31				mov	a, top			;dp0 = topline
 1506:	  27D7	75 F0 A0			mov	b, #WIDTH * 2		;dp1 = topline + 1
 1507:	  27DA	A4				mul	ab
 1508:	  27DB	F5 82				mov	dp0l, a
 1509:	  27DD	E5 F0				mov	a, b
 1510:	  27DF	34 80				addc	a, #80h
 1511:	  27E1	F5 83				mov	dp0h, a
 1512:
 1513:	  27E3	E5 82				mov	a, dp0l
 1514:	  27E5	24 A0				add	a, #WIDTH * 2
 1515:	  27E7	F5 84				mov	dp1l, a
 1516:	  27E9	E5 83				mov	a, dp0h
 1517:	  27EB	34 00				addc	a, #0
 1518:	  27ED	F5 85				mov	dp1h, a
 1519:
 1520:	  27EF	EC				mov	a, r4
 1521:	  27F0	60 10				jz	scroll_up_4
 1522:
 1523:	  27F2			scroll_up_1:
 1524:	  27F2	7D A0				mov	r5, #WIDTH * 2
 1525:
 1526:	  27F4	05 A2		scroll_up_2:	inc	auxr1			;copy from line n+1 to line n
 1527:	  27F6	E0				movx	a, @dptr
 1528:	  27F7	A3				inc	dptr
 1529:	  27F8	E5 90				mov	a, P1
 1530:	  27FA	05 A2				inc	auxr1
 1531:	  27FC	F0				movx	@dptr, a
 1532:	  27FD	A3				inc	dptr
 1533:	  27FE	DD F4				djnz	r5, scroll_up_2
 1534:	  2800	DC F0				djnz	r4, scroll_up_1
 1535:
 1536:	  2802			scroll_up_4:
 1537:	  2802	7D A0				mov	r5, #WIDTH * 2		;clear last line
 1538:	  2804	E4				clr	a
 1539:	  2805	F0		scroll_up_3:	movx	@dptr, a
 1540:	  2806	A3				inc	dptr
 1541:	  2807	DD FC				djnz	r5, scroll_up_3
 1542:
 1543:	  2809	22				ret

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 29



 Line  I  Addr  Code            Source

 1544:						;ajmp	cursor_on		;restore cursor
 1545:
 1546:
 1547:				;
 1548:				; r0: top line
 1549:				; r1: bottom line
 1550:				; r2: start position first line
 1551:				; r3: chars to fill first line
 1552:				; r4: value filled with
 1553:				; r5; chars to fill last line
 1554:				;
 1555:	  280A	7C 00		clear_screen:	mov	r4, #0
 1556:	  280C	E4		fill_screen:	clr	a
 1557:	  280D	F8				mov	r0, a
 1558:	  280E	79 17				mov	r1, #HEIGHT-1
 1559:	  2810	FA				mov	r2, a
 1560:	  2811	7B 50				mov	r3, #WIDTH
 1561:	  2813	7D 50				mov	r5, #WIDTH
 1562:	  2815	80 02				sjmp	fill_lines
 1563:
 1564:	  2817			clear_lines:
 1565:	  2817	7C 00				mov	r4, #0				;fill with zero
 1566:	  2819			fill_lines:
 1567:	  2819	EA				mov	a, r2				;r2 = r2 * 2
 1568:	  281A	23				rl	a
 1569:	  281B	FA				mov	r2, a
 1570:
 1571:	  281C	E9				mov	a, r1				;r1 = r1 - r0 + 1
 1572:	  281D	C3				clr	c
 1573:	  281E	98				subb	a, r0
 1574:	  281F	04				inc	a
 1575:	  2820	F9				mov	r1, a				;line count in r1
 1576:
 1577:	  2821	E8				mov	a, r0				;compute start-position from r0 und r2
 1578:	  2822	75 F0 A0			mov	b, #WIDTH * 2
 1579:	  2825	A4				mul	ab
 1580:	  2826	2A				add	a, r2
 1581:	  2827	F5 84				mov	dp1l, a
 1582:	  2829	E5 F0				mov	a, b
 1583:	  282B	34 80				addc	a, #80h
 1584:	  282D	F5 85				mov	dp1h, a
 1585:
 1586:	  282F	05 A2				inc	auxr1				;switch to dptr1
 1587:	  2831	A8 03				mov	r0, ar3				;chars to fill first line
 1588:
 1589:	  2833	B9 01 02	clear_lines2:	cjne 	r1, #1, clear_lines1		;last line?
 1590:	  2836	A8 05				mov	r0, ar5				;chars to fill last line
 1591:	  2838	EC		clear_lines1:	mov	a, r4
 1592:	  2839	F0				movx	@dptr, a
 1593:	  283A	A3				inc	dptr
 1594:	  283B	74 70				mov	a, #70h
 1595:	  283D	F0				movx	@dptr, a
 1596:	  283E	A3				inc	dptr
 1597:	  283F	D8 F7				djnz	r0, clear_lines1
 1598:	  2841	78 50				mov	r0, #WIDTH
 1599:	  2843	D9 EE				djnz	r1, clear_lines2

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 30



 Line  I  Addr  Code            Source

 1600:	  2845	05 A2				inc	auxr1
 1601:	  2847	22				ret
 1602:
 1603:
 1604:				;===============================================
 1605:				; move cursor
 1606:				;===============================================
 1607:	  2848	12 28 6B	move_cursor:	call	cursor_off			;restore color under cursor
 1608:	  284B	12 28 8E	draw_cursor:	call	comp_dptr			;compute new address
 1609:	  284E	05 A2				inc	auxr1				;increase by 1 for color
 1610:	  2850	A3				inc	dptr
 1611:	  2851	05 A2				inc	auxr1
 1612:	  2853	85 84 2E			mov	cursorpos, dp1l			;store in cursorpos/+1
 1613:	  2856	85 85 2F			mov	cursorpos+1, dp1h
 1614:
 1615:				;		ajmp	cursor_on			;save color under cursor
 1616:				;
 1617:				; save color under new cursor position in cursorsave
 1618:				; enable interrupt
 1619:				;
 1620:	  2859			cursor_on:	;mov	a, cursorpos+1
 1621:						;call	phex
 1622:						;mov	a, cursorpos
 1623:						;call	phex
 1624:
 1625:	  2859	85 2E 84			mov	dp1l, cursorpos
 1626:	  285C	85 2F 85			mov	dp1h, cursorpos+1
 1627:	  285F	05 A2				inc	auxr1
 1628:	  2861	E0				movx	a, @dptr
 1629:	  2862	E5 90				mov	a, P1
 1630:	  2864	F5 30				mov	cursorsave, a
 1631:	  2866	05 A2				inc	auxr1
 1632:	  2868	D2 8C				setb	tr0				;enable timer
 1633:	  286A	22				ret
 1634:
 1635:				;
 1636:				; clear timer0 interrupt
 1637:				; restore color under cursor
 1638:				; reset t0cnt
 1639:				;
 1640:	  286B	C2 8C		cursor_off:	clr	tr0				;stop timer
 1641:
 1642:				;		mov	a, cursorpos+1
 1643:				;		call	phex
 1644:				;		mov	a, cursorpos
 1645:				;		call	phex
 1646:
 1647:	  286D	85 2E 84			mov	dp1l, cursorpos
 1648:	  2870	85 2F 85			mov	dp1h, cursorpos+1
 1649:	  2873	05 A2				inc	auxr1
 1650:	  2875	E5 30				mov	a, cursorsave
 1651:	  2877	F0				movx	@dptr, a
 1652:	  2878	05 A2				inc	auxr1
 1653:	  287A	75 8C 80			mov	TH0, #128
 1654:	  287D	75 39 01			mov	t0cnt, #1
 1655:	  2880	22				ret

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 31



 Line  I  Addr  Code            Source

 1656:
 1657:				;
 1658:				; converts accu	into two digits in R0, R1 (high, low)
 1659:				;
 1660:	  2881	75 F0 0A	hex2dez:	mov	b, #10
 1661:	  2884	84				div	ab
 1662:	  2885	24 30				add	a, #'0'
 1663:	  2887	F8				mov	r0, a
 1664:	  2888	E5 F0				mov	a, b
 1665:	  288A	24 30				add	a, #'0'
 1666:	  288C	F9				mov	r1, a
 1667:	  288D	22				ret
 1668:
 1669:				;
 1670:				; compute dp1 cursor screen address
 1671:				; dp1l/h = cursorx * 2 + cursory * WIDTH * 2 + 0x8000
 1672:				;
 1673:	  288E			comp_dptr:
 1674:	  288E	E5 37				mov	a, cursorx
 1675:	  2890	23				rl	a
 1676:	  2891	FF				mov	r7, a
 1677:
 1678:	  2892	E5 38				mov	a, cursory
 1679:	  2894	75 F0 A0			mov	b, #WIDTH * 2
 1680:	  2897	A4				mul	ab
 1681:
 1682:	  2898	2F				add	a, r7
 1683:	  2899	F5 84				mov	dp1l, a
 1684:	  289B	E5 F0				mov	a, b
 1685:	  289D	34 80				addc	a, #80h
 1686:	  289F	F5 85				mov	dp1h, a
 1687:	  28A1	22				ret
 1688:
 1689:						$INCLUDE (io.a51)
 1690: 1			;
 1691: 1			;
 1692: 1			;
 1693: 1  28A2			init6845:
 1694: 1  28A2	90 00 00			mov	dptr, #0		;enable ADR + DAT
 1695: 1  28A5	E0				movx	a, @dptr
 1696: 1
 1697: 1  28A6	90 80 00			mov	DPTR, #08000h
 1698: 1  28A9	05 A2				inc	AUXR1
 1699: 1  28AB	90 28 D9			mov	DPTR, #SYDATA
 1700: 1  28AE	05 A2				inc	AUXR1
 1701: 1  28B0	78 00				mov	R0, #0
 1702: 1
 1703: 1  28B2			setregs:
 1704: 1			;		call	PHEX
 1705: 1			;		call	SPACE
 1706: 1
 1707: 1  28B2	E8				mov	A, R0			; send address
 1708: 1  28B3	12 29 7B			call	PHEX
 1709: 1  28B6	F0				movx	@DPTR,A			; address register
 1710: 1  28B7	D2 B5				setb	T1			; clock high
 1711: 1  28B9	C2 B5				clr	T1			; clock low

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 32



 Line  I  Addr  Code            Source

 1712: 1  28BB	A3				inc	DPTR			; data reg
 1713: 1
 1714: 1  28BC	05 A2				inc	AUXR1			;data pointer
 1715: 1  28BE	93				movc	A, @A+DPTR
 1716: 1  28BF	12 29 7B			call	PHEX
 1717: 1  28C2	05 A2				inc	AUXR1			; address pointer
 1718: 1  28C4	F0				movx	@DPTR, A		; send data
 1719: 1  28C5	D2 B5				setb	T1			; clock high
 1720: 1  28C7	C2 B5				clr	T1			; clock low
 1721: 1
 1722: 1  28C9	12 29 2C			call	SPACE
 1723: 1  28CC	A3				inc	DPTR
 1724: 1  28CD	08				inc	R0
 1725: 1  28CE	B8 0F E1			cjne	R0, #15, setregs
 1726: 1
 1727: 1  28D1	90 00 00			mov	dptr, #0		;enable ADR + DAT
 1728: 1  28D4	E0				movx	a, @dptr
 1729: 1
 1730: 1  28D5	12 29 36			call	newline
 1731: 1			;		call	CIN
 1732: 1			;
 1733: 1			;		setb	INT0
 1734: 1			;		call	CIN
 1735: 1  28D8	22				ret
 1736: 1
 1737: 1			;
 1738: 1			; 25,333 Mhz / 8 = 3,166 Mhz
 1739: 1			;
 1740: 1			; 31468 HZ = 31,77 uS
 1741: 1			;
 1742: 1			; 25,333 Mhz / 8 / 31468 ~ 	100 chars Horizontal Total
 1743: 1			;				  2 chars Fornt Porch
 1744: 1			;				  6 chars Back Porch
 1745: 1			;				 80 chars Horizontal Visible
 1746: 1			;				 12 chars Sync Pulse
 1747: 1			;Scanline part	Pixels	Time [µs]
 1748: 1			;Visible area	640	25.422045680238
 1749: 1			;Front porch	16	0.63555114200596
 1750: 1			;Sync pulse	96	3.8133068520357
 1751: 1			;Back porch	48	1.9066534260179
 1752: 1			;Whole line	800	31.777557100298
 1753: 1
 1754: 1			;Frame part	Lines	Time [ms]
 1755: 1			;Visible area	400	12.711022840119
 1756: 1			;Front porch	12	0.38133068520357
 1757: 1			;Sync pulse	2	0.063555114200596
 1758: 1			;Back porch	35	1.1122144985104
 1759: 1			;Whole frame	449	14.268123138034
 1760: 1			;
 1761: 1  28D9	64		SYDATA:		DB	100		;R0 Horizontal Total - 1
 1762: 1  28DA	50				DB	80		;R1 Horizontal Displayed
 1763: 1  28DB	54				DB	84		;R2 Horizontal Sync Position
 1764: 1  28DC	0C				DB	0ch		;R3 VSYNC & HSYNC width
 1765: 1  28DD	1C				DB	28		;R4 Vertical total - 1			;27	32
 1766: 1  28DE	05				DB	5		;R5 Vertical Adjust
 1767: 1  28DF	19				DB	25		;R6 Vertical Displayed			;25	30

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 33



 Line  I  Addr  Code            Source

 1768: 1  28E0	1B				DB	27		;R7 Vertical Sync Position		;25	32
 1769: 1  28E1	00				DB	00h		;R8 Mode Control
 1770: 1  28E2	0F				DB	15		;R9 Scan Lines - 1 (character lines)
 1771: 1  28E3	00				DB	0		;R10 Cursor Start
 1772: 1  28E4	00				DB	0		;R11 Cursor End
 1773: 1  28E5	00				DB	000h		;R12 Display Start High
 1774: 1  28E6	00				DB	000h		;R13 Display Start Low
 1775: 1  28E7	00				DB	0		;R14 Cursor Pos High
 1776: 1  28E8	00				DB	0		;R15 Cursor Pos Low
 1777: 1  28E9	00				DB	0		;R16 Light Pen High
 1778: 1  28EA	00				DB	0		;R17 Light Pen Low
 1779: 1  28EB	00				DB	0		;R18 Update Address Reg High
 1780: 1  28EC	00				DB	0		;R19 Update Address Reg Low
 1781: 1								;R31 Dummy Register
 1782: 1			;
 1783: 1			;
 1784: 1			;
 1785: 1  28ED			copyFont:
 1786: 1  28ED	90 70 00			mov	DPTR, #7000h
 1787: 1  28F0	05 A2				inc	AUXR1
 1788: 1  28F2	90 A0 00			mov	DPTR, #(8000h+2000h) ;+4000h+1000h
 1789: 1  28F5	05 A2				inc	AUXR1
 1790: 1
 1791: 1  28F7	E4		copyFont1:	clr	A
 1792: 1  28F8	93				movc	A, @A+DPTR
 1793: 1  28F9	A3				inc	DPTR
 1794: 1  28FA	05 A2				inc	AUXR1
 1795: 1  28FC	F0				movx	@DPTR, A
 1796: 1  28FD	A3				inc	DPTR
 1797: 1  28FE	05 A2				inc	AUXR1
 1798: 1
 1799: 1  2900	E5 83				mov	A, DP0H
 1800: 1					;call	PHEX
 1801: 1  2902	B4 80 F2			cjne	A, #80h, copyFont1
 1802: 1
 1803: 1			;		mov	A, AUXR1
 1804: 1			;		call	PHEX
 1805: 1			;		call	newline
 1806: 1  2905	22				ret
 1807: 1
 1808: 1			;
 1809: 1			;
 1810: 1			;
 1811: 1  2906	90 80 00	testScreen:	mov	DPTR, #8000h
 1812: 1  2909	78 15				mov	R0, #21
 1813: 1
 1814: 1  290B	79 50		testScreen3:	mov	R1, #80
 1815: 1  290D	7A 01				mov	R2, #1
 1816: 1  290F	EA		testScreen1:	mov	A, R2
 1817: 1  2910	F0				movx	@DPTR, A
 1818: 1  2911	A3				inc	DPTR
 1819: 1  2912	74 70				mov	A, #70h
 1820: 1					;anl	A, #3
 1821: 1					;orl	A, #0f0h
 1822: 1					;inc	A
 1823: 1  2914	F0				movx	@DPTR, A

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 34



 Line  I  Addr  Code            Source

 1824: 1  2915	A3				inc	DPTR
 1825: 1  2916	0A				inc	R2
 1826: 1  2917	BA 3A 02			cjne	R2, #'9'+1, testScreen2
 1827: 1  291A	7A 30				mov	R2, #'0'
 1828: 1  291C	D9 F1		testScreen2:	djnz	R1, testScreen1
 1829: 1  291E	D8 EB				djnz	R0, testScreen3
 1830: 1
 1831: 1  2920	E8		testScreen4:	mov	a, r0
 1832: 1  2921	F0				movx	@dptr, a
 1833: 1  2922	A3				inc	dptr
 1834: 1  2923	74 60				mov	a, #60h
 1835: 1  2925	F0				movx	@dptr, a
 1836: 1  2926	A3				inc	dptr
 1837: 1  2927	08				inc	r0
 1838: 1  2928	B8 00 F5			cjne	r0, #0, testScreen4
 1839: 1  292B	22				ret
 1840: 1			;
 1841: 1			;
 1842: 1			;
 1843: 1  292C	C0 E0		space:		push	acc
 1844: 1  292E	74 20				mov	a, #' '
 1845: 1  2930	12 29 40			call	cout
 1846: 1  2933	D0 E0				pop	acc
 1847: 1  2935	22				ret
 1848: 1
 1849: 1  2936	C0 E0		newline:	push	acc
 1850: 1  2938	74 0A				mov	a, #0ah
 1851: 1  293A	12 29 40			call	cout
 1852: 1  293D	D0 E0				pop	acc
 1853: 1  293F	22				ret
 1854: 1
 1855: 1
 1856: 1  2940	20 05 FD	cout:		jb	serbusy, cout
 1857: 1  2943	D2 05				setb	serbusy
 1858: 1  2945	F5 99				mov	sbuf, a
 1859: 1  2947	22				ret
 1860: 1
 1861: 1
 1862: 1  2948	30 99 FD	cout_x:		jnb	ti, cout_x
 1863: 1  294B	C2 99				clr	ti			;clr ti before the mov to sbuf!
 1864: 1  294D	F5 99				mov	sbuf, a
 1865: 1  294F	22				ret
 1866: 1
 1867: 1  2950	C0 00		cin:		push	ar0
 1868: 1  2952	E5 34		cin_2:		mov	a, serstart
 1869: 1  2954	B5 35 02			cjne	a, serend, cin_1
 1870: 1  2957	80 F9				sjmp	cin_2
 1871: 1  2959	C2 AC		cin_1:		clr	ES			;no serial interrupt
 1872: 1  295B	04				inc	a
 1873: 1  295C	F8				mov	r0, a
 1874: 1  295D	B8 50 00			cjne	r0, #serbuf+16, $+3
 1875: 1  2960	40 02				jc	cin_3
 1876: 1  2962	78 40				mov	r0, #serbuf
 1877: 1  2964	E6		cin_3:		mov	a, @r0
 1878: 1  2965	88 34				mov	serstart, r0
 1879: 1  2967	15 36				dec	sercount

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 35



 Line  I  Addr  Code            Source

 1880: 1			;		push	acc
 1881: 1			;		mov	a, sercount
 1882: 1			;		call	phex
 1883: 1			;		pop	acc
 1884: 1
 1885: 1  2969	A8 36		cin_5:		mov	r0, sercount
 1886: 1  296B	B8 00 08			cjne	r0, #0, cin_4
 1887: 1
 1888: 1  296E	30 04 05			jnb	xonoff, cin_4
 1889: 1
 1890: 1  2971	75 99 11	cin_7:		mov	SBUF, #C_XON
 1891: 1  2974	C2 04				clr	xonoff
 1892: 1			;		mov	r0, #80
 1893: 1			;		djnz	r0, $
 1894: 1
 1895: 1  2976	D0 00		cin_4:		pop	ar0
 1896: 1  2978	D2 AC				setb	ES
 1897: 1  297A	22				ret
 1898: 1
 1899: 1
 1900: 1			;cin_x:		jnb	ri, cin
 1901: 1			;		clr	ri
 1902: 1			;		mov	a, sbuf
 1903: 1			;		ret
 1904: 1
 1905: 1			; Highly code efficient resursive call phex contributed
 1906: 1			; by Alexander B. Alexandrov <abalex@cbr.spb.ru>
 1907: 1
 1908: 1  297B			phex:
 1909: 1  297B			phex8:
 1910: 1  297B	31 7D				acall	phex_b
 1911: 1  297D	C4		phex_b:		swap	a		;SWAP A will be twice => A unchanged
 1912: 1  297E	C0 E0		phex1:		push	acc
 1913: 1  2980	54 0F				anl	a, #15
 1914: 1  2982	24 90				add	a, #90h	; acc is 0x9X, where X is hex digit
 1915: 1  2984	D4				da	a		; if A to F, C=1 and lower four bits are 0..5
 1916: 1  2985	34 40				addc	a, #40h
 1917: 1  2987	D4				da	a
 1918: 1  2988	31 40				call	cout
 1919: 1  298A	D0 E0				pop	acc
 1920: 1  298C	22				ret
 1921: 1
 1922: 1  298D			phex16:
 1923: 1  298D	C0 E0				push	acc
 1924: 1  298F	E5 83				mov	a, dph
 1925: 1  2991	31 7B				call	phex
 1926: 1  2993	E5 82				mov	a, dpl
 1927: 1  2995	31 7B				call	phex
 1928: 1  2997	D0 E0				pop	acc
 1929: 1  2999	22				ret
 1930: 1
 1931: 1			;a not so well documented feature of pstr is that you can print
 1932: 1			;multiple consecutive strings without needing to reload dptr
 1933: 1			;(which takes 3 bytes of code!)... this is useful for inserting
 1934: 1			;numbers or spaces between strings.
 1935: 1

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 36



 Line  I  Addr  Code            Source

 1936: 1  299A	C0 E0		pstr:		push	acc
 1937: 1  299C	E4		pstr1:		clr	a
 1938: 1  299D	93				movc	a, @a+dptr
 1939: 1  299E	A3				inc	dptr
 1940: 1  299F	60 0A				jz	pstr2
 1941: 1  29A1	A2 E7				mov	c, acc.7
 1942: 1  29A3	55 7F				anl	a, 7Fh
 1943: 1  29A5	31 40				call	cout
 1944: 1  29A7	40 02				jc	pstr2
 1945: 1  29A9	80 F1				sjmp	pstr1
 1946: 1  29AB	D0 E0		pstr2:		pop	acc
 1947: 1  29AD	22				ret
 1948: 1
 1949: 1			;converts the ascii code in Acc to uppercase, if it is lowercase
 1950: 1
 1951: 1			; Code efficient (saves 6 byes) upper contributed
 1952: 1			; by Alexander B. Alexandrov <abalex@cbr.spb.ru>
 1953: 1
 1954: 1			;upper:
 1955: 1			;		cjne	a, #97, upper2
 1956: 1			;upper2:		jc	upper4		;end if acc < 97
 1957: 1			;		cjne	a, #123, upper3
 1958: 1			;upper3:		jnc	upper4		;end if acc >= 123
 1959: 1			;		add	a, #224		;convert to uppercase
 1960: 1			;upper4:		ret
 1961:
 1962:				;===============================================
 1963:				; decode scancode
 1964:				;===============================================
 1965:	  29AE			keydecode:	;mov	a, keyrxval
 1966:						;call	phex
 1967:
 1968:	  29AE	74 E0				mov	a, #EXTENDED			;extended?
 1969:	  29B0	B5 3B 03			cjne	a, keyrxval, keybreak
 1970:	  29B3	D2 09				setb	keyrxextended			;set extended flag
 1971:	  29B5	22				ret
 1972:
 1973:	  29B6	74 F0		keybreak:	mov	a, #BREAK			;break?
 1974:	  29B8	B5 3B 03			cjne	a, keyrxval, keyshift
 1975:	  29BB	D2 0A				setb	keyrxbreak
 1976:	  29BD	22				ret
 1977:
 1978:	  29BE	74 12		keyshift:	mov	a, #CLSHIFT			;left-shift?
 1979:	  29C0	B5 3B 02			cjne	a, keyrxval, keyshift1
 1980:	  29C3	80 05				sjmp	keyshift2
 1981:	  29C5	74 59		keyshift1:	mov	a, #CRSHIFT			;right shift?
 1982:	  29C7	B5 3B 07			cjne	a, keyrxval, keyStrg
 1983:	  29CA	A2 0A		keyshift2:	mov	c, keyrxbreak
 1984:	  29CC	B3				cpl	c
 1985:	  29CD	92 0B				mov	keyrxshift, c
 1986:	  29CF	80 16				sjmp	keyCheckBrk1
 1987:
 1988:	  29D1	74 14		keyStrg:	mov	a, #CLSTRG
 1989:	  29D3	B5 3B 07			cjne	a, keyrxval, keyCheckBrk
 1990:	  29D6	A2 0A				mov	c, keyrxbreak
 1991:	  29D8	B3				cpl	c

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 37



 Line  I  Addr  Code            Source

 1992:	  29D9	92 0D				mov	keyrxstrg, c
 1993:	  29DB	80 0A				sjmp	keyCheckBrk1
 1994:
 1995:	  29DD	30 0A 0C	keyCheckBrk:	jnb	keyrxbreak, keynormal		;break active?
 1996:	  29E0	74 11				mov	a, #ALTGR			;ALT-GR?
 1997:	  29E2	B5 3B 02			cjne	a, keyrxval, keyCheckBrk1
 1998:	  29E5	C2 0C				clr	keyrxaltgr			;clear ALT-GR
 1999:	  29E7	C2 0A		keyCheckBrk1:	clr	keyrxbreak
 2000:	  29E9	C2 09				clr	keyrxextended
 2001:	  29EB	22				ret
 2002:
 2003:	  29EC	C0 00		keynormal:	push	ar0
 2004:	  29EE	30 0B 05			jnb	keyrxshift, keyMakeExt
 2005:	  29F1	12 2A CC			call	keygetshift
 2006:	  29F4	80 3A				sjmp	keyExitOK
 2007:
 2008:	  29F6	30 09 1A	keyMakeExt:	jnb	keyrxextended, keyAltGr
 2009:	  29F9	C2 09				clr	keyrxextended			;clear extended
 2010:	  29FB	78 0D				mov	r0, #13
 2011:	  29FD	12 2B 77	keyMakeExt2:	call	keygetextind
 2012:	  2A00	B5 3B 0C			cjne	a, keyrxval, keyMakeExt1	;found?
 2013:	  2A03	12 2B 87			call	keygetext
 2014:	  2A06	B4 11 04			cjne	a, #ALTGR, keyMakeExt3		;ALTGR-pressed?
 2015:	  2A09	D2 0C				setb	keyrxaltgr			;set ALTGR-flag
 2016:	  2A0B	80 27				sjmp	keyExit
 2017:	  2A0D	80 21		keyMakeExt3:	sjmp	keyExitOK
 2018:	  2A0F	D8 EC		keyMakeExt1:	djnz	r0, keyMakeExt2
 2019:	  2A11	80 21				sjmp	keyExit
 2020:
 2021:	  2A13	30 0C 11	keyAltGr:	jnb	keyrxaltgr, keyMake		;AltGR pressed?
 2022:	  2A16	78 08				mov	r0, #8
 2023:	  2A18	12 2B 61	keyAltGr2:	call	keygetaltgrind
 2024:	  2A1B	B5 3B 05			cjne	a, keyrxval, keyAltGr1		;found?
 2025:	  2A1E	12 2B 6C			call	keygetaltgr
 2026:	  2A21	80 0D				sjmp	keyExitOK
 2027:	  2A23	D8 F3		keyAltGr1:	djnz	r0, keyAltGr2
 2028:	  2A25	80 0D				sjmp	keyExit
 2029:
 2030:	  2A27	12 2A 37	keyMake:	call	keygetnoshift
 2031:	  2A2A	30 0D 03			jnb	keyrxstrg, keyExitOK
 2032:	  2A2D	C3				clr	c
 2033:	  2A2E	94 60				subb	a, #96
 2034:
 2035:	  2A30	F5 3B		keyExitOK:	mov	keyrxval, a
 2036:	  2A32	D2 08				setb	keyavail
 2037:
 2038:				;		mov	p2, #High(08000h + 24*160 + 77*2)
 2039:				;		mov	r0, #Low(08000h + 24*160 + 77*2);
 2040:				;		movx	@r0, a
 2041:
 2042:	  2A34	D0 00		keyExit:	pop	ar0
 2043:	  2A36	22				ret
 2044:
 2045:
 2046:	  2A37	E5 3B		keygetnoshift:	mov	a, keyrxval
 2047:	  2A39	04				inc	a

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 38



 Line  I  Addr  Code            Source

 2048:	  2A3A	83				movc	a, @a+pc
 2049:	  2A3B	22				ret
 2050:	  2A3C			CHARTABLE_NOSHIFT:
 2051:				;		 	 00   01   02   03   04   05   06   07   08   09   0A   0B   0C   0D   0E
				0F
 2052:	  2A3C	00 88 00 84			db	  0,  F9,   0,  F5,  F3,  F1,  F2, F12,   0, F10,  F8,  F6,  F4,TABU, '^',
	  2A40	82 80 81 8B	 0	; 00
	  2A44	00 89 87 85
	  2A48	83 09 5E 00
 2053:	  2A4C	00 00 00 00			db     	  0,   0,   0,   0,   0, 'q', '1',   0,   0,   0, 'y', 's', 'a', 'w', '2',
	  2A50	00 71 31 00	 0	; 10
	  2A54	00 00 79 73
	  2A58	61 77 32 00
 2054:	  2A5C	00 63 78 64			db	  0, 'c', 'x', 'd', 'e', '4', '3',   0,   0, ' ', 'v', 'f', 't', 'r', '5',
	  2A60	65 34 33 00	 0	; 20
	  2A64	00 20 76 66
	  2A68	74 72 35 00
 2055:	  2A6C	00 6E 62 68			db	  0, 'n', 'b', 'h', 'g', 'z', '6',   0,   0,   0, 'm', 'j', 'u', '7', '8',
	  2A70	67 7A 36 00	 0	; 30
	  2A74	00 00 6D 6A
	  2A78	75 37 38 00
 2056:	  2A7C	00 2C 6B 69			db	  0, ',', 'k', 'i', 'o', '0', '9',   0,   0, '.', '-', 'l', 246, 'p', 223,
	  2A80	6F 30 39 00	 0	; 40 	5c = \, 223 = ß
	  2A84	00 2E 2D 6C
	  2A88	F6 70 DF 00
 2057:	  2A8C	00 00 E4 58			db	  0,   0, 228,  'X',252, 180,   0,   0,   0,   0,C_CR, '+',   0, '#',   0,
	  2A90	FC B4 00 00	 0	; 50
	  2A94	00 00 0D 2B
	  2A98	00 23 00 00
 2058:	  2A9C	00 3C 00 00			db	  0, '<',   0,   0,   0,   0,C_DEL,  0,   0, '1',   0, '4', '7',   0,   0,
	  2AA0	00 00 7F 00	 0	; 60
	  2AA4	00 31 00 34
	  2AA8	37 00 00 00
 2059:	  2AAC	30 2E 32 35			db	 '0', '.', '2', '5', '6', '8',ESC,   0, F11, '+', '3', '-', '*', '9', CLS,
	  2AB0	36 38 1B 00	 0	; 70
	  2AB4	8A 2B 33 2D
	  2AB8	2A 39 01 00
 2060:	  2ABC	00 00 00 86			db	  0,   0,   0,  F7,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
	  2AC0	00 00 00 00	 0	; 80
	  2AC4	00 00 00 00
	  2AC8	00 00 00 00
 2061:
 2062:	  2ACC	E5 3B		keygetshift:	mov	a, keyrxval
 2063:	  2ACE	04				inc	a
 2064:	  2ACF	83				movc	a, @a+pc
 2065:	  2AD0	22				ret
 2066:	  2AD1			CHARTABLE_SHIFT:
 2067:				;		 	 00   01   02   03   04   05   06   07   08   09   0A   0B   0C   0D   0E
				0F
 2068:	  2AD1	00 09 00 05			db	  0,   9,   0,   5,   3,   1,   2,  12,   0,  10,   8,   6,   4,TABU,0B0h,
	  2AD5	03 01 02 0C	 0	; 00
	  2AD9	00 0A 08 06
	  2ADD	04 09 B0 00
 2069:	  2AE1	00 00 00 00			db        0,   0,   0,   0,   0, 'Q', '!',   0,   0,   0, 'Y', 'S', 'A', 'W', '"',
	  2AE5	00 51 21 00	 0	; 10
	  2AE9	00 00 59 53

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 39



 Line  I  Addr  Code            Source

	  2AED	41 57 22 00
 2070:	  2AF1	00 43 58 44			db	  0, 'C', 'X', 'D', 'E', '$', 167,   0,   0, ' ', 'V', 'F', 'T', 'R', '%',
	  2AF5	45 24 A7 00	 0	; 20 	167=§
	  2AF9	00 20 56 46
	  2AFD	54 52 25 00
 2071:	  2B01	00 4E 42 48			db	  0, 'N', 'B', 'H', 'G', 'Z', '&',   0,   0,   0, 'M', 'J', 'U', '/', '(',
	  2B05	47 5A 26 00	 0	; 30
	  2B09	00 00 4D 4A
	  2B0D	55 2F 28 00
 2072:	  2B11	00 3B 4B 49			db	  0, ';', 'K', 'I', 'O', '=', ')',   0,   0, ':', '_', 'L', 214, 'P', '?',
	  2B15	4F 3D 29 00	 0	; 40
	  2B19	00 3A 5F 4C
	  2B1D	D6 50 3F 00
 2073:	  2B21	00 00 C4 00			db	  0,   0, 196,   0, 220, '`',   0,   0,   0,   0,  LF, '*',   0,027h,   0,
	  2B25	DC 60 00 00	 0	; 50
	  2B29	00 00 0A 2A
	  2B2D	00 27 00 00
 2074:	  2B31	00 3E 00 00			db	  0, '>',   0,   0,   0,   0,CDCH,   0,   0, '1',   0, CCLF, '7',   0,  0,
	  2B35	00 00 FE 00	 0	; 60
	  2B39	00 31 00 1E
	  2B3D	37 00 00 00
 2075:	  2B41	30 2E 1D 35			db	'0', '.', CCDN, '5', CCRT, CCUP,  0,   0,  11, '+', '3', '-', '*', '9', 0,
	  2B45	1F 1C 00 00	 0  ; 70
	  2B49	0B 2B 33 2D
	  2B4D	2A 39 00 00
 2076:	  2B51	00 00 00 07			db	  0,   0,   0,   7,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,    0,
	  2B55	00 00 00 00	 0	; 80
	  2B59	00 00 00 00
	  2B5D	00 00 00 00
 2077:
 2078:
 2079:	  2B61	E8		keygetaltgrind:	mov	a, r0
 2080:	  2B62	83				movc	a, @a+pc
 2081:	  2B63	22				ret
 2082:	  2B64			ALTGR_TABLE_IND:
 2083:	  2B64	15				db	015h	; q = @
 2084:	  2B65	61				db	061h	; <> = |
 2085:	  2B66	5B				db	05Bh	; *+ = ~
 2086:	  2B67	4E				db	04Eh	; ?ß = \
 2087:	  2B68	3E				db	03Eh	; 8( = [
 2088:	  2B69	46				db	046h	; 9) = ]
 2089:	  2B6A	3D				db	03Dh	; 7/ = {
 2090:	  2B6B	45				db	045h	; 0= = }
 2091:
 2092:
 2093:	  2B6C	E8		keygetaltgr:	mov	a, r0
 2094:	  2B6D	83				movc	a, @a+pc
 2095:	  2B6E	22				ret
 2096:	  2B6F	40		ALTGR_TABLE:	db	'@'
 2097:	  2B70	7C				db	'|'
 2098:	  2B71	7E				db	'~'
 2099:	  2B72	5C				db	05Ch
 2100:	  2B73	5B				db	'['
 2101:	  2B74	5D				db	']'
 2102:	  2B75	7B				db	'{'
 2103:	  2B76	7D				db	'}'

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 40



 Line  I  Addr  Code            Source

 2104:
 2105:
 2106:	  2B77	E8		keygetextind:	mov	a, r0
 2107:	  2B78	83				movc	a, @a+pc
 2108:	  2B79	22				ret
 2109:	  2B7A	11		EXT_TABLE_IND:	db	ALTGR
 2110:	  2B7B	4A				db	04Ah	; /
 2111:	  2B7C	5A				db	05Ah	; ENTER
 2112:	  2B7D	69				db	069h	; END
 2113:	  2B7E	6B				db	06Bh	; LEFT
 2114:	  2B7F	6C				db	06Ch	; HOME
 2115:	  2B80	70				db	070h	; INS
 2116:	  2B81	71				db	071h	; DEL
 2117:	  2B82	72				db	072h	; DOWN
 2118:	  2B83	74				db	074h	; RIGHT
 2119:	  2B84	75				db	075h	; Up
 2120:	  2B85	7A				db	07Ah	; PAGE DOWN
 2121:	  2B86	7D				db	07Dh	; PAGE UP
 2122:
 2123:	  2B87	E8		keygetext:	mov	a, r0
 2124:	  2B88	83				movc	a, @a+pc
 2125:	  2B89	22				ret
 2126:	  2B8A	11		EXT_TABLE:	db	ALTGR
 2127:	  2B8B	2F				db	'/'	; NumPad division symbol
 2128:	  2B8C	0D				db	C_CR	; ENTER
 2129:	  2B8D	1D				db	CCBT	; cursor bottom with SuperFlag
 2130:	  2B8E	13				db	19	; cursor left	CTRL-S
 2131:	  2B8F	1C				db	CCHM	; cursor home with SuperFLag
 2132:	  2B90	16				db	22	; insert	CTRL-V
 2133:	  2B91	07				db	7	; delete	CTRL-G
 2134:	  2B92	18				db	24	; cursor down	CTRL-X
 2135:	  2B93	04				db	4	; cursor right	CTRL-D
 2136:	  2B94	05				db	5	; cursor up	CTRL-E
 2137:	  2B95	03				db	3	; pagedown CTRL-C
 2138:	  2B96	12				db	18	; pageup CTRL-R
 2139:				;
 2140:				;
 2141:				;
 2142:	  2B97	E8		getbaud:	mov	a, r0
 2143:	  2B98	04				inc	a
 2144:	  2B99	83				movc	a, @a+pc
 2145:	  2B9A	22				ret
 2146:	  2B9B	FF				db	0ffh	;115200
 2147:	  2B9C	F4				db	0f4h	;9600
 2148:	  2B9D	FA				db	0fah	;19200
 2149:	  2B9E	FD				db	0fdh	;38400
 2150:	  2B9F	FE				db	0feh	;57600
 2151:
 2152:	  2BA0	83		getbdtxt:	movc	a, @a+pc
 2153:	  2BA1	22				ret
 2154:	  2BA2	31 31 35 32			db	"1152"
 2155:	  2BA6	20 20 39 36			db	"  96"
 2156:	  2BAA	20 31 39 32			db	" 192"
 2157:	  2BAE	20 33 38 34			db	" 384"
 2158:	  2BB2	20 35 37 36			db	" 576"
 2159:

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 41



 Line  I  Addr  Code            Source

 2160:				;
 2161:				;
 2162:	  2BB6			prtstatus:
 2163:				;		mov	dptr, #08000h + 20 * WIDTH * 2
 2164:				;		mov	r0, #0
 2165:				;prtstatus6:	mov	a, r0
 2166:				;		movx	@dptr, a
 2167:				;		inc	dptr
 2168:				;		mov	a, #070h
 2169:				;		movx	@dptr, a
 2170:				;		inc	dptr
 2171:				;		inc	r0
 2172:				;		cjne	r0, #0, prtstatus6
 2173:
 2174:	  2BB6	90 8F 00			mov	dptr, #08000h + 24 * WIDTH * 2
 2175:	  2BB9	78 01				mov	r0, #1
 2176:	  2BBB	71 FC		prtstatus1:	acall	getstatus			;get status line
 2177:	  2BBD	F0				movx	@dptr, a
 2178:	  2BBE	A3				inc	dptr
 2179:	  2BBF	74 06				mov	a, #06h				;color turquoise
 2180:	  2BC1	F0				movx	@dptr, a
 2181:	  2BC2	A3				inc	dptr
 2182:	  2BC3	08				inc	r0
 2183:	  2BC4	B8 51 F4			cjne	r0, #81, prtstatus1
 2184:
 2185:	  2BC7	90 8F 10			mov	dptr, #08000h + 24 * WIDTH * 2 + 8 * 2
 2186:	  2BCA	E5 3D				mov	a, baudidx
 2187:	  2BCC	23				rl	a				;mul2
 2188:	  2BCD	23				rl	a				;mul4
 2189:	  2BCE	04				inc	a
 2190:	  2BCF	F8				mov	r0, a
 2191:	  2BD0	79 00				mov	r1, #0
 2192:	  2BD2	71 A0		prtbaud:	call	getbdtxt
 2193:	  2BD4	F0				movx	@dptr, a
 2194:	  2BD5	A3				inc	dptr
 2195:	  2BD6	A3				inc	dptr
 2196:	  2BD7	08				inc	r0
 2197:	  2BD8	E8				mov	a, r0
 2198:	  2BD9	09				inc	r1
 2199:	  2BDA	B9 04 F5			cjne	r1, #4, prtbaud
 2200:
 2201:	  2BDD	74 FB				mov	a, #251				;Haken
 2202:	  2BDF	30 12 04			jnb	newlinemode, prtstatus2
 2203:	  2BE2	90 8F 34			mov	dptr, #08000h + 24 * WIDTH * 2 + 26 * 2
 2204:	  2BE5	F0				movx	@dptr, a
 2205:	  2BE6	30 13 04	prtstatus2:	jnb	insert	, prtstatus3
 2206:	  2BE9	90 8F 4C			mov	dptr, #08000h + 24 * WIDTH * 2 + 38 * 2
 2207:	  2BEC	F0				movx	@dptr, a
 2208:	  2BED	30 11 04	prtstatus3:	jnb	origin, prtstatus4
 2209:	  2BF0	90 8F 64			mov	dptr, #08000h + 24 * WIDTH * 2 + 50 * 2
 2210:	  2BF3	F0				movx	@dptr, a
 2211:	  2BF4	30 10 04	prtstatus4:	jnb	wrap, prtstatus5
 2212:	  2BF7	90 8F 78			mov	dptr, #08000h + 24 * WIDTH * 2 + 60 * 2
 2213:	  2BFA	F0				movx	@dptr, a
 2214:	  2BFB	22		prtstatus5:	ret
 2215:

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 42



 Line  I  Addr  Code            Source

 2216:	  2BFC	E8		getstatus:	mov	a, r0
 2217:	  2BFD	83				movc	a, @a + pc
 2218:	  2BFE	22				ret
 2219:				;			"0         1         2         3         4         5         6         7
				     "
 2220:				;			"012345678901234567890123456789012345678901234567890123456789012345678901234
				56789
 2221:	  2BFF	7C 20 42 61	status:		db	"| Baud:     00 | Newline: - | Insert: - | Origin: - | Wrap: - |     VT102
	  2C03	75 64 3A 20	    |"
	  2C07	20 20 20 20
	  2C0B	30 30 20 7C
	  2C0F	20 4E 65 77
	  2C13	6C 69 6E 65
	  2C17	3A 20 2D 20
	  2C1B	7C 20 49 6E
	  2C1F	73 65 72 74
	  2C23	3A 20 2D 20
	  2C27	7C 20 4F 72
	  2C2B	69 67 69 6E
	  2C2F	3A 20 2D 20
	  2C33	7C 20 57 72
	  2C37	61 70 3A 20
	  2C3B	2D 20 7C 20
	  2C3F	20 20 20 20
	  2C43	56 54 31 30
	  2C47	32 20 20 20
	  2C4B	20 20 20 7C
 2222:						END





                     register banks used:  0

                     no errors




ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 43





	       L I S T   O F   S Y M B O L S
	       =============================


SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
??ASEM_51			  NUMBER    8051
??VERSION			  NUMBER    0130
AC				  BIT	      D6	 102
ACC				  DATA	      E0	  44
ALR				  NUMBER    0011	 184
ALTGR				  NUMBER    0011	 183
ALTGR_TABLE			  CODE	    2B6F	2096
ALTGR_TABLE_IND			  CODE	    2B64	2082
ANSIOUT				  CODE	    21D5	 486
ANSIOUT1			  CODE	    21DD	 492
ANSIOUT2			  CODE	    21E4	 496
ANSI_MOVE			  CODE	    26A2	1239
ANSI_MOVE_EX			  CODE	    26F4	1302
ANSI_MOVE_M1			  CODE	    26C9	1268
ANSI_MOVE_X1			  CODE	    26AF	1253
ANSI_MOVE_X3			  CODE	    26B6	1256
ANSI_MOVE_Y			  CODE	    26CE	1276
ANSI_MOVE_Y1			  CODE	    26DD	1286
ANSI_MOVE_Y2			  CODE	    26D9	1281
ANSI_MOVE_Y3			  CODE	    26E7	1292
ANSI_TAB			  CODE	    21E8	 500
ARG0				  NUMBER    0026	 234
ARG1				  NUMBER    0027	 235
ARG2				  NUMBER    0028	 236
ARG3				  NUMBER    0029	 237
ARGS_GR_ZERO			  CODE	    268E	1222
ARGS_GR_ZERO_1			  CODE	    269A	1228
ARGS_GR_ZERO_2			  CODE	    2696	1226
AUXR				  DATA	      8E	  27
AUXR1				  DATA	      A2	  32
B				  DATA	      F0	  45
BACK				  NUMBER    0008	 156
BAUDFLAG			  NUMBER    0014	 230
BAUDIDX				  NUMBER    003D	 257
BOTTOM				  NUMBER    0032	 246
BREAK				  NUMBER    00F0	 191
CCAPS				  NUMBER    0058	 188
CCBT				  NUMBER    001D	 149
CCDN				  NUMBER    001D	 161
CCHM				  NUMBER    001C	 148
CCLF				  NUMBER    001E	 162
CCLM				  NUMBER    001E	 150
CCRM				  NUMBER    001F	 151
CCRT				  NUMBER    001F	 163
CCUP				  NUMBER    001C	 160
CDCH				  NUMBER    00FE	 166
CHARTABLE_NOSHIFT		  CODE	    2A3C	2050
CHARTABLE_SHIFT			  CODE	    2AD1	2066
CHAR_OUT			  CODE	    227F	 599
CHAR_OUT_1			  CODE	    22E0	 660

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 44



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
CHAR_OUT_2			  CODE	    22B8	 637
CHAR_OUT_2A			  CODE	    22C6	 645
CHAR_OUT_2B			  CODE	    22CE	 649
CHAR_OUT_3			  CODE	    2295	 611
CHAR_OUT_4			  CODE	    22D5	 653
CICH				  NUMBER    00FF	 167
CILN				  NUMBER    009D	 165
CIN				  CODE	    2950	1867
CIN_1				  CODE	    2959	1871
CIN_2				  CODE	    2952	1868
CIN_3				  CODE	    2964	1877
CIN_4				  CODE	    2976	1895
CIN_5				  CODE	    2969	1885
CIN_7				  CODE	    2971	1890
CLEARARGS			  CODE	    276F	1402
CLEARARGS1			  CODE	    2773	1404
CLEARTABU			  CODE	    2747	1369
CLEARTABU1			  CODE	    274B	1371
CLEAR_LINES			  CODE	    2817	1564
CLEAR_LINES1			  CODE	    2838	1591
CLEAR_LINES2			  CODE	    2833	1589
CLEAR_SCREEN			  CODE	    280A	1555
CLEAR_V1			  CODE	    2733	1353
CLEAR_VARS			  CODE	    272F	1351
CLS				  NUMBER    0001	 155
CLSHIFT				  NUMBER    0012	 185
CLSTRG				  NUMBER    0014	 186
COLOR				  NUMBER    002D	 241
COMP_DPTR			  CODE	    288E	1673
COPYFONT			  CODE	    28ED	1785
COPYFONT1			  CODE	    28F7	1791
COUT				  CODE	    2940	1856
COUT_X				  CODE	    2948	1862
CPRL2				  BIT	      C8	  89
CRSHIFT				  NUMBER    0059	 187
CSPACE				  NUMBER    0020	 164
CT2				  BIT	      C9	  90
CURSORPOS			  NUMBER    002E	 242
CURSORPOS1			  NUMBER    002F	 243
CURSORSAVE			  NUMBER    0030	 244
CURSORX				  NUMBER    0037	 251
CURSORY				  NUMBER    0038	 252
CURSOR_OFF			  CODE	    286B	1640
CURSOR_ON			  CODE	    2859	1620
CY				  BIT	      D7	 103
C_BACKSP			  NUMBER    0008	 135
C_BELL				  NUMBER    0007	 134
C_CR				  NUMBER    000D	 140
C_DEL				  NUMBER    007F	 146
C_ESC				  NUMBER    001B	 145
C_FF				  NUMBER    000C	 139
C_NEWLINE			  NUMBER    000A	 137
C_SI				  NUMBER    000F	 142
C_SO				  NUMBER    000E	 141
C_TAB				  NUMBER    0009	 136
C_TIME				  NUMBER    000A	 132

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 45



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
C_VT				  NUMBER    000B	 138
C_XOFF				  NUMBER    0013	 144
C_XON				  NUMBER    0011	 143
DECANM				  NUMBER    0002	 195
DECARM				  NUMBER    0008	 201
DECAWM				  NUMBER    0007	 200
DECCKM				  NUMBER    0001	 194
DECCOLM				  NUMBER    0003	 196
DECINLM				  NUMBER    0009	 202
DECOM				  NUMBER    0006	 199
DECSCLM				  NUMBER    0004	 197
DECSCNM				  NUMBER    0005	 198
DO_CMD_ARG			  CODE	    2665	1187
DO_CMD_ARG_1			  CODE	    267A	1203
DO_CMD_ARG_2			  CODE	    2680	1210
DO_CMD_ARG_3			  CODE	    2687	1213
DO_CMD_ARG_4			  CODE	    268C	1215
DO_CR				  CODE	    224A	 561
DO_CSI				  CODE	    2353	 733
DO_CSI_B			  CODE	    2373	 753
DO_CSI_C			  CODE	    237C	 759
DO_CSI_CC			  CODE	    246F	 883
DO_CSI_CC1			  CODE	    2474	 885
DO_CSI_CC2			  CODE	    2472	 884
DO_CSI_D			  CODE	    2385	 765
DO_CSI_END			  CODE	    25FF	1091
DO_CSI_END1			  CODE	    252E	 980
DO_CSI_G			  CODE	    2530	 982
DO_CSI_G1			  CODE	    253A	 986
DO_CSI_H			  CODE	    2391	 774
DO_CSI_H1			  CODE	    2396	 776
DO_CSI_H2			  CODE	    2399	 777
DO_CSI_HH			  CODE	    2598	1034
DO_CSI_HH1			  CODE	    25A9	1042
DO_CSI_HH2			  CODE	    25AE	1044
DO_CSI_HHX			  CODE	    25B3	1046
DO_CSI_J			  CODE	    24C5	 928
DO_CSI_JA			  CODE	    24CA	 930
DO_CSI_JB			  CODE	    24DC	 940
DO_CSI_JC			  CODE	    24CD	 931
DO_CSI_JD			  CODE	    24ED	 949
DO_CSI_K			  CODE	    2504	 961
DO_CSI_KA			  CODE	    2519	 971
DO_CSI_KB			  CODE	    2524	 976
DO_CSI_KEYS			  CODE	    2360	 740
DO_CSI_L			  CODE	    2543	 993
DO_CSI_L1			  CODE	    2556	1001
DO_CSI_L2			  CODE	    255B	1003
DO_CSI_LL			  CODE	    25B7	1050
DO_CSI_LL1			  CODE	    25C2	1055
DO_CSI_LL2			  CODE	    25C7	1057
DO_CSI_LLX			  CODE	    25CC	1059
DO_CSI_M			  CODE	    23BC	 799
DO_CSI_MA			  CODE	    23CA	 805
DO_CSI_MB			  CODE	    23DA	 812
DO_CSI_MC			  CODE	    23CC	 806

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 46



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
DO_CSI_MD			  CODE	    23D7	 811
DO_CSI_ME			  CODE	    23DE	 814
DO_CSI_MF			  CODE	    23E1	 815
DO_CSI_MG			  CODE	    23F0	 824
DO_CSI_MH			  CODE	    23F7	 827
DO_CSI_MM			  CODE	    256A	1012
DO_CSI_MM1			  CODE	    257D	1020
DO_CSI_MM2			  CODE	    2584	1023
DO_CSI_MX			  CODE	    2408	 836
DO_CSI_MX1			  CODE	    240D	 838
DO_CSI_MX2			  CODE	    2413	 840
DO_CSI_MX3			  CODE	    2419	 842
DO_CSI_N			  CODE	    241D	 846
DO_CSI_N1			  CODE	    2427	 850
DO_CSI_N6			  CODE	    2433	 856
DO_CSI_P			  CODE	    25D0	1063
DO_CSI_P1			  CODE	    25EB	1078
DO_CSI_P2			  CODE	    25D7	1066
DO_CSI_Q			  CODE	    2600	1110
DO_CSI_QUES			  CODE	    24FD	 957
DO_CSI_Q_END			  CODE	    2648	1145
DO_CSI_Q_H			  CODE	    260C	1116
DO_CSI_Q_H1			  CODE	    261D	1124
DO_CSI_Q_H2			  CODE	    2622	1126
DO_CSI_Q_HX			  CODE	    2629	1129
DO_CSI_Q_L			  CODE	    262D	1133
DO_CSI_Q_L1			  CODE	    2639	1138
DO_CSI_Q_L2			  CODE	    263E	1140
DO_CSI_Q_LX			  CODE	    2645	1143
DO_CSI_R			  CODE	    247F	 892
DO_CSI_RA			  CODE	    248E	 898
DO_CSI_RB			  CODE	    249F	 905
DO_CSI_RC			  CODE	    24B6	 918
DO_CSI_RD			  CODE	    24C3	 925
DO_CSI_RE			  CODE	    24B3	 915
DO_CSI_S			  CODE	    23A7	 787
DO_CSI_U			  CODE	    23B1	 793
DO_ESC				  CODE	    22F3	 675
DO_ESC_7			  CODE	    2303	 683
DO_ESC_8			  CODE	    230D	 688
DO_ESC_C			  CODE	    233E	 715
DO_ESC_CSI			  CODE	    22FC	 679
DO_ESC_D			  CODE	    2319	 693
DO_ESC_EX			  CODE	    2352	 728
DO_ESC_H			  CODE	    2343	 718
DO_ESC_HA			  CODE	    2329	 703
DO_ESC_HASH			  CODE	    264D	1158
DO_ESC_HASH_END			  CODE	    2658	1164
DO_ESC_LBR			  CODE	    2330	 707
DO_ESC_LBRACK			  CODE	    2659	1175
DO_ESC_LB_1			  CODE	    2662	1180
DO_ESC_M			  CODE	    2321	 698
DO_ESC_Q			  CODE	    2649	1151
DO_ESC_RBR			  CODE	    2337	 711
DO_ESC_RBRACK			  CODE	    2659	1171
DO_ESC_Z			  CODE	    234D	 725

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 47



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
DO_IDLE				  CODE	    21FA	 507
DO_IDLE_BS			  CODE	    2213	 526
DO_IDLE_CR			  CODE	    2247	 560
DO_IDLE_DEL			  CODE	    2204	 516
DO_IDLE_END			  CODE	    2271	 584
DO_IDLE_ESC			  CODE	    2253	 566
DO_IDLE_FF			  CODE	    226C	 581
DO_IDLE_NL			  CODE	    223D	 554
DO_IDLE_PRE			  CODE	    220A	 520
DO_IDLE_SI			  CODE	    2261	 574
DO_IDLE_SO			  CODE	    225B	 570
DO_IDLE_TAB			  CODE	    2219	 530
DO_IDLE_TAB1			  CODE	    2233	 545
DO_IDLE_TAB2			  CODE	    2238	 548
DO_IDLE_TAB3			  CODE	    221E	 532
DO_IDLE_VT			  CODE	    2267	 578
DO_NEWLINE			  CODE	    2240	 555
DP0H				  DATA	      83	  17
DP0L				  DATA	      82	  16
DP1H				  DATA	      85	  19
DP1L				  DATA	      84	  18
DPH				  NUMBER    0083	 116
DPL				  NUMBER    0082	 117
DRAW_CHAR			  CODE	    2271	 588
DRAW_CHAR_1			  CODE	    22EA	 667
DRAW_CURSOR			  CODE	    284B	1608
DUMMY				  NUMBER    002A	 238
EA				  BIT	      AF	  74
ES				  BIT	      AC	  72
ESC				  NUMBER    001B	 159
ET0				  BIT	      A9	  69
ET1				  BIT	      AB	  71
ET2				  BIT	      AD	  73
EX0				  BIT	      A8	  68
EX1				  BIT	      AA	  70
EXEN2				  BIT	      CB	  92
EXF2				  BIT	      CE	  95
EXINT0				  CODE	    2079	 346
EXINT0A				  CODE	    209A	 363
EXINT0B				  CODE	    2084	 353
EXINT0EX			  CODE	    20A1	 368
EXTENDED			  NUMBER    00E0	 190
EXTI0				  CODE	    0003	 106
EXTI1				  CODE	    0013	 108
EXT_TABLE			  CODE	    2B8A	2126
EXT_TABLE_IND			  CODE	    2B7A	2109
F0				  BIT	      D5	 101
F1				  NUMBER    0080	 169
F10				  NUMBER    0089	 178
F11				  NUMBER    008A	 179
F12				  NUMBER    008B	 180
F2				  NUMBER    0081	 170
F3				  NUMBER    0082	 171
F4				  NUMBER    0083	 172
F5				  NUMBER    0084	 173
F6				  NUMBER    0085	 174

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 48



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
F7				  NUMBER    0086	 175
F8				  NUMBER    0087	 176
F9				  NUMBER    0088	 177
FILL_LINES			  CODE	    2819	1566
FILL_SCREEN			  CODE	    280C	1556
FLAGS				  NUMBER    0020	 209
FLAGS1				  NUMBER    0021	 217
FLAGS2				  NUMBER    0022	 225
FREE0				  NUMBER    005A	 263
FREE1				  NUMBER    005B	 264
FREE2				  NUMBER    005C	 265
FREE3				  NUMBER    005D	 266
FREE4				  NUMBER    005E	 267
FREE5				  NUMBER    005F	 268
GETBAUD				  CODE	    2B97	2142
GETBDTXT			  CODE	    2BA0	2152
GETBIT				  CODE	    2763	1395
GETBITTAB			  CODE	    2767	1399
GETREPORT			  CODE	    2462	 878
GETSTATUS			  CODE	    2BFC	2216
HARDWARE			  NUMBER    0001	 113
HEIGHT				  NUMBER    0018	 120
HEX2DEZ				  CODE	    2881	1660
IE				  DATA	      A8	  34
IE0				  BIT	      89	  48
IE1				  BIT	      8B	  50
INIT				  CODE	    2157	 414
INIT6845			  CODE	    28A2	1693
INIT_1				  CODE	    2177	 431
INIT_2				  CODE	    2182	 438
INIT_LOOP			  CODE	    216F	 427
INSERT				  NUMBER    0013	 229
INT0				  BIT	      B2	  77
INT1				  BIT	      B3	  78
INVERSE				  NUMBER    0003	 213
IP				  DATA	      B8	  36
IRM				  NUMBER    0004	 203
ISDIGIT				  CODE	    2703	1320
ISDIGIT1			  CODE	    2706	1321
ISDIGIT2			  CODE	    270A	1324
ISDIGIT3			  CODE	    270D	1325
ISPARM				  CODE	    26F8	1309
ISPARM1				  CODE	    2701	1314
ISPARMEX			  CODE	    2700	1313
IT0				  BIT	      88	  47
IT1				  BIT	      8A	  49
KEYALTGR			  CODE	    2A13	2021
KEYALTGR1			  CODE	    2A23	2027
KEYALTGR2			  CODE	    2A18	2023
KEYAVAIL			  NUMBER    0008	 218
KEYBREAK			  CODE	    29B6	1973
KEYCHECKBRK			  CODE	    29DD	1995
KEYCHECKBRK1			  CODE	    29E7	1999
KEYDECODE			  CODE	    29AE	1965
KEYEXIT				  CODE	    2A34	2042
KEYEXITOK			  CODE	    2A30	2035

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 49



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
KEYGETALTGR			  CODE	    2B6C	2093
KEYGETALTGRIND			  CODE	    2B61	2079
KEYGETEXT			  CODE	    2B87	2123
KEYGETEXTIND			  CODE	    2B77	2106
KEYGETNOSHIFT			  CODE	    2A37	2046
KEYGETSHIFT			  CODE	    2ACC	2062
KEYMAKE				  CODE	    2A27	2030
KEYMAKEEXT			  CODE	    29F6	2008
KEYMAKEEXT1			  CODE	    2A0F	2018
KEYMAKEEXT2			  CODE	    29FD	2011
KEYMAKEEXT3			  CODE	    2A0D	2017
KEYNORMAL			  CODE	    29EC	2003
KEYRXALTGR			  NUMBER    000C	 222
KEYRXBREAK			  NUMBER    000A	 220
KEYRXCNT			  NUMBER    003A	 254
KEYRXEXTENDED			  NUMBER    0009	 219
KEYRXSHIFT			  NUMBER    000B	 221
KEYRXSTRG			  NUMBER    000D	 223
KEYRXVAL			  NUMBER    003B	 255
KEYSHIFT			  CODE	    29BE	1978
KEYSHIFT1			  CODE	    29C5	1981
KEYSHIFT2			  CODE	    29CA	1983
KEYSTRG				  CODE	    29D1	1988
LASTCHAR			  NUMBER    0001	 211
LCHARTMP			  NUMBER    0002	 212
LF				  NUMBER    000A	 158
LNM				  NUMBER    0014	 204
LOCAT				  NUMBER    2100	 374
LOOP_CIN			  CODE	    21C1	 472
LOOP_TEST			  CODE	    217A	 433
MAIN_COUT			  CODE	    21AC	 462
MAIN_F6				  CODE	    2192	 449
MAIN_F6A			  CODE	    219D	 454
MAIN_LOOP			  CODE	    2186	 444
MAIN_SERIN			  CODE	    21BA	 468
MAIN_STATUS			  CODE	    21D0	 479
MISO				  BIT	      96	  58
MOSI				  BIT	      95	  57
MOVE_CURSOR			  CODE	    2848	1607
NARGS				  NUMBER    0025	 233
NEWLINE				  CODE	    2936	1849
NEWLINEMODE			  NUMBER    0012	 228
OLDSTATUS			  NUMBER    003C	 256
ORIGIN				  NUMBER    0011	 227
OV				  BIT	      D2	  98
P				  BIT	      D0	  97
P0				  DATA	      80	  14
P1				  DATA	      90	  28
P2				  DATA	      A0	  31
P3				  DATA	      B0	  35
PCON				  DATA	      87	  20
PHEX				  CODE	    297B	1908
PHEX1				  CODE	    297E	1912
PHEX16				  CODE	    298D	1922
PHEX8				  CODE	    297B	1909
PHEX_B				  CODE	    297D	1911

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 50



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
PRINT				  CODE	    2779	1410
PRINT1				  CODE	    277E	1414
PRTBAUD				  CODE	    2BD2	2192
PRTSTATUS			  CODE	    2BB6	2162
PRTSTATUS1			  CODE	    2BBB	2176
PRTSTATUS2			  CODE	    2BE6	2205
PRTSTATUS3			  CODE	    2BED	2208
PRTSTATUS4			  CODE	    2BF4	2211
PRTSTATUS5			  CODE	    2BFB	2214
PS				  BIT	      BC	  87
PSTR				  CODE	    299A	1936
PSTR1				  CODE	    299C	1937
PSTR2				  CODE	    29AB	1946
PSW				  DATA	      D0	  43
PT0				  BIT	      B9	  84
PT1				  BIT	      BB	  86
PT2				  BIT	      BD	  88
PX0				  BIT	      B8	  83
PX1				  BIT	      BA	  85
RB8				  BIT	      9A	  62
RCAP2H				  DATA	      CB	  40
RCAP2L				  DATA	      CA	  39
RCLK				  BIT	      CD	  94
RD				  BIT	      B7	  82
REN				  BIT	      9C	  64
REPORTDA			  CODE	    2468	 881
REPORTOK			  CODE	    2464	 880
RESET				  CODE	    0000	 105
RESETTABU			  CODE	    2739	1359
RESETTABU1			  CODE	    273D	1361
RETSTATE			  NUMBER    0023	 232
RI				  BIT	      98	  60
RS0				  BIT	      D3	  99
RS1				  BIT	      D4	 100
RXD				  BIT	      B0	  75
SBUF				  DATA	      99	  30
SCK				  BIT	      97	  59
SCON				  DATA	      98	  29
SCROLL				  CODE	    2783	1435
SCROLL_DOWN_1			  CODE	    27B0	1471
SCROLL_DOWN_2			  CODE	    27BE	1481
SCROLL_DOWN_3			  CODE	    27C6	1486
SCROLL_DOWN_4			  CODE	    27AE	1469
SCROLL_DOWN_5			  CODE	    27D0	1497
SCROLL_DOWN_6			  CODE	    27CD	1494
SCROLL_R4			  CODE	    2789	1439
SCROLL_UP			  CODE	    27D5	1504
SCROLL_UP_1			  CODE	    27F2	1523
SCROLL_UP_2			  CODE	    27F4	1526
SCROLL_UP_3			  CODE	    2805	1539
SCROLL_UP_4			  CODE	    2802	1536
SCURSORX			  NUMBER    002B	 239
SCURSORY			  NUMBER    002C	 240
SENDPOS				  CODE	    2456	 871
SERBUF				  NUMBER    0040	 259
SERBUSY				  NUMBER    0005	 215

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 51



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
SERCOUNT			  NUMBER    0036	 250
SEREND				  NUMBER    0035	 249
SERINT				  CODE	    2023	 283
SERINT1				  CODE	    2038	 295
SERINTEX			  CODE	    2055	 310
SERINTTI			  CODE	    204E	 306
SERSTART			  NUMBER    0034	 248
SETREGS				  CODE	    28B2	1703
SINT				  CODE	    0023	 110
SM0				  BIT	      9F	  67
SM1				  BIT	      9E	  66
SM2				  BIT	      9D	  65
SP				  DATA	      81	  15
SPACE				  CODE	    292C	1843
SPECIAL				  NUMBER    0000	 210
STACK				  NUMBER    0080	 115
START				  CODE	    2140	 391
STATE				  NUMBER    0033	 247
STATUS				  CODE	    2BFF	2221
ST_CMD_ARG			  NUMBER    000A	 127
ST_CSI				  NUMBER    0004	 124
ST_CSI_Q			  NUMBER    000E	 129
ST_ESC				  NUMBER    0002	 123
ST_ESC_HASH			  NUMBER    0008	 126
ST_ESC_LBRACK			  NUMBER    000C	 128
ST_ESC_Q			  NUMBER    0006	 125
ST_ESC_RBRACK			  NUMBER    0010	 130
ST_IDLE				  NUMBER    0000	 122
SYDATA				  CODE	    28D9	1761
T0				  BIT	      B4	  79
T0CNT				  NUMBER    0039	 253
T1				  BIT	      B5	  80
T2				  BIT	      90	  55
T2CON				  DATA	      C8	  37
T2EX				  BIT	      91	  56
T2MOD				  DATA	      C9	  38
TABU				  NUMBER    0009	 157
TABUTAB				  NUMBER    0050	 261
TAB_SET_R0_R1			  CODE	    2753	1382
TB8				  BIT	      9B	  63
TCLK				  BIT	      CC	  93
TCON				  DATA	      88	  21
TERM_RESET			  CODE	    270E	1332
TESTSCREEN			  CODE	    2906	1811
TESTSCREEN1			  CODE	    290F	1816
TESTSCREEN2			  CODE	    291C	1828
TESTSCREEN3			  CODE	    290B	1814
TESTSCREEN4			  CODE	    2920	1831
TF0				  BIT	      8D	  52
TF1				  BIT	      8F	  54
TF2				  BIT	      CF	  96
TH0				  DATA	      8C	  25
TH1				  DATA	      8D	  26
TH2				  DATA	      CD	  42
TI				  BIT	      99	  61
TIMER0				  CODE	    000B	 107

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 52



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
TIMER0INT			  CODE	    205C	 320
TIMER0INT_EX			  CODE	    2078	 336
TIMER1				  CODE	    001B	 109
TIMER2				  CODE	    002B	 111
TL0				  DATA	      8A	  23
TL1				  DATA	      8B	  24
TL2				  DATA	      CC	  41
TMOD				  DATA	      89	  22
TOP				  NUMBER    0031	 245
TR0				  BIT	      8C	  51
TR1				  BIT	      8E	  53
TR2				  BIT	      CA	  91
TXD				  BIT	      B1	  76
VARS				  NUMBER    0020	 207
WDTRST				  DATA	      A6	  33
WIDTH				  NUMBER    0050	 119
WR				  BIT	      B6	  81
WRAP				  NUMBER    0010	 226
XONOFF				  NUMBER    0004	 214
