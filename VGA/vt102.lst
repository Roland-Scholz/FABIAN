
ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 1





       MCS-51 Family Macro Assembler   A S E M - 5 1   V 1.3
       =====================================================



	Source File:	C:\github\FABIAN\VGA\vt102.a51
	Object File:	C:\github\FABIAN\VGA\vt102.hex
	List File:	C:\github\FABIAN\VGA\vt102.lst



 Line  I  Addr  Code            Source

    1:				;===============================================
    2:				; AT89S52 code for emulating a VT102 terminal
    3:				; 2023-24 Roland Scholz (rolandscholz@gmx.de)
    4:				; no warranties
    5:				; do whatever you want with this code
    6:				; assembled with M-IDE Studio for MCS-51
    7:				;===============================================
    8:
    9:						$NOMOD51
   10:						$INCLUDE (89S52.MCU)
   11: 1			;   AT89S52 processor definition file
   12: 1			;   =================================
   13: 1
   14: 1	N	 80	P0	DATA	080H
   15: 1	N	 81	SP	DATA	081H
   16: 1	N	 82	DP0L	DATA	082H
   17: 1	N	 83	DP0H	DATA	083H
   18: 1	N	 84	DP1L	DATA	084H
   19: 1	N	 85	DP1H	DATA	085H
   20: 1	N	 87	PCON	DATA	087H
   21: 1	N	 88	TCON	DATA	088H
   22: 1	N	 89	TMOD	DATA	089H
   23: 1	N	 8A	TL0	DATA	08AH
   24: 1	N	 8B	TL1	DATA	08BH
   25: 1	N	 8C	TH0	DATA	08CH
   26: 1	N	 8D	TH1	DATA	08DH
   27: 1	N	 8E	AUXR	DATA	08EH
   28: 1	N	 90	P1	DATA	090H
   29: 1	N	 98	SCON	DATA	098H
   30: 1	N	 99	SBUF	DATA	099H
   31: 1	N	 A0	P2	DATA	0A0H
   32: 1	N	 A2	AUXR1	DATA	0A2H
   33: 1	N	 A6	WDTRST	DATA	0A6H
   34: 1	N	 A8	IE	DATA	0A8H
   35: 1	N	 B0	P3	DATA	0B0H
   36: 1	N	 B8	IP	DATA	0B8H
   37: 1	N	 C8	T2CON	DATA	0C8H
   38: 1	N	 C9	T2MOD	DATA	0C9H
   39: 1	N	 CA	RCAP2L	DATA	0CAH
   40: 1	N	 CB	RCAP2H	DATA	0CBH
   41: 1	N	 CC	TL2	DATA	0CCH
   42: 1	N	 CD	TH2	DATA	0CDH
   43: 1	N	 D0	PSW	DATA	0D0H

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 2



 Line  I  Addr  Code            Source

   44: 1	N	 E0	ACC	DATA	0E0H
   45: 1	N	 F0	B	DATA	0F0H
   46: 1
   47: 1	N	 88	IT0	BIT	088H
   48: 1	N	 89	IE0	BIT	089H
   49: 1	N	 8A	IT1	BIT	08AH
   50: 1	N	 8B	IE1	BIT	08BH
   51: 1	N	 8C	TR0	BIT	08CH
   52: 1	N	 8D	TF0	BIT	08DH
   53: 1	N	 8E	TR1	BIT	08EH
   54: 1	N	 8F	TF1	BIT	08FH
   55: 1	N	 90	T2	BIT	090H
   56: 1	N	 91	T2EX	BIT	091H
   57: 1	N	 95	MOSI	BIT	095H
   58: 1	N	 96	MISO	BIT	096H
   59: 1	N	 97	SCK	BIT	097H
   60: 1	N	 98	RI	BIT	098H
   61: 1	N	 99	TI	BIT	099H
   62: 1	N	 9A	RB8	BIT	09AH
   63: 1	N	 9B	TB8	BIT	09BH
   64: 1	N	 9C	REN	BIT	09CH
   65: 1	N	 9D	SM2	BIT	09DH
   66: 1	N	 9E	SM1	BIT	09EH
   67: 1	N	 9F	SM0	BIT	09FH
   68: 1	N	 A8	EX0	BIT	0A8H
   69: 1	N	 A9	ET0	BIT	0A9H
   70: 1	N	 AA	EX1	BIT	0AAH
   71: 1	N	 AB	ET1	BIT	0ABH
   72: 1	N	 AC	ES	BIT	0ACH
   73: 1	N	 AD	ET2	BIT	0ADH
   74: 1	N	 AF	EA	BIT	0AFH
   75: 1	N	 B0	RXD	BIT	0B0H
   76: 1	N	 B1	TXD	BIT	0B1H
   77: 1	N	 B2	INT0	BIT	0B2H
   78: 1	N	 B3	INT1	BIT	0B3H
   79: 1	N	 B4	T0	BIT	0B4H
   80: 1	N	 B5	T1	BIT	0B5H
   81: 1	N	 B6	WR	BIT	0B6H
   82: 1	N	 B7	RD	BIT	0B7H
   83: 1	N	 B8	PX0	BIT	0B8H
   84: 1	N	 B9	PT0	BIT	0B9H
   85: 1	N	 BA	PX1	BIT	0BAH
   86: 1	N	 BB	PT1	BIT	0BBH
   87: 1	N	 BC	PS	BIT	0BCH
   88: 1	N	 BD	PT2	BIT	0BDH
   89: 1	N	 C8	CPRL2	BIT	0C8H
   90: 1	N	 C9	CT2	BIT	0C9H
   91: 1	N	 CA	TR2	BIT	0CAH
   92: 1	N	 CB	EXEN2	BIT	0CBH
   93: 1	N	 CC	TCLK	BIT	0CCH
   94: 1	N	 CD	RCLK	BIT	0CDH
   95: 1	N	 CE	EXF2	BIT	0CEH
   96: 1	N	 CF	TF2	BIT	0CFH
   97: 1	N	 D0	P	BIT	0D0H
   98: 1	N	 D2	OV	BIT	0D2H
   99: 1	N	 D3	RS0	BIT	0D3H

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 3



 Line  I  Addr  Code            Source

  100: 1	N	 D4	RS1	BIT	0D4H
  101: 1	N	 D5	F0	BIT	0D5H
  102: 1	N	 D6	AC	BIT	0D6H
  103: 1	N	 D7	CY	BIT	0D7H
  104: 1
  105: 1	N      0000	RESET	CODE	000H
  106: 1	N      0003	EXTI0	CODE	003H
  107: 1	N      000B	TIMER0	CODE	00BH
  108: 1	N      0013	EXTI1	CODE	013H
  109: 1	N      001B	TIMER1	CODE	01BH
  110: 1	N      0023	SINT	CODE	023H
  111: 1	N      002B	TIMER2	CODE	02BH
  112:
  113:		N      0001	HARDWARE	equ	1
  114:
  115:		N      0080	stack		equ	80h
  116:		D      0083	dph		equ	DP0H
  117:		D      0082	dpl		equ	DP0L
  118:
  119:		N      0050	WIDTH		equ	80
  120:		N      0018	HEIGHT		equ	24
  121:
  122:		N      0000	ST_IDLE		equ	0
  123:		N      0002	ST_ESC		equ	2
  124:		N      0004	ST_CSI		equ	4
  125:		N      0006	ST_ESC_Q	equ	6
  126:		N      0008	ST_ESC_HASH	equ	8
  127:		N      000A	ST_CMD_ARG	equ	10
  128:		N      000C	ST_ESC_LBRACK	equ	12
  129:		N      000E	ST_CSI_Q	equ	14
  130:		N      0010	ST_ESC_RBRACK	equ	16
  131:
  132:		N      0000	BLACK		equ	0
  133:		N      0001	RED		equ	1
  134:		N      0002	GREEN		equ	2
  135:		N      0003	YELLOW		equ	3
  136:		N      0004	BLUE		equ	4
  137:		N      0005	MAGENTA		equ	5
  138:		N      0006	TURQUOISE	equ	6
  139:		N      0007	WHITE		equ	7
  140:
  141:		N      0070	DEFAULTCOLOR	equ	WHITE SHL 4 + BLACK
  142:
  143:		N      000A	C_TIME		equ	10
  144:
  145:		N      0007	C_BELL		equ	7
  146:		N      0008	C_BACKSP	equ	8
  147:		N      0009	C_TAB		equ	9
  148:		N      000A	C_NEWLINE	equ	10
  149:		N      000B	C_VT		equ	11
  150:		N      000C	C_FF		equ	12
  151:		N      000D	C_CR		equ	13
  152:		N      000E	C_SO		equ	14
  153:		N      000F	C_SI		equ	15
  154:		N      0011	C_XON		equ	17
  155:		N      0013	C_XOFF		equ	19

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 4



 Line  I  Addr  Code            Source

  156:		N      001B	C_ESC		equ	27
  157:		N      007F	C_DEL		equ	07fh
  158:
  159:		N      001C	CCHM		equ	01Ch	;move cursor home
  160:		N      001D	CCBT		equ	01Dh	;move cursor to bottom
  161:		N      001E	CCLM		equ	01Eh	;move cursor to left margin
  162:		N      001F	CCRM		equ	01Fh	;move cursor to right margin
  163:
  164:								;SUPERF equ 0
  165:
  166:		N      0001	CLS		equ	001h	;clear screen
  167:		N      0008	BACK		equ	008h	;backspace
  168:		N      0009	TABU		equ	009h	;tabulator
  169:		N      000A	LF		equ	00Ah	;$9B	;end of line (RETURN)
  170:		N      001B	ESC		equ	01Bh	;escape key
  171:		N      001C	CCUP		equ	01Ch	;cursor up
  172:		N      001D	CCDN		equ	01Dh	;cursor down
  173:		N      001E	CCLF		equ	01Eh	;cursor left
  174:		N      001F	CCRT		equ	01Fh	;cursor right
  175:		N      0020	CSPACE		equ	020h	;space
  176:		N      009D	CILN		equ	09Dh	;insert line
  177:		N      00FE	CDCH		equ	0FEh	;delete character
  178:		N      00FF	CICH		equ	0FFh	;insert character
  179:
  180:		N      0080	F1		equ	080h	;key code for F1
  181:		N      0081	F2		equ	081h	;key code for F2
  182:		N      0082	F3		equ	082h	;key code for F3
  183:		N      0083	F4		equ	083h	;key code for F4
  184:		N      0084	F5		equ	084h	;key code for F5
  185:		N      0085	F6		equ	085h	;key code for F6
  186:		N      0086	F7		equ	086h	;key code for F7
  187:		N      0087	F8		equ	087h	;key code for F8
  188:		N      0088	F9		equ	088h	;key code for F9
  189:		N      0089	F10		equ	089h	;key code for F10
  190:		N      008A	F11		equ	08ah	;key code for F11
  191:		N      008B	F12		equ	08bh	;key code for F12
  192:
  193:				;	special key scan-codes
  194:		N      0011	ALTGR		equ	011h	;extended!
  195:		N      0011	ALR		equ	011h
  196:		N      0012	CLSHIFT		equ	012h
  197:		N      0014	CLSTRG		equ	014h
  198:		N      0059	CRSHIFT		equ	059h
  199:		N      0058	CCAPS		equ	058h
  200:
  201:		N      00E0	EXTENDED	equ	0e0h
  202:		N      00F0	BREAK		equ	0f0h
  203:
  204:						;	0	;Error (ignored)
  205:		N      0001	DECCKM		equ	1	;Cursor key
  206:		N      0002	DECANM		equ	2	;ANSI/VT52
  207:		N      0003	DECCOLM		equ	3	;Column
  208:		N      0004	DECSCLM		equ	4	;Scrolling
  209:		N      0005	DECSCNM		equ	5	;Screen
  210:		N      0006	DECOM		equ	6	;Origin
  211:		N      0007	DECAWM		equ	7	;Auto wrap

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 5



 Line  I  Addr  Code            Source

  212:		N      0008	DECARM		equ	8	;Auto repeating
  213:		N      0009	DECINLM		equ	9	;Interlace
  214:		N      0004	IRM		equ	4	;Insert Replace mode
  215:		N      0014	LNM		equ	20	;new line mode
  216:
  217:
  218:		N      0020	VARS		equ	020h
  219:
  220:		N      0020	flags		equ	020h
  221:		B      0000	special		equ	flags.0
  222:		B      0001	lastchar	equ	flags.1
  223:		B      0002	lchartmp	equ	flags.2
  224:		B      0003	inverse		equ	flags.3
  225:		B      0004	xonoff		equ	flags.4
  226:		B      0005	serbusy		equ	flags.5
  227:
  228:		N      0021	flags1		equ	021h
  229:		B      0008	keyavail	equ	flags1.0
  230:		B      0009	keyrxextended	equ	flags1.1
  231:		B      000A	keyrxbreak	equ	flags1.2
  232:		B      000B	keyrxshift	equ	flags1.3
  233:		B      000C	keyrxaltgr	equ	flags1.4
  234:		B      000D	keyrxstrg	equ	flags1.5
  235:
  236:		N      0022	flags2		equ	022h
  237:		B      0010	wrap		equ	flags2.0
  238:		B      0011	origin		equ	flags2.1
  239:		B      0012	newlinemode	equ	flags2.2
  240:		B      0013	insert		equ	flags2.3
  241:
  242:		N      0023	retstate	equ	023h
  243:		N      0025	nargs		equ	025h
  244:		N      0026	arg0		equ	026h
  245:		N      0027	arg1		equ	027h
  246:		N      0028	arg2		equ	028h
  247:		N      0029	arg3		equ	029h
  248:		N      002A	baudidx		equ	02ah
  249:		N      002B	scursorx	equ	02bh
  250:		N      002C	scursory	equ	02ch
  251:		N      002D	color		equ	02dh
  252:		N      002E	cursorpos	equ	02eh
  253:		N      002F	cursorpos1	equ	02fh
  254:		N      0030	cursorsave	equ	030h
  255:		N      0031	top		equ	031h
  256:		N      0032	bottom		equ	032h
  257:		N      0033	state		equ	033h
  258:		N      0034	serstart	equ	034h
  259:		N      0035	serend		equ	035h
  260:		N      0036	sercount	equ	036h
  261:		N      0037	cursorx		equ	037h
  262:		N      0038	cursory		equ	038h
  263:		N      0039	t0cnt		equ	039h
  264:		N      003A	keyrxcnt	equ	03ah
  265:		N      003B	keyrxval	equ	03bh
  266:		N      003C	oldstatus	equ	03ch
  267:		N      003D	defcol		equ	03dh

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 6



 Line  I  Addr  Code            Source

  268:
  269:		N      0040	serbuf		equ	040h
  270:
  271:		N      0050	tabutab		equ	050h	;10-bytes tabulator
  272:
  273:		N      005A	free0		equ	05ah
  274:		N      005B	free1		equ	05bh
  275:		N      005C	free2		equ	05ch
  276:		N      005D	free3		equ	05dh
  277:		N      005E	free4		equ	05eh
  278:		N      005F	free5		equ	05fh
  279:
  280:		N      0000			org	0
  281:
  282:		N      0000		IF HARDWARE = 0
  283:						ljmp	start
  284:					ENDIF
  285:		N      2003			org	2003h
  286:	  2003	01 79				ajmp	exint0
  287:
  288:		N      200B			org	200bh
  289:	  200B	01 5C				ajmp	timer0int
  290:
  291:		N      2023			org	02023h
  292:
  293:	  2023	C0 D0		serint:		push	psw
  294:	  2025	C0 E0				push	acc
  295:	  2027	C0 00				push	0
  296:
  297:	  2029	30 98 22			jnb	ri, serintti	;ri active?
  298:	  202C	C2 98				clr	ri		;yes
  299:
  300:	  202E	A8 35				mov	r0, serend
  301:	  2030	08				inc	r0
  302:	  2031	B8 50 00			cjne	r0, #serbuf+16, $+3
  303:	  2034	40 02				jc	serint1
  304:	  2036	78 40				mov	r0, #serbuf
  305:	  2038	A6 99		serint1:	mov	@r0, sbuf
  306:	  203A	88 35				mov	serend, r0
  307:	  203C	05 36				inc	sercount
  308:	  203E	E5 36				mov	a, sercount
  309:	  2040	B4 08 0B			cjne	a, #8, serintti
  310:	  2043	75 99 13			mov	SBUF, #C_XOFF
  311:	  2046	D2 04				setb	xonoff
  312:	  2048	78 50				mov	r0, #80
  313:	  204A	D8 FE				djnz	r0, $
  314:	  204C	C2 99				clr	ti
  315:
  316:	  204E	30 99 04	serintti:	jnb 	ti, serintex
  317:	  2051	C2 99				clr	ti
  318:	  2053	C2 05				clr	serbusy
  319:
  320:	  2055	D0 00		serintex:	pop	0
  321:	  2057	D0 E0				pop	acc
  322:	  2059	D0 D0				pop	psw
  323:	  205B	32				reti

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 7



 Line  I  Addr  Code            Source

  324:
  325:
  326:
  327:				;===============================================
  328:				; Timer 0 Interrupt 0
  329:				;===============================================
  330:	  205C	D5 39 19	timer0int:	djnz	t0cnt, timer0int_ex
  331:	  205F	75 39 0A			mov	t0cnt, #C_TIME
  332:	  2062	C0 D0				push	psw
  333:	  2064	C0 E0				push	acc
  334:	  2066	C0 00				push	ar0
  335:
  336:	  2068	85 2F A0			mov	p2, cursorpos+1
  337:	  206B	A8 2E				mov	r0, cursorpos
  338:	  206D	E2				movx	a, @r0
  339:	  206E	E5 90				mov	a, p1
  340:	  2070	F4				cpl	a
  341:	  2071	F2				movx	@r0, a
  342:
  343:	  2072	D0 00				pop	ar0
  344:	  2074	D0 E0				pop	acc
  345:	  2076	D0 D0				pop	psw
  346:	  2078	32		timer0int_ex:	reti
  347:
  348:
  349:
  350:				;===============================================
  351:				; External Interrupt 0 (falling edge)
  352:				; collect bits sent from keyboard
  353:				; lsb first
  354:				; 8E1, start-bit (low), 8 data-bits, even-parity, stop-bit (high)
  355:				;===============================================
  356:	  2079	C0 D0		exint0:		push	psw
  357:	  207B	C0 E0				push	acc
  358:
  359:	  207D	E5 3A				mov	a, keyrxcnt
  360:	  207F	70 03				jnz	exint0b			;first bit?
  361:	  2081	20 B4 1D			jb	t0, exint0ex		;not zero, no startbit
  362:
  363:	  2084	04		exint0b:	inc	a
  364:	  2085	F5 3A				mov	keyrxcnt, a
  365:	  2087	B4 0A 00			cjne	a, #10, $+3
  366:	  208A	40 0E				jc	exint0a			;< 10, collect bits
  367:	  208C	B4 0B 12			cjne	a, #11, exint0ex	;skip parity-bit
  368:	  208F	75 3A 00			mov	keyrxcnt, #0
  369:	  2092	30 B4 0C			jnb	t0, exint0ex		;no stop bit?
  370:	  2095	12 29 CC			call	keydecode
  371:	  2098	80 07				sjmp 	exint0ex
  372:
  373:	  209A	E5 3B		exint0a:	mov	a, keyrxval
  374:	  209C	A2 B4				mov	c, t0
  375:	  209E	13				rrc	a
  376:	  209F	F5 3B				mov	keyrxval, a
  377:
  378:	  20A1	D0 E0		exint0ex:	pop	acc
  379:	  20A3	D0 D0				pop	psw

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 8



 Line  I  Addr  Code            Source

  380:	  20A5	32				reti
  381:
  382:
  383:
  384:		N      2100	LOCAT		equ	02100h
  385:
  386:		N      2100			org	LOCAT
  387:
  388:		N      2100			ORG    LOCAT
  389:	  2100	A5 E5 E0 A5			DB     0A5H,0E5H,0E0H,0A5H	;SIGNITURE BYTES
  390:	  2104	23 00 00 00			DB     35,0,0,0			;ID (35=PROG), id (253=startup)
  391:	  2108	00 00 00 00			DB     0,0,0,0			;PROMPT CODE VECTOR
  392:	  210C	00 00 00 00			DB     0,0,0,0			;RESERVED
  393:	  2110	00 00 00 00			DB     0,0,0,0			;RESERVED
  394:	  2114	00 00 00 00			DB     0,0,0,0			;RESERVED
  395:	  2118	00 00 00 00			DB     0,0,0,0			;USER DEFINED
  396:	  211C	FF FF FF FF			DB     255,255,255,255		;LENGTH AND CHECKSUM (255=UNUSED)
  397:	  2120	56 54 31 30			DB     "VT100",0		;MAX 31 CHARACTERS, PLUS THE ZERO
	  2124	30 00
  398:
  399:		N      2140			ORG    LOCAT+64			;EXECUTABLE CODE BEGINS HERE
  400:
  401:	  2140			start:
  402:	  2140	75 81 80			mov	sp, #stack		;set stack
  403:										;1  1  0  1	0    1    1   1
  404:	  2143	75 B0 D7			mov	p3, #0d7h		;RD WR T1 T0	INT1 INT0 TXD RXD
  405:				;		clr	T0
  406:				;		clr	T1			;E 6845 = low
  407:				;		clr	INT0			;charset 0
  408:				;		clr	INT1			;screen 0
  409:	  2146	E4				clr	a
  410:	  2147	F5 A2				mov	AUXR1, a
  411:	  2149	F5 A8				mov	ie, a
  412:
  413:
  414:				;		setb	PS			;make PS high priority
  415:										;enbale all, serial, timer0, extint0
  416:	  214B	75 A8 93			mov	ie, #093h		;ea - ET2 ES  ET1 EX1 ET0 EX0
  417:	  214E	D2 88				setb	it0			;set int0 to falling edge
  418:
  419:	  2150	F1 29				acall	term_reset
  420:
  421:	  2152	74 11				mov	a, #C_XON
  422:	  2154	12 29 5E			call	cout
  423:
  424:	  2157	12 28 C0	init:		call	init6845
  425:	  215A	12 29 0B			call	copyFont
  426:	  215D	12 29 24			call	testScreen
  427:
  428:	  2160	90 80 00			mov	dptr, #8000h
  429:	  2163	E0				movx	a, @dptr
  430:	  2164	E5 90				mov	a, p1
  431:	  2166	14				dec	a
  432:	  2167	60 06				jz	init_loop
  433:	  2169	90 00 00			mov	dptr, #0h
  434:	  216C	E0				movx	a, @dptr

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 9



 Line  I  Addr  Code            Source

  435:	  216D	80 E8				sjmp	init
  436:
  437:	  216F	12 29 6E	init_loop:	call	cin
  438:	  2172	B4 78 02			cjne	a, #'x', init_1
  439:	  2175	80 0B				sjmp	init_2
  440:
  441:	  2177	B4 79 F5	init_1:		cjne	a, #'y', init_loop
  442:
  443:	  217A	12 29 6E	loop_test:	call	cin
  444:	  217D	12 29 5E			call	cout
  445:	  2180	80 F8				sjmp	loop_test
  446:
  447:
  448:	  2182	D2 8C		init_2:		setb	tr0				;start timer0
  449:	  2184	F1 29				acall	term_reset
  450:
  451:				;		mov	dptr, #msg1
  452:				;		call	print
  453:
  454:	  2186	30 08 40	main_loop:	jnb	keyavail, main_serin		;key available?
  455:	  2189	C2 08				clr	keyavail			;clear key available
  456:	  218B	E5 3B				mov	a, keyrxval
  457:	  218D	B4 84 02			cjne	a, #F5, main_F6			;F5 ?
  458:	  2190	21 82				ajmp	init_2				;reset terminal
  459:	  2192	B4 85 17	main_F6:	cjne	a, #F6, main_F7			;F6 ?
  460:	  2195	A8 2A				mov	r0, baudidx			;switch baud
  461:	  2197	08				inc	r0
  462:	  2198	B8 05 02			cjne	r0, #5, main_F6a
  463:	  219B	78 00				mov	r0, #0
  464:	  219D	88 2A		main_F6a:	mov	baudidx, r0
  465:	  219F	12 2B B5			call	getbaud
  466:	  21A2	C2 8E				clr	tr1
  467:	  21A4	F5 8D				mov	TH1, a
  468:	  21A6	F5 8C				mov	TH0, a
  469:	  21A8	D2 8E				setb	tr1
  470:	  21AA	80 33				sjmp	main_status
  471:
  472:	  21AC	B4 86 0C	main_F7:	cjne	a, #F7, main_cout		;F7 ? cycle color
  473:	  21AF	E5 3D				mov	a, defcol
  474:	  21B1	24 10				add	a, #16
  475:	  21B3	54 7F				anl	a, #07fh
  476:	  21B5	F5 3D				mov	defcol, a
  477:	  21B7	F5 2D				mov	color, a
  478:	  21B9	80 CB				sjmp	main_loop
  479:
  480:	  21BB	12 29 5E	main_cout:	call	cout				;send out over serial
  481:	  21BE	B4 0D 08			cjne	a, #C_CR, main_serin		;CR sent?
  482:	  21C1	30 12 05			jnb	newlinemode, main_serin
  483:	  21C4	74 0A				mov	a, #C_NEWLINE			;send LF, too
  484:	  21C6	12 29 5E			call	cout
  485:
  486:	  21C9	E5 34		main_serin:	mov	a, serstart			;serin available?
  487:	  21CB	B5 35 02			cjne	a, serend, loop_cin
  488:	  21CE	80 B6				sjmp	main_loop			;no serin available
  489:
  490:	  21D0	12 29 6E	loop_cin:	call	cin				;read from serial

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 10



 Line  I  Addr  Code            Source

  491:	  21D3	12 21 E4			call	ansiout				;output to terminal's CRT
  492:
  493:	  21D6	E5 22				mov	a, flags2			;have flags changed?
  494:	  21D8	65 3C				xrl	a, oldstatus
  495:	  21DA	60 AA				jz	main_loop			;no
  496:	  21DC	85 22 3C			mov	oldstatus, flags2
  497:	  21DF	12 2B D4	main_status:	call	prtstatus			;print status-line
  498:	  21E2	80 A2				sjmp	main_loop
  499:
  500:
  501:				;===============================================
  502:				; ansiout: dispatch according to state
  503:				;===============================================
  504:	  21E4	FF		ansiout:	mov	r7, a			;save acc in r7
  505:
  506:	  21E5	E5 33				mov	a, state
  507:	  21E7	60 20				jz	do_idle			;speed up
  508:	  21E9	24 0C				add	a, #ansi_tab-ansiout1+1	;fetch low-byte
  509:	  21EB	83				movc	a, @a+pc
  510:	  21EC	C0 E0		ansiout1:	push	acc			;2
  511:	  21EE	E5 33				mov	a, state		;2
  512:	  21F0	24 04				add	a, #ansi_tab-ansiout2	;2
  513:	  21F2	83				movc	a, @a+pc		;1 fetch, high-byte
  514:	  21F3	C0 E0		ansiout2:	push	acc			;2
  515:	  21F5	EF				mov	a, r7			;1
  516:	  21F6	22				ret				;1
  517:
  518:	  21F7	22 09 23 02	ansi_tab:	dw	do_idle, do_esc, do_csi, do_esc_q, do_esc_hash, do_cmd_arg, do_esc_lbrack, d
	  21FB	23 62 26 64	o_csi_q
	  21FF	26 68 26 80
	  2203	26 74 26 1B
  519:	  2207	26 74				dw	do_esc_rbrack
  520:
  521:
  522:				;===============================================
  523:				; state IDLE
  524:				;===============================================
  525:	  2209	A2 01		do_idle:	mov	C, lastchar
  526:	  220B	92 02				mov	lchartmp, C
  527:	  220D	C2 01				clr	lastchar
  528:
  529:	  220F	E4				clr	a
  530:	  2210	F8				mov	r0, a				;x-offset
  531:	  2211	F9				mov	r1, a				;y-offset
  532:	  2212	FA				mov	r2, a				;scrolling, 0 = no
  533:
  534:	  2213	BF 7F 03	do_idle_del:	cjne	r7, #C_DEL, do_idle_pre
  535:	  2216	18				dec	r0
  536:	  2217	C1 BD				ajmp	ansi_move
  537:
  538:	  2219	BF 20 00	do_idle_pre:	cjne	r7, #32, $+3			;speed up
  539:	  221C	50 62				jnc	draw_char
  540:
  541:	  221E	BF 07 01			cjne	r7, #C_BELL, do_idle_bs
  542:	  2221	22				ret					;no bell yet
  543:

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 11



 Line  I  Addr  Code            Source

  544:	  2222	BF 08 03	do_idle_bs:	cjne	r7, #C_BACKSP, do_idle_tab	;backspace
  545:	  2225	18				dec	r0
  546:	  2226	C1 BD				ajmp	ansi_move
  547:
  548:	  2228	BF 09 21	do_idle_tab:	cjne	r7, #C_TAB, do_idle_nl		;tabulator
  549:	  222B	F1 71				acall	tab_set_r0_r1
  550:	  222D	E4		do_idle_tab3:	clr	a
  551:	  222E	09				inc	r1
  552:	  222F	05 37				inc	cursorx
  553:	  2231	B9 08 0E			cjne	r1, #8, do_idle_tab1
  554:	  2234	08				inc	r0
  555:	  2235	F9				mov	r1, a
  556:	  2236	B8 5A 09			cjne	r0, #tabutab+10, do_idle_tab1
  557:	  2239	F8				mov	r0, a
  558:	  223A	F5 37				mov	cursorx, a
  559:	  223C	09				inc	r1
  560:	  223D	0A				inc	r2				;scroll on
  561:	  223E	D1 BD				acall	ansi_move
  562:	  2240	F1 71				acall	tab_set_r0_r1
  563:	  2242	F1 81		do_idle_tab1:	acall	getbit
  564:	  2244	56				anl	a, @r0
  565:	  2245	60 E6				jz	do_idle_tab3			;bit not found
  566:	  2247	E4		do_idle_tab2:	clr	a
  567:	  2248	F8				mov	r0, a
  568:	  2249	F9				mov	r1, a
  569:	  224A	C1 BD				ajmp	ansi_move
  570:
  571:
  572:	  224C	BF 0A 07	do_idle_nl:	cjne	r7, #C_NEWLINE, do_idle_cr
  573:	  224F	75 37 00	do_newline:	mov	cursorx, #0
  574:	  2252	09				inc	r1
  575:	  2253	0A				inc	r2
  576:	  2254	C1 BD				ajmp	ansi_move
  577:
  578:	  2256	BF 0D 09	do_idle_cr:	cjne	r7, #C_CR, do_idle_esc
  579:	  2259	75 37 00	do_cr:		mov	cursorx, #0
  580:	  225C	D1 BD				acall	ansi_move
  581:	  225E	20 12 EE			jb	newlinemode, do_newline		;per default, CR
  582:	  2261	22				ret
  583:
  584:	  2262	BF 1B 05	do_idle_esc:	cjne	r7, #C_ESC, do_idle_so
  585:	  2265	75 33 02			mov	state, #ST_ESC
  586:	  2268	E1 8D				ajmp	clearargs
  587:
  588:	  226A	BF 0E 03	do_idle_so:	cjne	r7, #C_SO, do_idle_si
  589:	  226D	D2 00				setb	special
  590:	  226F	22				ret
  591:
  592:	  2270	BF 0F 03	do_idle_si:	cjne	r7, #C_SI, do_idle_vt
  593:	  2273	C2 00				clr	special
  594:	  2275	22				ret
  595:
  596:	  2276	BF 0B 02	do_idle_vt:	cjne	r7, #C_VT, do_idle_ff
  597:	  2279	80 D4				sjmp	do_newline
  598:
  599:	  227B	BF 0C 02	do_idle_ff:	cjne	r7, #C_FF, do_idle_end

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 12



 Line  I  Addr  Code            Source

  600:	  227E	80 CF				sjmp	do_newline
  601:
  602:	  2280			do_idle_end:	;ajmp	draw_char
  603:
  604:
  605:
  606:	  2280	C0 07		draw_char:	push	ar7				;save r7 (received byte)
  607:	  2282	12 28 89			call	cursor_off			;reset + disable cursor
  608:
  609:	  2285	0A				inc	r2				;with scroll
  610:	  2286	30 02 05			jnb	lchartmp, char_out		;last char in line?
  611:	  2289	30 10 02			jnb	wrap, char_out			;wrap turned on?
  612:	  228C	51 4F				acall	do_newline
  613:
  614:				;===============================================
  615:				; draws a char in ACC at cursor position
  616:				;===============================================
  617:	  228E	12 28 AC	char_out:	call	comp_dptr
  618:
  619:	  2291	D0 01				pop	ar1
  620:
  621:	  2293	30 00 0E			jnb	special, char_out_3	;special not set?
  622:	  2296	B9 60 00			cjne	r1, #060h, $+3
  623:	  2299	40 09				jc	char_out_3		;<60h, do nothing
  624:	  229B	B9 7F 00			cjne	r1, #07fh, $+3
  625:	  229E	50 04				jnc	char_out_3		;>=7fh, do nothing
  626:	  22A0	E9				mov	a, r1
  627:	  22A1	94 5E				subb	a, #5eh			;carry set! subtract 5fh
  628:	  22A3	F9				mov	r1, a
  629:	  22A4	30 13 3D	char_out_3:	jnb	insert, char_out_4	;insert mode?
  630:
  631:	  22A7	C3				clr	c
  632:	  22A8	74 4F				mov	a, #WIDTH-1
  633:	  22AA	95 37				subb	a, cursorx
  634:	  22AC	33				rlc	a			;* 2
  635:	  22AD	60 35				jz	char_out_4
  636:	  22AF	F8				mov	r0, a			;R0: number of chars to copy in
  637:	  22B0	04				inc	a
  638:
  639:	  22B1	25 84				add	a, dp1l			;add r0, to dptr1 (destination)
  640:	  22B3	F5 84				mov	dp1l, a
  641:	  22B5	E5 85				mov	a, dp1h
  642:	  22B7	34 00				addc	a, #0
  643:	  22B9	F5 85				mov	dp1h, a
  644:
  645:	  22BB	E5 84				mov	a, dp1l			;dptr0 = dptr1 - 2 (source)
  646:	  22BD	94 02				subb	a, #2
  647:	  22BF	F5 82				mov	dp0l, a
  648:	  22C1	E5 85				mov	a, dp1h
  649:	  22C3	94 00				subb	a, #0
  650:	  22C5	F5 83				mov	dp0h, a
  651:
  652:
  653:
  654:
  655:	  22C7	E0		char_out_2:	movx	a, @dptr		;copy r0 bytes from right to left

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 13



 Line  I  Addr  Code            Source

  656:	  22C8	05 A2				inc	auxr1
  657:	  22CA	E5 90				mov	a, p1
  658:	  22CC	F0				movx	@dptr, a
  659:	  22CD	05 A2				inc	auxr1
  660:	  22CF	E5 82				mov	a, dp0l
  661:	  22D1	70 02				jnz	char_out_2a
  662:	  22D3	15 83				dec	dp0h
  663:	  22D5	15 82		char_out_2a:	dec	dp0l
  664:	  22D7	E5 84				mov	a, dp1l
  665:	  22D9	70 02				jnz	char_out_2b
  666:	  22DB	15 85				dec	dp1h
  667:	  22DD	15 84		char_out_2b:	dec	dp1l
  668:	  22DF	D8 E6				djnz	r0, char_out_2
  669:	  22E1	12 28 AC			call	comp_dptr
  670:
  671:	  22E4	E9		char_out_4:	mov	a, r1
  672:	  22E5	05 A2				inc	auxr1
  673:	  22E7	F0				movx	@dptr, a
  674:	  22E8	A3				inc	dptr
  675:	  22E9	E5 2D				mov	a, color
  676:	  22EB	30 03 01			jnb	inverse, char_out_1
  677:	  22EE	C4				swap	a
  678:	  22EF	F0		char_out_1:	movx	@dptr, a
  679:	  22F0	05 A2				inc	auxr1
  680:
  681:	  22F2	E5 37				mov	a, cursorx
  682:	  22F4	B4 4F 02			cjne	a, #WIDTH-1, draw_char_1
  683:	  22F7	D2 01				setb	lastchar
  684:
  685:	  22F9	78 01		draw_char_1:	mov	r0, #1
  686:	  22FB	79 00				mov	r1, #0
  687:	  22FD	12 28 69			call	draw_cursor
  688:	  2300	C1 BD				ajmp	ansi_move
  689:
  690:				;===============================================
  691:				; state ESC
  692:				;===============================================
  693:	  2302	75 33 00	do_esc:		mov	state, #ST_IDLE
  694:	  2305	B4 1B 03			cjne	a, #C_ESC, do_esc_csi
  695:	  2308	02 00 00			jmp	0h
  696:
  697:	  230B	B4 5B 04	do_esc_csi:	cjne	a, #'[', do_esc_7	;switch to CSI state
  698:	  230E	75 33 04			mov	state, #ST_CSI
  699:	  2311	22				ret
  700:
  701:	  2312	B4 37 07	do_esc_7:	cjne	a, #'7', do_esc_8	;save cursor
  702:	  2315	85 37 2B			mov	scursorx, cursorx
  703:	  2318	85 38 2C			mov	scursory, cursory
  704:	  231B	22				ret
  705:
  706:	  231C	B4 38 09	do_esc_8:	cjne	a, #'8', do_esc_D	;restore cursor
  707:	  231F	85 2B 37			mov	cursorx, scursorx
  708:	  2322	85 2C 38			mov	cursory, scursory
  709:	  2325	02 28 66			jmp	move_cursor
  710:
  711:	  2328	B4 44 05	do_esc_D:	cjne	a, #'D', do_esc_M	;move cursor down and scroll

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 14



 Line  I  Addr  Code            Source

  712:	  232B	0A				inc	r2			;with scrolling
  713:	  232C	74 42				mov	a, #'B'
  714:	  232E	61 6F				ajmp	do_csi_keys		;do cursor down
  715:
  716:	  2330	B4 4D 05	do_esc_M:	cjne	a, #'M', do_esc_ha	;move cursor up and scroll
  717:	  2333	0A				inc	r2			;with scrolling
  718:	  2334	74 41				mov	a, #'A'
  719:	  2336	61 6F				ajmp	do_csi_keys		;do cursor up
  720:
  721:	  2338	B4 23 04	do_esc_ha:	cjne	a, #'#', do_esc_lbr
  722:	  233B	75 33 08			mov	state, #ST_ESC_HASH
  723:	  233E	22				ret
  724:
  725:	  233F	B4 28 04	do_esc_lbr:	cjne	a, #'(', do_esc_rbr
  726:	  2342	75 33 0C			mov	state, #ST_ESC_LBRACK
  727:	  2345	22				ret
  728:
  729:	  2346	B4 29 04	do_esc_rbr:	cjne	a, #')', do_esc_c
  730:	  2349	75 33 10			mov	state, #ST_ESC_RBRACK
  731:	  234C	22				ret
  732:
  733:	  234D	B4 63 02	do_esc_c:	cjne	a, #'c', do_esc_H
  734:	  2350	E1 29				ajmp	term_reset
  735:
  736:	  2352	B4 48 07	do_esc_H:	cjne	a, #'H', do_esc_Z
  737:	  2355	F1 71				acall	tab_set_r0_r1
  738:	  2357	F1 81				acall	getbit
  739:	  2359	46				orl	a, @r0
  740:	  235A	F6				mov	@r0, a
  741:	  235B	22				ret
  742:
  743:	  235C	B4 5A 02	do_esc_Z:	cjne	a, #'Z', do_esc_ex
  744:	  235F	81 8D				ajmp	do_csi_cc2
  745:
  746:	  2361	22		do_esc_ex:	ret
  747:
  748:				;===============================================
  749:				; state CSI
  750:				;===============================================
  751:	  2362			do_csi:
  752:	  2362	F1 13				acall	isparm			;is parameter?
  753:	  2364	50 09				jnc	do_csi_keys		;no
  754:	  2366	85 33 23			mov	retstate, state
  755:	  2369	75 33 0A			mov	state, #ST_CMD_ARG
  756:	  236C	02 26 80			jmp	do_cmd_arg
  757:
  758:	  236F	78 00		do_csi_keys:	mov	r0, #0			;x (column)
  759:	  2371	79 00				mov	r1, #0			;y (row
  760:	  2373	75 33 00			mov	state, #ST_IDLE
  761:
  762:	  2376	B4 41 09			cjne	a, #'A', do_csi_B	;cursor up
  763:	  2379	D1 A9				acall	args_gr_zero
  764:	  237B	E5 26				mov	a, arg0
  765:	  237D	F4				cpl	a
  766:	  237E	04				inc	a
  767:	  237F	F9				mov	r1, a

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 15



 Line  I  Addr  Code            Source

  768:	  2380	C1 BD				ajmp	ansi_move
  769:
  770:
  771:	  2382	B4 42 06	do_csi_B: 	cjne	a, #'B', do_csi_C	;cursor down
  772:	  2385	D1 A9				acall	args_gr_zero
  773:	  2387	A9 26				mov	r1, arg0
  774:	  2389	C1 BD				ajmp	ansi_move
  775:
  776:
  777:	  238B	B4 43 06	do_csi_C:	cjne	a, #'C', do_csi_D	;cursor right
  778:	  238E	D1 A9				acall	args_gr_zero
  779:	  2390	A8 26				mov	r0, arg0
  780:	  2392	C1 BD				ajmp	ansi_move
  781:
  782:
  783:	  2394	B4 44 09	do_csi_D:	cjne	a, #'D', do_csi_H 	;cursor left
  784:	  2397	D1 A9				acall	args_gr_zero
  785:	  2399	E5 26				mov	a, arg0
  786:	  239B	F4				cpl	a
  787:	  239C	04				inc	a
  788:	  239D	F8				mov	r0, a
  789:	  239E	C1 BD				ajmp	ansi_move
  790:
  791:
  792:	  23A0	B4 48 02	do_csi_H:	cjne	a, #'H', do_csi_H1	;position cursor
  793:	  23A3	80 03				sjmp	do_csi_H2
  794:	  23A5	B4 66 0E	do_csi_H1:	cjne	a, #'f', do_csi_s
  795:	  23A8	D1 A9		do_csi_H2:	acall	args_gr_zero
  796:	  23AA	E5 26				mov	a, arg0
  797:	  23AC	14				dec	a
  798:	  23AD	F5 38				mov	cursory, a
  799:	  23AF	E5 27				mov	a, arg1
  800:	  23B1	14				dec	a
  801:	  23B2	F5 37				mov	cursorx, a
  802:	  23B4	C1 BD				ajmp	ansi_move
  803:
  804:
  805:	  23B6	B4 73 07	do_csi_s:	cjne	a, #'s', do_csi_u	;save cursor
  806:	  23B9	85 37 2B			mov	scursorx, cursorx
  807:	  23BC	85 38 2C			mov	scursory, cursory
  808:	  23BF	22				ret
  809:
  810:
  811:	  23C0	B4 75 08	do_csi_u:	cjne	a, #'u', do_csi_m	;restore cursor
  812:	  23C3	85 2B 37			mov	cursorx, scursorx
  813:	  23C6	85 2C 38			mov	cursory, scursory
  814:	  23C9	C1 BD				ajmp	ansi_move
  815:
  816:
  817:	  23CB	B4 6D 6A	do_csi_m:	cjne	a, #'m', do_csi_n	;color handling
  818:	  23CE	A9 25				mov	r1, nargs
  819:	  23D0	B9 00 06			cjne	r1, #0, do_csi_ma	;no args, reset
  820:	  23D3	85 3D 2D			mov	color, defcol
  821:	  23D6	C2 03				clr	inverse
  822:	  23D8	22				ret
  823:	  23D9	78 26		do_csi_ma:	mov	r0, #arg0

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 16



 Line  I  Addr  Code            Source

  824:	  23DB	E6		do_csi_mc:	mov	a, @r0
  825:	  23DC	B4 00 07			cjne	a, #0, do_csi_md	;if arg = 0, all attrs off
  826:	  23DF	85 3D 2D			mov	color, defcol
  827:	  23E2	C2 03				clr	inverse
  828:	  23E4	81 34				ajmp	do_csi_mx3		;loop nargs
  829:	  23E6	B4 1E 00	do_csi_md:	cjne	a, #30, do_csi_mb
  830:	  23E9	50 02		do_csi_mb:	jnc	do_csi_me		;arg >= 30
  831:	  23EB	80 2A				sjmp	do_csi_mx		;loop nargs
  832:	  23ED	B4 26 00	do_csi_me:	cjne	a, #38, do_csi_mf
  833:	  23F0	50 42		do_csi_mf:	jnc	do_csi_mx3		;>= 38	loop nargs
  834:	  23F2	94 1D				subb	a, #29			; - 30 (carry set!)
  835:	  23F4	C4				swap	a
  836:	  23F5	FA				mov	r2, a
  837:	  23F6	E5 2D				mov	a, color
  838:	  23F8	54 0F				anl	a, #0fh
  839:	  23FA	4A				orl	a, r2
  840:	  23FB	F5 2D				mov	color, a
  841:	  23FD	81 34				ajmp	do_csi_mx3		;loop nargs
  842:	  23FF	B4 28 00	do_csi_mg:	cjne	a, #40, $+3
  843:	  2402	50 02				jnc	do_csi_mh		;>= 40
  844:	  2404	81 17				ajmp	do_csi_mx		;loop nargs
  845:	  2406	B4 30 00	do_csi_mh:	cjne	a, #48, $+3
  846:	  2409	50 0C				jnc	do_csi_mx		;>= 48 loop
  847:	  240B	94 27				subb	a, #39			;- 40 (carry set!)
  848:	  240D	FA				mov	r2, a
  849:	  240E	F5 2D				mov	color, a
  850:	  2410	54 F0				anl	a, #0f0h
  851:	  2412	4A				orl	a, r2
  852:	  2413	F5 2D				mov	color, a
  853:	  2415	81 34				ajmp	do_csi_mx3		;loop nargs
  854:	  2417	B4 07 02	do_csi_mx:	cjne	a, #7, do_csi_mx1	;inverse
  855:	  241A	D2 03				setb	inverse
  856:	  241C	B4 01 0A	do_csi_mx1:	cjne	a, #1, do_csi_mx2	;bold
  857:	  241F	E5 2D				mov	a, color
  858:	  2421	54 0F				anl	a, #0fh
  859:	  2423	44 30				orl	a, #YELLOW SHL 4
  860:	  2425	F5 2D				mov	color, a
  861:	  2427	80 0B				sjmp	do_csi_mx3
  862:	  2429	B4 05 08	do_csi_mx2:	cjne	a, #5, do_csi_mx3
  863:	  242C	E5 2D				mov	a, color		;underline
  864:	  242E	54 0F				anl	a, #0fh
  865:	  2430	44 10				orl	a, #RED SHL 4
  866:	  2432	F5 2D				mov	color, a
  867:	  2434	08		do_csi_mx3:	inc	r0
  868:	  2435	D9 A4				djnz	r1, do_csi_mc
  869:	  2437	22				ret
  870:
  871:	  2438	B4 6E 4F	do_csi_n:	cjne	a, #'n', do_csi_cc	;terminal status report
  872:	  243B	E5 26				mov	a, arg0
  873:	  243D	B4 05 0E			cjne	a, #5, do_csi_n6
  874:	  2440	78 01				mov	r0, #1			;always OK: "ESC [ 0 n"
  875:	  2442	E8		do_csi_n1:	mov	a, r0
  876:	  2443	12 24 7D			call	getreport
  877:	  2446	12 29 5E			call	cout
  878:	  2449	08				inc	r0
  879:	  244A	B8 05 F5			cjne	r0, #5, do_csi_n1

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 17



 Line  I  Addr  Code            Source

  880:	  244D	22				ret
  881:	  244E	B4 06 39	do_csi_n6:	cjne	a, #6, do_csi_cc		;report cursor position
  882:	  2451	74 1B				mov	a, #ESC
  883:	  2453	12 29 5E			call	cout
  884:	  2456	74 5B				mov	a, #'['
  885:	  2458	12 29 5E			call	cout
  886:	  245B	E5 38				mov	a, cursory
  887:	  245D	95 31				subb	a, top
  888:	  245F	12 24 71			call	sendpos
  889:	  2462	74 3B				mov	a, #';'
  890:	  2464	12 29 5E			call	cout
  891:	  2467	E5 37				mov	a, cursorx
  892:	  2469	12 24 71			call	sendpos
  893:	  246C	74 52				mov	a, #'R'
  894:	  246E	02 29 5E			jmp	cout
  895:
  896:	  2471	04		sendpos:	inc	a
  897:	  2472	12 28 9F			call	hex2dez
  898:	  2475	E8				mov	a, r0
  899:	  2476	12 29 5E			call	cout
  900:	  2479	E9				mov	a, r1
  901:	  247A	02 29 5E			jmp	cout
  902:
  903:	  247D	83		getreport:	movc	a, @a+pc
  904:	  247E	22				ret
  905:	  247F	1B 5B 30 6E	reportok:	db	ESC, "[0n"		;terminal OK
  906:	  2483	1B 5B 3F 31	reportda:	db	ESC, "[?1;0c"		;device attributes (VT100, no options)
	  2487	3B 30 63
  907:
  908:	  248A	B4 63 0D	do_csi_cc:	cjne	a, #'c', do_csi_r
  909:	  248D	78 05		do_csi_cc2:	mov	r0, #5			;reportda
  910:	  248F	E8		do_csi_cc1:	mov	a, r0
  911:	  2490	91 7D				call	getreport
  912:	  2492	12 29 5E			call	cout
  913:	  2495	08				inc	r0
  914:	  2496	B8 0C F6			cjne	r0, #5+7, do_csi_cc1
  915:	  2499	22				ret
  916:
  917:	  249A	B4 72 43	do_csi_r:	cjne	a, #'r', do_csi_J	;set scroll margins
  918:	  249D	E5 25				mov	a, nargs
  919:	  249F	70 08				jnz	do_csi_ra		;nargs > 0
  920:	  24A1	75 31 00			mov	top, #0
  921:	  24A4	75 32 17			mov	bottom, #HEIGHT-1
  922:	  24A7	80 28				sjmp	do_csi_rc
  923:	  24A9	D1 A9		do_csi_ra:	acall	args_gr_zero
  924:	  24AB	B4 02 00			cjne	a, #2, $+3
  925:	  24AE	50 0A				jnc	do_csi_rb		;>= 2 args
  926:	  24B0	85 26 31			mov	top, arg0
  927:	  24B3	15 31				dec	top
  928:	  24B5	75 32 17			mov	bottom, #HEIGHT-1
  929:	  24B8	80 17				sjmp	do_csi_rc
  930:	  24BA	E5 26		do_csi_rb:	mov	a, arg0
  931:	  24BC	95 27				subb	a, arg1			;carry clear!
  932:	  24BE	50 20				jnc	do_csi_J		; a >= b
  933:	  24C0	85 26 31			mov	top, arg0
  934:	  24C3	15 31				dec	top

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 18



 Line  I  Addr  Code            Source

  935:
  936:	  24C5	E5 27				mov	a, arg1
  937:	  24C7	B4 19 00			cjne	a, #HEIGHT+1, $+3
  938:	  24CA	40 02				jc	do_csi_re
  939:	  24CC	74 18				mov	a, #HEIGHT
  940:	  24CE	14		do_csi_re:	dec	a
  941:	  24CF	F5 32				mov	bottom, a
  942:
  943:	  24D1	E4		do_csi_rc:	clr	a			;cursor home
  944:	  24D2	F8				mov	r0, a
  945:	  24D3	F9				mov	r1, a
  946:	  24D4	F5 37				mov	cursorx, a
  947:	  24D6	F5 38				mov	cursory, a
  948:	  24D8	30 11 03			jnb	origin, do_csi_rd
  949:	  24DB	85 31 38			mov	cursory, top
  950:	  24DE	C1 BD		do_csi_rd:	ajmp	ansi_move
  951:
  952:
  953:	  24E0	B4 4A 35	do_csi_J:	cjne	a, #'J', do_csi_ques		;ED – Erase In Display
  954:	  24E3	A8 26				mov	r0, arg0
  955:	  24E5	B8 00 0F	do_csi_Ja:	cjne	r0, #0, do_csi_Jb
  956:	  24E8	A8 38		do_csi_Jc:	mov	r0, cursory			;Erase from the active position to the end o
				f the screen, inclusive (default)
  957:	  24EA	79 17				mov	r1, #HEIGHT-1			;y from cursory to HEIGHT-1
  958:	  24EC	AA 37				mov	r2, cursorx			;start position x
  959:	  24EE	74 50				mov	a, #WIDTH			;chars to erase first line
  960:	  24F0	9A				subb	a, r2
  961:	  24F1	FB				mov	r3, a
  962:	  24F2	7D 50				mov	r5, #WIDTH			;chars to erase last line
  963:	  24F4	02 28 35			jmp	clear_lines
  964:
  965:	  24F7	B8 01 0E	do_csi_Jb:	cjne	r0, #1, do_csi_Jd
  966:	  24FA	78 00				mov	r0, #0				;Erase from start of the screen to the activ
				e position, inclusive
  967:	  24FC	A9 38				mov	r1, cursory
  968:	  24FE	7A 00				mov	r2, #0
  969:	  2500	7B 50				mov	r3, #WIDTH			;chars to erase first line
  970:	  2502	AD 37				mov	r5, cursorx
  971:	  2504	0D				inc	r5				;chars to erase last line
  972:	  2505	02 28 35			jmp	clear_lines
  973:
  974:	  2508	B8 02 0D	do_csi_Jd:	cjne	r0, #2, do_csi_ques
  975:	  250B	78 00				mov	r0, #0				;Erase all of the display – all lines are er
				ased and the cursor does not move.
  976:	  250D	79 17				mov	r1, #HEIGHT-1
  977:	  250F	7A 00				mov	r2, #0
  978:	  2511	7B 50				mov	r3, #WIDTH			;chars to erase first line
  979:	  2513	7D 50				mov	r5, #WIDTH			;chars to erase first line
  980:	  2515	02 28 35			jmp	clear_lines
  981:
  982:	  2518	B4 3F 04	do_csi_ques:	cjne	a, #'?', do_csi_K
  983:	  251B	75 33 0E			mov	state, #ST_CSI_Q
  984:	  251E	22				ret
  985:
  986:	  251F	B4 4B 29	do_csi_K:	cjne	a, #'K', do_csi_g
  987:	  2522	A8 38				mov	r0, cursory

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 19



 Line  I  Addr  Code            Source

  988:	  2524	A9 38				mov	r1, cursory
  989:	  2526	E5 26				mov	a, arg0
  990:	  2528	B4 00 09			cjne	a, #0, do_csi_Ka		;Erase from the active position to the end o
				f the line, inclusive (default)
  991:	  252B	AA 37				mov	r2, cursorx
  992:	  252D	74 50				mov	a, #WIDTH
  993:	  252F	9A				subb	a, r2
  994:	  2530	FD				mov	r5, a
  995:	  2531	02 28 35			jmp	clear_lines
  996:	  2534	B4 01 08	do_csi_Ka:	cjne	a, #1, do_csi_Kb		;Erase from the start of the screen to the a
				ctive position, inclusive
  997:	  2537	7A 00				mov	r2, #0
  998:	  2539	AD 37				mov	r5, cursorx
  999:	  253B	0D				inc	r5
 1000:	  253C	02 28 35			jmp	clear_lines
 1001:	  253F	B4 02 07	do_csi_Kb:	cjne	a, #2, do_csi_end1		;Erase all of the line, inclusive
 1002:	  2542	7A 00				mov	r2, #0
 1003:	  2544	7D 50				mov	r5, #WIDTH
 1004:	  2546	02 28 35			jmp	clear_lines
 1005:	  2549	C1 1A		do_csi_end1:	ajmp	do_csi_end
 1006:
 1007:	  254B	B4 67 10	do_csi_g:	cjne	a, #'g', do_csi_L
 1008:	  254E	E5 26				mov	a, arg0
 1009:	  2550	B4 03 02			cjne	a, #3, do_csi_g1
 1010:	  2553	E1 65				ajmp	cleartabu			;clear all tabs
 1011:	  2555	F1 71		do_csi_g1:	acall	tab_set_r0_r1
 1012:	  2557	F1 81				acall	getbit
 1013:	  2559	F4				cpl	a
 1014:	  255A	56				anl	a, @r0
 1015:	  255B	F6				mov	@r0, a
 1016:	  255C	C1 1A				ajmp	do_csi_end
 1017:
 1018:	  255E	B4 4C 24	do_csi_L:	cjne	a, #'L', do_csi_MM		;insert line
 1019:	  2561	D1 A9				acall	args_gr_zero
 1020:	  2563	E5 38				mov	a, cursory			;check if within bounds
 1021:	  2565	B5 31 00			cjne	a, top, $+3
 1022:	  2568	40 DF				jc	do_csi_end1
 1023:	  256A	B5 32 00			cjne	a, bottom, $+3
 1024:	  256D	80 02				sjmp	do_csi_L1
 1025:	  256F	50 D8				jnc	do_csi_end1
 1026:	  2571	12 28 89	do_csi_L1:	call	cursor_off
 1027:	  2574	A8 26				mov	r0, arg0
 1028:	  2576	7B FF		do_csi_L2:	mov	r3, #-1
 1029:	  2578	C3				clr	c
 1030:	  2579	E5 32				mov	a, bottom
 1031:	  257B	95 38				subb	a, cursory
 1032:	  257D	FC				mov	r4, a
 1033:	  257E	F1 A7				acall	scroll_r4
 1034:	  2580	D8 F4				djnz	r0, do_csi_L2
 1035:	  2582	02 28 77			jmp	cursor_on
 1036:
 1037:	  2585	B4 4D 2B	do_csi_MM:	cjne	a, #'M', do_csi_hh		;delete line
 1038:	  2588	D1 A9				acall	args_gr_zero
 1039:	  258A	E5 38				mov	a, cursory			;check if within bounds
 1040:	  258C	B5 31 00			cjne	a, top, $+3
 1041:	  258F	40 B8				jc	do_csi_end1

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 20



 Line  I  Addr  Code            Source

 1042:	  2591	B5 32 00			cjne	a, bottom, $+3
 1043:	  2594	80 02				sjmp	do_csi_MM1
 1044:	  2596	50 B1				jnc	do_csi_end1
 1045:	  2598	12 28 89	do_csi_MM1:	call	cursor_off
 1046:	  259B	A8 26				mov	r0, arg0
 1047:	  259D	C0 31				push	top
 1048:	  259F	7B 01		do_csi_MM2:	mov	r3, #1
 1049:	  25A1	C3				clr	c
 1050:	  25A2	E5 32				mov	a, bottom
 1051:	  25A4	95 38				subb	a, cursory
 1052:	  25A6	FC				mov	r4, a
 1053:	  25A7	85 38 31			mov	top, cursory
 1054:	  25AA	F1 A7				acall	scroll_r4
 1055:	  25AC	D8 F1				djnz	r0, do_csi_MM2
 1056:	  25AE	D0 31				pop	top
 1057:	  25B0	02 28 77			jmp	cursor_on
 1058:
 1059:	  25B3	75 33 00	do_csi_hh:	mov	state, #ST_IDLE			;h set NEWLINE / INSERT
 1060:	  25B6	85 22 3C			mov	oldstatus, flags2
 1061:
 1062:	  25B9	B4 68 16			cjne	a, #'h', do_csi_ll		;set mode
 1063:	  25BC	78 26				mov	r0, #arg0
 1064:	  25BE	A9 25				mov	r1, nargs
 1065:	  25C0	B9 00 01			cjne	r1, #0, do_csi_hh1		;>= 1 arg
 1066:	  25C3	22				ret
 1067:	  25C4	B6 14 02	do_csi_hh1:	cjne	@r0, #LNM, do_csi_hh2
 1068:	  25C7	D2 12				setb	newlinemode			;set newlinemode
 1069:	  25C9	B6 04 02	do_csi_hh2:	cjne	@r0, #IRM, do_csi_hhx
 1070:	  25CC	D2 13				setb	insert				;set insert mode
 1071:	  25CE	08		do_csi_hhx:	inc	r0
 1072:	  25CF	D9 F3				djnz	r1, do_csi_hh1
 1073:	  25D1	22				ret
 1074:
 1075:	  25D2	B4 6C 16	do_csi_ll:	cjne	a, #'l', do_csi_P		;h reset NEWLINE / INSERT
 1076:	  25D5	78 26				mov	r0, #arg0
 1077:	  25D7	A9 25				mov	r1, nargs
 1078:	  25D9	B9 00 01			cjne	r1, #0, do_csi_ll1
 1079:	  25DC	22				ret
 1080:	  25DD	B6 14 02	do_csi_ll1:	cjne	@r0, #LNM, do_csi_ll2
 1081:	  25E0	C2 12				clr	newlinemode			;clear newlinemode
 1082:	  25E2	B6 04 02	do_csi_ll2:	cjne	@r0, #IRM, do_csi_llx
 1083:	  25E5	C2 13				clr	insert				;clear insert mode
 1084:	  25E7	08		do_csi_llx:	inc	r0
 1085:	  25E8	D9 F3				djnz	r1, do_csi_ll1
 1086:	  25EA	22				ret
 1087:
 1088:	  25EB	B4 50 2C	do_csi_P:	cjne	a, #'P', do_csi_end		;Delete Character (DCH)
 1089:	  25EE	D1 A9				acall	args_gr_zero
 1090:	  25F0	A9 26				mov	r1, arg0
 1091:	  25F2	C3		do_csi_P2:	clr	c
 1092:	  25F3	74 4F				mov	a, #WIDTH-1
 1093:	  25F5	95 37				subb	a, cursorx
 1094:	  25F7	60 21				jz	do_csi_end			;nothing to do
 1095:	  25F9	23				rl	a
 1096:	  25FA	F8				mov	r0, a
 1097:	  25FB	12 28 AC			call	comp_dptr			;compute dptr1

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 21



 Line  I  Addr  Code            Source

 1098:	  25FE	85 84 82			mov	dp0l, dp1l			;copy to dptr0
 1099:	  2601	85 85 83			mov	dp0h, dp1h
 1100:	  2604	A3				inc	dptr				;
 1101:	  2605	A3				inc	dptr				;dptr0 = dptr1 + 2
 1102:
 1103:	  2606	E0		do_csi_P1:	movx	a, @dptr
 1104:	  2607	E5 90				mov	a, P1
 1105:	  2609	A3				inc	dptr
 1106:	  260A	05 A2				inc	auxr1
 1107:	  260C	F0				movx	@dptr, a
 1108:	  260D	A3				inc	dptr
 1109:	  260E	05 A2				inc	auxr1
 1110:	  2610	D8 F4				djnz	r0, do_csi_P1
 1111:	  2612	05 A2				inc	auxr1
 1112:	  2614	E4				clr	a
 1113:	  2615	F0				movx	@dptr, a
 1114:	  2616	05 A2				inc	auxr1
 1115:	  2618	D9 D8				djnz	r1, do_csi_P2
 1116:	  261A	22		do_csi_end:	ret
 1117:
 1118:				;		mov	a, r0
 1119:				;		call	phex
 1120:				;		mov	a, dp0h
 1121:				;		call	phex
 1122:				;		mov	a, dp0l
 1123:				;		call	phex
 1124:				;		call	space
 1125:				;		mov	a, dp1h
 1126:				;		call	phex
 1127:				;		mov	a, dp1l
 1128:				;		call	phex
 1129:				;		call	space
 1130:				;		call	space
 1131:
 1132:				;===============================================
 1133:				; state CSI_questionmark "ESC [ ?"
 1134:				;===============================================
 1135:	  261B	F1 13		do_csi_q:	acall	isparm				;is parameter?
 1136:	  261D	50 08				jnc	do_csi_q_h			;no
 1137:	  261F	85 33 23			mov	retstate, state
 1138:	  2622	75 33 0A			mov	state, #ST_CMD_ARG
 1139:	  2625	C1 80				ajmp	do_cmd_arg
 1140:
 1141:	  2627	75 33 00	do_csi_q_h:	mov	state, #ST_IDLE
 1142:	  262A	85 22 3C			mov	oldstatus, flags2
 1143:
 1144:	  262D	B4 68 18			cjne	a, #'h', do_csi_q_l		;set mode
 1145:	  2630	78 26				mov	r0, #arg0
 1146:	  2632	A9 25				mov	r1, nargs
 1147:	  2634	B9 00 01			cjne	r1, #0, do_csi_q_h1		;>= 1 arg
 1148:	  2637	22				ret
 1149:	  2638	B6 07 02	do_csi_q_h1:	cjne	@r0, #DECAWM, do_csi_q_h2	;set auto wrap
 1150:	  263B	D2 10				setb	wrap
 1151:	  263D	B6 06 04	do_csi_q_h2:	cjne	@r0, #DECOM, do_csi_q_hx	;set origin
 1152:	  2640	D2 11				setb	origin
 1153:	  2642	81 D1				ajmp	do_csi_rc			;position cursor home

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 22



 Line  I  Addr  Code            Source

 1154:	  2644	08		do_csi_q_hx:	inc	r0
 1155:	  2645	D9 F1				djnz	r1, do_csi_q_h1
 1156:	  2647	22				ret
 1157:
 1158:	  2648	B4 6C 18	do_csi_q_l:	cjne	a, #'l', do_csi_q_end		;reset mode
 1159:	  264B	78 26				mov	r0, #arg0
 1160:	  264D	A9 25				mov	r1, nargs
 1161:	  264F	B9 00 02			cjne	r1, #0, do_csi_q_l1
 1162:	  2652	80 C6				sjmp	do_csi_end
 1163:	  2654	B6 07 02	do_csi_q_l1:	cjne	@r0, #DECAWM, do_csi_q_l2	;reset auto wrap
 1164:	  2657	C2 10				clr	wrap
 1165:	  2659	B6 06 04	do_csi_q_l2:	cjne	@r0, #DECOM, do_csi_q_lx	;reset origin
 1166:	  265C	C2 11				clr	origin
 1167:	  265E	81 D1				ajmp	do_csi_rc			;position cursor home
 1168:	  2660	08		do_csi_q_lx:	inc	r0
 1169:	  2661	D9 F1				djnz	r1, do_csi_q_l1
 1170:	  2663	22		do_csi_q_end:	ret
 1171:
 1172:
 1173:				;===============================================
 1174:				; state ESC_questionmark "ESC ?"
 1175:				;===============================================
 1176:	  2664			do_esc_q:
 1177:	  2664	75 33 00			mov	state, #ST_IDLE
 1178:	  2667	22				ret
 1179:
 1180:				;===============================================
 1181:				; state ESC_hash "ESC #"
 1182:				;===============================================
 1183:	  2668	75 33 00	do_esc_hash:	mov	state, #ST_IDLE
 1184:
 1185:	  266B	B4 38 05			cjne	a, #'8', do_esc_hash_end
 1186:	  266E	7C 45				mov	r4, #'E'
 1187:	  2670	02 28 2A			jmp	fill_screen
 1188:
 1189:	  2673			do_esc_hash_end:
 1190:	  2673	22				ret
 1191:
 1192:
 1193:				;===============================================
 1194:				; state ESC right-bracket "ESC )"
 1195:				;===============================================
 1196:	  2674			do_esc_rbrack:
 1197:				;===============================================
 1198:				; state ESC left-bracket "ESC ("
 1199:				;===============================================
 1200:	  2674	75 33 00	do_esc_lbrack:	mov	state, #ST_IDLE
 1201:
 1202:	  2677	B4 30 03			cjne	a, #'0', do_esc_lb_1
 1203:	  267A	D2 00				setb	special
 1204:	  267C	22				ret
 1205:	  267D	C2 00		do_esc_lb_1:	clr	special
 1206:	  267F	22				ret
 1207:
 1208:
 1209:				;===============================================

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 23



 Line  I  Addr  Code            Source

 1210:				; state command arg
 1211:				;===============================================
 1212:	  2680			do_cmd_arg:
 1213:	  2680	F9				mov	r1, a			;save a
 1214:	  2681	74 26				mov	a, #arg0		;pointer to vars
 1215:	  2683	25 25				add	a, nargs
 1216:	  2685	F8				mov	r0, a
 1217:	  2686	E9				mov	a, r1
 1218:	  2687	F1 1E				acall	isdigit
 1219:	  2689	50 0A				jnc	do_cmd_arg_1		;no digit
 1220:				;		inc	argcnt
 1221:	  268B	E6				mov	a, @r0
 1222:	  268C	75 F0 0A			mov	b, #10
 1223:	  268F	A4				mul	ab
 1224:	  2690	29				add	a, r1
 1225:	  2691	94 30				subb	a, #'0'
 1226:	  2693	F6				mov	@r0, a
 1227:	  2694	22				ret
 1228:	  2695	B4 3B 03	do_cmd_arg_1:	cjne	a, #';', do_cmd_arg_2
 1229:	  2698	05 25				inc	nargs
 1230:				;		mov	a, argcnt
 1231:				;		jnz	do_cmd_arg_3
 1232:				;		mov	@r0, #1
 1233:				;do_cmd_arg_3:	mov	argcnt, #0
 1234:	  269A	22				ret
 1235:	  269B	B4 1B 04	do_cmd_arg_2:	cjne	a, #C_ESC, do_cmd_arg_3
 1236:	  269E	75 33 02			mov	state, #ST_ESC
 1237:	  26A1	22				ret
 1238:	  26A2	05 25		do_cmd_arg_3:	inc	nargs
 1239:	  26A4	85 23 33			mov	state, retstate
 1240:	  26A7			do_cmd_arg_4:	;mov	retstate, #0
 1241:	  26A7	21 E4				ajmp	ansiout
 1242:
 1243:
 1244:				;
 1245:				; set arg0-3 to one if zero
 1246:				;
 1247:	  26A9	C0 00		args_gr_zero:	push	ar0
 1248:	  26AB	C0 01				push	ar1
 1249:	  26AD	78 26				mov	r0, #arg0
 1250:	  26AF	79 04				mov	r1, #4
 1251:	  26B1	B6 00 01	args_gr_zero_2:	cjne	@r0, #0, args_gr_zero_1
 1252:	  26B4	06				inc	@r0
 1253:	  26B5	08		args_gr_zero_1:	inc	r0
 1254:	  26B6	D9 F9				djnz	r1, args_gr_zero_2
 1255:	  26B8	D0 01				pop	ar1
 1256:	  26BA	D0 00				pop	ar0
 1257:	  26BC	22				ret
 1258:
 1259:				; r0: x - offset
 1260:				; r1: y - offset
 1261:				; r2: 0: without scroll, 1: with scroll
 1262:				; r3: scroll occured
 1263:				; r4: 0 = within bounds, 1 = out of bounds
 1264:	  26BD			ansi_move:
 1265:						;acall	cursor_off

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 24



 Line  I  Addr  Code            Source

 1266:
 1267:	  26BD	7B 00				mov	r3, #0			;no scroll
 1268:	  26BF	AC 31				mov	r4, top
 1269:	  26C1	AD 32				mov	r5, bottom
 1270:
 1271:				;
 1272:				; check new x-posiion
 1273:				;
 1274:	  26C3	E8				mov	a, r0
 1275:	  26C4	25 37				add	a, cursorx		;< 0?
 1276:	  26C6	30 E7 01			jnb	acc.7, ansi_move_x1	;no, check width
 1277:	  26C9	E4				clr	a
 1278:	  26CA	B4 50 00	ansi_move_x1:	cjne	a, #WIDTH, $+3		;>= WIDTH ?
 1279:	  26CD	40 02				jc	ansi_move_x3		;< WIDTH
 1280:	  26CF	74 4F				mov	a, #WIDTH-1		;=WIDTH, set to WIDTH-1
 1281:	  26D1	F5 37		ansi_move_x3:	mov	cursorx, a
 1282:
 1283:				;
 1284:				; check if within margins
 1285:				;
 1286:	  26D3	20 11 13			jb	origin, ansi_move_y	;if origin, no out-of-margins
 1287:	  26D6	E5 38				mov	a, cursory		;check margins
 1288:	  26D8	B5 31 00			cjne	a, top, $+3
 1289:	  26DB	40 07				jc	ansi_move_m1		;< top!
 1290:	  26DD	B5 32 02			cjne	a, bottom, $+5
 1291:	  26E0	80 07				sjmp	ansi_move_y		;= bottom
 1292:	  26E2	40 05				jc	ansi_move_y		;< bottom
 1293:	  26E4	E4		ansi_move_m1:	clr	a
 1294:	  26E5	FA				mov	r2, a			;no scroll
 1295:	  26E6	FC				mov	r4, a
 1296:	  26E7	7D 17				mov	r5, #HEIGHT-1
 1297:
 1298:				;
 1299:				; check y-position
 1300:				;
 1301:	  26E9	E9		ansi_move_y:	mov	a, r1
 1302:	  26EA	25 38				add	a, cursory		;
 1303:	  26EC	20 E7 05			jb	acc.7, ansi_move_y2	;< 0
 1304:	  26EF	B5 04 00			cjne	a, ar4, $+3		;
 1305:	  26F2	50 04				jnc	ansi_move_y1		;>= top
 1306:	  26F4	C3		ansi_move_y2:	clr	c
 1307:	  26F5	9C				subb	a, r4
 1308:	  26F6	FB				mov	r3, a
 1309:	  26F7	EC				mov	a, r4			;< top, set to top
 1310:
 1311:	  26F8	B5 05 02	ansi_move_y1:	cjne	a, ar5, $+5		;= bottom ?
 1312:	  26FB	80 05				sjmp	ansi_move_y3		;yes
 1313:	  26FD	40 03				jc	ansi_move_y3		;< bottom?
 1314:	  26FF	9D				subb	a, r5			;no, >bottom
 1315:	  2700	FB				mov	r3, a
 1316:	  2701	ED				mov	a, r5			;set to bottom
 1317:	  2702	F5 38		ansi_move_y3:	mov	cursory, a
 1318:	  2704	12 28 89			call	cursor_off
 1319:
 1320:	  2707	EA				mov	a, r2			;is scrolling enabled ?
 1321:	  2708	60 05				jz	ansi_move_ex		;no, exit

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 25



 Line  I  Addr  Code            Source

 1322:	  270A	EB				mov	a, r3			;did scrolling occur?
 1323:	  270B	60 02				jz	ansi_move_ex		;no, exit
 1324:
 1325:	  270D	F1 A1				acall	scroll
 1326:
 1327:	  270F	12 28 69	ansi_move_ex:	call	draw_cursor
 1328:	  2712	22				ret
 1329:
 1330:				;ansi_line_left:
 1331:						;call	phex
 1332:				;		ret
 1333:
 1334:	  2713	F1 1E		isparm:		acall	isdigit
 1335:	  2715	40 04				jc	isparmex
 1336:	  2717	B4 3B 02			cjne	a, #';', isparm1
 1337:	  271A	D3				setb	c
 1338:	  271B	22		isparmex:	ret
 1339:	  271C	C3		isparm1:	clr	c
 1340:	  271D	22				ret
 1341:				;
 1342:				; is acc beteen '0' and '9'?
 1343:				; if so, return carry clear, set otherwise
 1344:				;
 1345:	  271E	B4 30 00	isdigit:	cjne	a, #'0', isdigit1
 1346:	  2721	50 02		isdigit1:	jnc	isdigit2		;>= '0'
 1347:	  2723	B3				cpl	c
 1348:	  2724	22				ret				;carry set
 1349:	  2725	B4 3A 00	isdigit2:	cjne	a, #'9'+1, isdigit3
 1350:	  2728	22		isdigit3:	ret				;= '9' carry clear
 1351:
 1352:
 1353:
 1354:				;===============================================
 1355:				; reset terminal
 1356:				;===============================================
 1357:	  2729	C2 AF		term_reset:	clr	ea
 1358:	  272B	F1 4D				acall	clear_vars
 1359:	  272D	75 3D 70			mov	defcol, #DEFAULTCOLOR
 1360:	  2730	85 3D 2D			mov	color, defcol
 1361:	  2733	75 32 17			mov	bottom, #HEIGHT-1
 1362:	  2736	75 34 40			mov	serstart, #serbuf
 1363:	  2739	75 35 40			mov	serend, #serbuf
 1364:	  273C	75 39 0A			mov	t0cnt, #C_TIME
 1365:
 1366:	  273F	F1 57				acall	resettabu
 1367:	  2741	12 28 28			call	clear_screen
 1368:	  2744	D2 AF				setb	ea
 1369:
 1370:	  2746	12 2B D4			call	prtstatus
 1371:	  2749	12 28 69			call	draw_cursor
 1372:	  274C	22				ret
 1373:
 1374:				;
 1375:				; clear 32 vars from "state" on
 1376:				;
 1377:	  274D	78 20		clear_vars:	mov	r0, #VARS	;clear term-vars

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 26



 Line  I  Addr  Code            Source

 1378:	  274F	79 40				mov	r1, #64
 1379:	  2751	76 00		clear_v1:	mov	@r0, #0
 1380:	  2753	08				inc	r0
 1381:	  2754	D9 FB				djnz	r1, clear_v1
 1382:	  2756	22				ret
 1383:
 1384:
 1385:	  2757	78 50		resettabu:	mov	r0, #tabutab
 1386:	  2759	79 0A				mov	r1, #10
 1387:	  275B	76 80		resettabu1:	mov	@r0, #128
 1388:	  275D	08				inc	r0
 1389:	  275E	D9 FB				djnz	r1, resettabu1
 1390:	  2760	89 50				mov	tabutab, r1	;R1 = 0
 1391:	  2762	05 59				inc	tabutab+9	;128 + 1 = 129
 1392:	  2764	22				ret
 1393:
 1394:
 1395:	  2765	78 50		cleartabu:	mov	r0, #tabutab
 1396:	  2767	79 0A				mov	r1, #10
 1397:	  2769	76 00		cleartabu1:	mov	@r0, #0
 1398:	  276B	08				inc	r0
 1399:	  276C	D9 FB				djnz	r1, cleartabu1
 1400:	  276E	05 59				inc	tabutab+9	;tabutab+9 = 1
 1401:	  2770	22				ret
 1402:
 1403:				;
 1404:				; compute
 1405:				; r0 = cursorx / 8 (byte holding tab-info) + tabutab
 1406:				; r1 = cursorx AND 7 (bi tposition within byte)
 1407:				;
 1408:	  2771	E5 37		tab_set_r0_r1:	mov	a, cursorx
 1409:	  2773	03				rr	a
 1410:	  2774	03				rr	a
 1411:	  2775	03				rr	a
 1412:	  2776	54 0F				anl	a, #0fh
 1413:	  2778	24 50				add	a, #tabutab
 1414:	  277A	F8				mov	r0, a				;address byte
 1415:	  277B	E5 37				mov	a, cursorx
 1416:	  277D	54 07				anl	a, #7
 1417:	  277F	F9				mov	r1, a
 1418:	  2780	22				ret
 1419:
 1420:
 1421:	  2781	E9		getbit:		mov	a, r1
 1422:	  2782	04				inc	a
 1423:	  2783	83				movc	a, @a+pc
 1424:	  2784	22				ret
 1425:	  2785	80 40 20 10	getbittab:	db	128, 64, 32, 16, 8, 4, 2, 1
	  2789	08 04 02 01
 1426:
 1427:
 1428:	  278D	78 25		clearargs:	mov	r0, #nargs
 1429:	  278F	79 05				mov	r1, #5
 1430:	  2791	76 00		clearargs1:	mov	@r0, #0
 1431:	  2793	08				inc	r0
 1432:	  2794	D9 FB				djnz	r1, clearargs1

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 27



 Line  I  Addr  Code            Source

 1433:	  2796	22				ret
 1434:
 1435:
 1436:	  2797	E4		print:		clr	a
 1437:	  2798	93				movc	a, @a+dptr
 1438:	  2799	70 01				jnz	print1
 1439:	  279B	22				ret
 1440:	  279C	31 E4		print1:		acall	ansiout
 1441:	  279E	A3				inc	dptr
 1442:	  279F	80 F6				sjmp	print
 1443:
 1444:				;msg1:		db	C_ESC, "[J", C_ESC, "[5;5H", 0
 1445:				;msg4:		db	C_ESC,"[5;65H", C_ESC,"[31mH", C_ESC,"[32mello ", C_ESC, "[mWorld", C_ESC, "
				[AJ", C_ESC, "[23;65Ha", C_ESC, "[H"
 1446:				;msg2:		db	"Hello world!", C_NEWLINE,0
 1447:				;msg3:		db	C_ESC, "[5C", C_ESC, "[7D", 0
 1448:
 1449:				;===============================================
 1450:				; pyhsical routines
 1451:				;===============================================
 1452:
 1453:				;===============================================
 1454:				; scrolls one line up or down
 1455:				; clear first or last line
 1456:				; r3 positive (0-127) scroll-up, scroll-down otherwise
 1457:				; r4 numbers of lines to scroll
 1458:				; ----------------------------------------------
 1459:				; r5 used for x-count
 1460:				;===============================================
 1461:	  27A1	C3		scroll:		clr	c
 1462:	  27A2	E5 32				mov	a, bottom
 1463:	  27A4	95 31				subb	a, top
 1464:	  27A6	FC				mov	r4, a			;number of lines to scroll
 1465:	  27A7			scroll_r4:
 1466:	  27A7	BB 80 00			cjne	r3, #128, $+3
 1467:	  27AA	40 47				jc	scroll_up		;<128, positive, scroll up
 1468:
 1469:	  27AC	E5 32				mov	a, bottom
 1470:	  27AE	14				dec	a
 1471:	  27AF	75 F0 A0			mov	b, #WIDTH*2
 1472:	  27B2	A4				mul	ab
 1473:	  27B3	24 9F				add	a, #(WIDTH*2)-1
 1474:	  27B5	F5 82				mov	dp0l, a
 1475:	  27B7	E5 F0				mov	a, b
 1476:	  27B9	34 80				addc 	a, #80h
 1477:	  27BB	F5 83				mov	dp0h, a
 1478:
 1479:	  27BD	E5 82				mov	a, dp0l
 1480:	  27BF	24 A0				add	a, #WIDTH*2
 1481:	  27C1	F5 84				mov	dp1l, a
 1482:	  27C3	E5 83				mov	a, dp0h
 1483:	  27C5	34 00				addc	a, #0
 1484:	  27C7	F5 85				mov	dp1h, a
 1485:
 1486:				;		call	phex16
 1487:				;		mov	a, dp1h

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 28



 Line  I  Addr  Code            Source

 1488:				;		call	phex
 1489:				;		mov	a, dp1l
 1490:				;		call	phex
 1491:				;		jmp	cursor_on
 1492:
 1493:	  27C9	EC				mov	a, r4
 1494:	  27CA	60 1F				jz	scroll_down_6
 1495:	  27CC			scroll_down_4:
 1496:	  27CC	7D A0				mov	r5, #WIDTH*2
 1497:	  27CE			scroll_down_1:
 1498:	  27CE	E0				movx	a, @dptr
 1499:	  27CF	E5 90				mov	a, P1
 1500:	  27D1	05 A2				inc	auxr1
 1501:	  27D3	F0				movx	@dptr, a
 1502:	  27D4	05 A2				inc	auxr1
 1503:
 1504:	  27D6	E5 82				mov	a, dp0l
 1505:	  27D8	70 02				jnz	scroll_down_2
 1506:	  27DA	15 83				dec	dp0h
 1507:	  27DC	15 82		scroll_down_2:	dec	dp0l
 1508:
 1509:	  27DE	E5 84				mov	a, dp1l
 1510:	  27E0	70 02				jnz	scroll_down_3
 1511:	  27E2	15 85				dec	dp1h
 1512:	  27E4	15 84		scroll_down_3:	dec	dp1l
 1513:
 1514:	  27E6	DD E6				djnz	r5, scroll_down_1
 1515:	  27E8	DC E2				djnz	r4, scroll_down_4
 1516:
 1517:	  27EA	A3				inc	dptr
 1518:
 1519:						;call	phex16
 1520:	  27EB			scroll_down_6:
 1521:	  27EB	7D A0				mov	r5, #WIDTH*2
 1522:	  27ED	E4				clr	a
 1523:	  27EE	F0		scroll_down_5:	movx	@dptr, a
 1524:	  27EF	A3				inc	dptr
 1525:	  27F0	DD FC				djnz	r5, scroll_down_5
 1526:
 1527:						;ajmp	cursor_on		;reactivate cursor
 1528:	  27F2	22				ret
 1529:
 1530:	  27F3			scroll_up:
 1531:	  27F3	E5 31				mov	a, top			;dp0 = topline
 1532:	  27F5	75 F0 A0			mov	b, #WIDTH * 2		;dp1 = topline + 1
 1533:	  27F8	A4				mul	ab
 1534:	  27F9	F5 82				mov	dp0l, a
 1535:	  27FB	E5 F0				mov	a, b
 1536:	  27FD	34 80				addc	a, #80h
 1537:	  27FF	F5 83				mov	dp0h, a
 1538:
 1539:	  2801	E5 82				mov	a, dp0l
 1540:	  2803	24 A0				add	a, #WIDTH * 2
 1541:	  2805	F5 84				mov	dp1l, a
 1542:	  2807	E5 83				mov	a, dp0h
 1543:	  2809	34 00				addc	a, #0

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 29



 Line  I  Addr  Code            Source

 1544:	  280B	F5 85				mov	dp1h, a
 1545:
 1546:	  280D	EC				mov	a, r4
 1547:	  280E	60 10				jz	scroll_up_4
 1548:
 1549:	  2810			scroll_up_1:
 1550:	  2810	7D A0				mov	r5, #WIDTH * 2
 1551:
 1552:	  2812	05 A2		scroll_up_2:	inc	auxr1			;copy from line n+1 to line n
 1553:	  2814	E0				movx	a, @dptr
 1554:	  2815	A3				inc	dptr
 1555:	  2816	E5 90				mov	a, P1
 1556:	  2818	05 A2				inc	auxr1
 1557:	  281A	F0				movx	@dptr, a
 1558:	  281B	A3				inc	dptr
 1559:	  281C	DD F4				djnz	r5, scroll_up_2
 1560:	  281E	DC F0				djnz	r4, scroll_up_1
 1561:
 1562:	  2820			scroll_up_4:
 1563:	  2820	7D A0				mov	r5, #WIDTH * 2		;clear last line
 1564:	  2822	E4				clr	a
 1565:	  2823	F0		scroll_up_3:	movx	@dptr, a
 1566:	  2824	A3				inc	dptr
 1567:	  2825	DD FC				djnz	r5, scroll_up_3
 1568:
 1569:	  2827	22				ret
 1570:						;ajmp	cursor_on		;restore cursor
 1571:
 1572:
 1573:				;
 1574:				; r0: top line
 1575:				; r1: bottom line
 1576:				; r2: start position first line
 1577:				; r3: chars to fill first line
 1578:				; r4: value filled with
 1579:				; r5; chars to fill last line
 1580:				;
 1581:	  2828	7C 00		clear_screen:	mov	r4, #0
 1582:	  282A	E4		fill_screen:	clr	a
 1583:	  282B	F8				mov	r0, a
 1584:	  282C	79 17				mov	r1, #HEIGHT-1
 1585:	  282E	FA				mov	r2, a
 1586:	  282F	7B 50				mov	r3, #WIDTH
 1587:	  2831	7D 50				mov	r5, #WIDTH
 1588:	  2833	80 02				sjmp	fill_lines
 1589:
 1590:	  2835			clear_lines:
 1591:	  2835	7C 00				mov	r4, #0				;fill with zero
 1592:	  2837			fill_lines:
 1593:	  2837	EA				mov	a, r2				;r2 = r2 * 2
 1594:	  2838	23				rl	a
 1595:	  2839	FA				mov	r2, a
 1596:
 1597:	  283A	E9				mov	a, r1				;r1 = r1 - r0 + 1
 1598:	  283B	C3				clr	c
 1599:	  283C	98				subb	a, r0

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 30



 Line  I  Addr  Code            Source

 1600:	  283D	04				inc	a
 1601:	  283E	F9				mov	r1, a				;line count in r1
 1602:
 1603:	  283F	E8				mov	a, r0				;compute start-position from r0 und r2
 1604:	  2840	75 F0 A0			mov	b, #WIDTH * 2
 1605:	  2843	A4				mul	ab
 1606:	  2844	2A				add	a, r2
 1607:	  2845	F5 84				mov	dp1l, a
 1608:	  2847	E5 F0				mov	a, b
 1609:	  2849	34 80				addc	a, #80h
 1610:	  284B	F5 85				mov	dp1h, a
 1611:
 1612:	  284D	05 A2				inc	auxr1				;switch to dptr1
 1613:	  284F	A8 03				mov	r0, ar3				;chars to fill first line
 1614:
 1615:	  2851	B9 01 02	clear_lines2:	cjne 	r1, #1, clear_lines1		;last line?
 1616:	  2854	A8 05				mov	r0, ar5				;chars to fill last line
 1617:	  2856	EC		clear_lines1:	mov	a, r4
 1618:	  2857	F0				movx	@dptr, a
 1619:	  2858	A3				inc	dptr
 1620:	  2859	74 70				mov	a, #70h
 1621:	  285B	F0				movx	@dptr, a
 1622:	  285C	A3				inc	dptr
 1623:	  285D	D8 F7				djnz	r0, clear_lines1
 1624:	  285F	78 50				mov	r0, #WIDTH
 1625:	  2861	D9 EE				djnz	r1, clear_lines2
 1626:	  2863	05 A2				inc	auxr1
 1627:	  2865	22				ret
 1628:
 1629:
 1630:				;===============================================
 1631:				; move cursor
 1632:				;===============================================
 1633:	  2866	12 28 89	move_cursor:	call	cursor_off			;restore color under cursor
 1634:	  2869	12 28 AC	draw_cursor:	call	comp_dptr			;compute new address
 1635:	  286C	05 A2				inc	auxr1				;increase by 1 for color
 1636:	  286E	A3				inc	dptr
 1637:	  286F	05 A2				inc	auxr1
 1638:	  2871	85 84 2E			mov	cursorpos, dp1l			;store in cursorpos/+1
 1639:	  2874	85 85 2F			mov	cursorpos+1, dp1h
 1640:
 1641:				;		ajmp	cursor_on			;save color under cursor
 1642:				;
 1643:				; save color under new cursor position in cursorsave
 1644:				; enable interrupt
 1645:				;
 1646:	  2877			cursor_on:	;mov	a, cursorpos+1
 1647:						;call	phex
 1648:						;mov	a, cursorpos
 1649:						;call	phex
 1650:
 1651:	  2877	85 2E 84			mov	dp1l, cursorpos
 1652:	  287A	85 2F 85			mov	dp1h, cursorpos+1
 1653:	  287D	05 A2				inc	auxr1
 1654:	  287F	E0				movx	a, @dptr
 1655:	  2880	E5 90				mov	a, P1

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 31



 Line  I  Addr  Code            Source

 1656:	  2882	F5 30				mov	cursorsave, a
 1657:	  2884	05 A2				inc	auxr1
 1658:	  2886	D2 8C				setb	tr0				;enable timer
 1659:	  2888	22				ret
 1660:
 1661:				;
 1662:				; clear timer0 interrupt
 1663:				; restore color under cursor
 1664:				; reset t0cnt
 1665:				;
 1666:	  2889	C2 8C		cursor_off:	clr	tr0				;stop timer
 1667:
 1668:				;		mov	a, cursorpos+1
 1669:				;		call	phex
 1670:				;		mov	a, cursorpos
 1671:				;		call	phex
 1672:
 1673:	  288B	85 2E 84			mov	dp1l, cursorpos
 1674:	  288E	85 2F 85			mov	dp1h, cursorpos+1
 1675:	  2891	05 A2				inc	auxr1
 1676:	  2893	E5 30				mov	a, cursorsave
 1677:	  2895	F0				movx	@dptr, a
 1678:	  2896	05 A2				inc	auxr1
 1679:	  2898	75 8C 80			mov	TH0, #128
 1680:	  289B	75 39 01			mov	t0cnt, #1
 1681:	  289E	22				ret
 1682:
 1683:				;
 1684:				; converts accu	into two digits in R0, R1 (high, low)
 1685:				;
 1686:	  289F	75 F0 0A	hex2dez:	mov	b, #10
 1687:	  28A2	84				div	ab
 1688:	  28A3	24 30				add	a, #'0'
 1689:	  28A5	F8				mov	r0, a
 1690:	  28A6	E5 F0				mov	a, b
 1691:	  28A8	24 30				add	a, #'0'
 1692:	  28AA	F9				mov	r1, a
 1693:	  28AB	22				ret
 1694:
 1695:				;
 1696:				; compute dp1 cursor screen address
 1697:				; dp1l/h = cursorx * 2 + cursory * WIDTH * 2 + 0x8000
 1698:				;
 1699:	  28AC			comp_dptr:
 1700:	  28AC	E5 37				mov	a, cursorx
 1701:	  28AE	23				rl	a
 1702:	  28AF	FF				mov	r7, a
 1703:
 1704:	  28B0	E5 38				mov	a, cursory
 1705:	  28B2	75 F0 A0			mov	b, #WIDTH * 2
 1706:	  28B5	A4				mul	ab
 1707:
 1708:	  28B6	2F				add	a, r7
 1709:	  28B7	F5 84				mov	dp1l, a
 1710:	  28B9	E5 F0				mov	a, b
 1711:	  28BB	34 80				addc	a, #80h

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 32



 Line  I  Addr  Code            Source

 1712:	  28BD	F5 85				mov	dp1h, a
 1713:	  28BF	22				ret
 1714:
 1715:						$INCLUDE (io.a51)
 1716: 1			;
 1717: 1			;
 1718: 1			;
 1719: 1  28C0			init6845:
 1720: 1  28C0	90 00 00			mov	dptr, #0		;enable ADR + DAT
 1721: 1  28C3	E0				movx	a, @dptr
 1722: 1
 1723: 1  28C4	90 80 00			mov	DPTR, #08000h
 1724: 1  28C7	05 A2				inc	AUXR1
 1725: 1  28C9	90 28 F7			mov	DPTR, #SYDATA
 1726: 1  28CC	05 A2				inc	AUXR1
 1727: 1  28CE	78 00				mov	R0, #0
 1728: 1
 1729: 1  28D0			setregs:
 1730: 1			;		call	PHEX
 1731: 1			;		call	SPACE
 1732: 1
 1733: 1  28D0	E8				mov	A, R0			; send address
 1734: 1  28D1	12 29 99			call	PHEX
 1735: 1  28D4	F0				movx	@DPTR,A			; address register
 1736: 1  28D5	D2 B5				setb	T1			; clock high
 1737: 1  28D7	C2 B5				clr	T1			; clock low
 1738: 1  28D9	A3				inc	DPTR			; data reg
 1739: 1
 1740: 1  28DA	05 A2				inc	AUXR1			;data pointer
 1741: 1  28DC	93				movc	A, @A+DPTR
 1742: 1  28DD	12 29 99			call	PHEX
 1743: 1  28E0	05 A2				inc	AUXR1			; address pointer
 1744: 1  28E2	F0				movx	@DPTR, A		; send data
 1745: 1  28E3	D2 B5				setb	T1			; clock high
 1746: 1  28E5	C2 B5				clr	T1			; clock low
 1747: 1
 1748: 1  28E7	12 29 4A			call	SPACE
 1749: 1  28EA	A3				inc	DPTR
 1750: 1  28EB	08				inc	R0
 1751: 1  28EC	B8 0F E1			cjne	R0, #15, setregs
 1752: 1
 1753: 1  28EF	90 00 00			mov	dptr, #0		;enable ADR + DAT
 1754: 1  28F2	E0				movx	a, @dptr
 1755: 1
 1756: 1  28F3	12 29 54			call	newline
 1757: 1			;		call	CIN
 1758: 1			;
 1759: 1			;		setb	INT0
 1760: 1			;		call	CIN
 1761: 1  28F6	22				ret
 1762: 1
 1763: 1			;
 1764: 1			; 25,333 Mhz / 8 = 3,166 Mhz
 1765: 1			;
 1766: 1			; 31468 HZ = 31,77 uS
 1767: 1			;

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 33



 Line  I  Addr  Code            Source

 1768: 1			; 25,333 Mhz / 8 / 31468 ~ 	100 chars Horizontal Total
 1769: 1			;				  2 chars Fornt Porch
 1770: 1			;				  6 chars Back Porch
 1771: 1			;				 80 chars Horizontal Visible
 1772: 1			;				 12 chars Sync Pulse
 1773: 1			;Scanline part	Pixels	Time [µs]
 1774: 1			;Visible area	640	25.422045680238
 1775: 1			;Front porch	16	0.63555114200596
 1776: 1			;Sync pulse	96	3.8133068520357
 1777: 1			;Back porch	48	1.9066534260179
 1778: 1			;Whole line	800	31.777557100298
 1779: 1
 1780: 1			;Frame part	Lines	Time [ms]
 1781: 1			;Visible area	400	12.711022840119
 1782: 1			;Front porch	12	0.38133068520357
 1783: 1			;Sync pulse	2	0.063555114200596
 1784: 1			;Back porch	35	1.1122144985104
 1785: 1			;Whole frame	449	14.268123138034
 1786: 1			;
 1787: 1  28F7	64		SYDATA:		DB	100		;R0 Horizontal Total - 1
 1788: 1  28F8	50				DB	80		;R1 Horizontal Displayed
 1789: 1  28F9	54				DB	84		;R2 Horizontal Sync Position
 1790: 1  28FA	0C				DB	0ch		;R3 VSYNC & HSYNC width
 1791: 1  28FB	1C				DB	28		;R4 Vertical total - 1			;27	32
 1792: 1  28FC	05				DB	5		;R5 Vertical Adjust
 1793: 1  28FD	19				DB	25		;R6 Vertical Displayed			;25	30
 1794: 1  28FE	1B				DB	27		;R7 Vertical Sync Position		;25	32
 1795: 1  28FF	00				DB	00h		;R8 Mode Control
 1796: 1  2900	0F				DB	15		;R9 Scan Lines - 1 (character lines)
 1797: 1  2901	00				DB	0		;R10 Cursor Start
 1798: 1  2902	00				DB	0		;R11 Cursor End
 1799: 1  2903	00				DB	000h		;R12 Display Start High
 1800: 1  2904	00				DB	000h		;R13 Display Start Low
 1801: 1  2905	00				DB	0		;R14 Cursor Pos High
 1802: 1  2906	00				DB	0		;R15 Cursor Pos Low
 1803: 1  2907	00				DB	0		;R16 Light Pen High
 1804: 1  2908	00				DB	0		;R17 Light Pen Low
 1805: 1  2909	00				DB	0		;R18 Update Address Reg High
 1806: 1  290A	00				DB	0		;R19 Update Address Reg Low
 1807: 1								;R31 Dummy Register
 1808: 1			;
 1809: 1			;
 1810: 1			;
 1811: 1  290B			copyFont:
 1812: 1  290B	90 70 00			mov	DPTR, #7000h
 1813: 1  290E	05 A2				inc	AUXR1
 1814: 1  2910	90 A0 00			mov	DPTR, #(8000h+2000h) ;+4000h+1000h
 1815: 1  2913	05 A2				inc	AUXR1
 1816: 1
 1817: 1  2915	E4		copyFont1:	clr	A
 1818: 1  2916	93				movc	A, @A+DPTR
 1819: 1  2917	A3				inc	DPTR
 1820: 1  2918	05 A2				inc	AUXR1
 1821: 1  291A	F0				movx	@DPTR, A
 1822: 1  291B	A3				inc	DPTR
 1823: 1  291C	05 A2				inc	AUXR1

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 34



 Line  I  Addr  Code            Source

 1824: 1
 1825: 1  291E	E5 83				mov	A, DP0H
 1826: 1					;call	PHEX
 1827: 1  2920	B4 80 F2			cjne	A, #80h, copyFont1
 1828: 1
 1829: 1			;		mov	A, AUXR1
 1830: 1			;		call	PHEX
 1831: 1			;		call	newline
 1832: 1  2923	22				ret
 1833: 1
 1834: 1			;
 1835: 1			;
 1836: 1			;
 1837: 1  2924	90 80 00	testScreen:	mov	DPTR, #8000h
 1838: 1  2927	78 15				mov	R0, #21
 1839: 1
 1840: 1  2929	79 50		testScreen3:	mov	R1, #80
 1841: 1  292B	7A 01				mov	R2, #1
 1842: 1  292D	EA		testScreen1:	mov	A, R2
 1843: 1  292E	F0				movx	@DPTR, A
 1844: 1  292F	A3				inc	DPTR
 1845: 1  2930	74 70				mov	A, #70h
 1846: 1					;anl	A, #3
 1847: 1					;orl	A, #0f0h
 1848: 1					;inc	A
 1849: 1  2932	F0				movx	@DPTR, A
 1850: 1  2933	A3				inc	DPTR
 1851: 1  2934	0A				inc	R2
 1852: 1  2935	BA 3A 02			cjne	R2, #'9'+1, testScreen2
 1853: 1  2938	7A 30				mov	R2, #'0'
 1854: 1  293A	D9 F1		testScreen2:	djnz	R1, testScreen1
 1855: 1  293C	D8 EB				djnz	R0, testScreen3
 1856: 1
 1857: 1  293E	E8		testScreen4:	mov	a, r0
 1858: 1  293F	F0				movx	@dptr, a
 1859: 1  2940	A3				inc	dptr
 1860: 1  2941	74 60				mov	a, #60h
 1861: 1  2943	F0				movx	@dptr, a
 1862: 1  2944	A3				inc	dptr
 1863: 1  2945	08				inc	r0
 1864: 1  2946	B8 00 F5			cjne	r0, #0, testScreen4
 1865: 1  2949	22				ret
 1866: 1			;
 1867: 1			;
 1868: 1			;
 1869: 1  294A	C0 E0		space:		push	acc
 1870: 1  294C	74 20				mov	a, #' '
 1871: 1  294E	12 29 5E			call	cout
 1872: 1  2951	D0 E0				pop	acc
 1873: 1  2953	22				ret
 1874: 1
 1875: 1  2954	C0 E0		newline:	push	acc
 1876: 1  2956	74 0A				mov	a, #0ah
 1877: 1  2958	12 29 5E			call	cout
 1878: 1  295B	D0 E0				pop	acc
 1879: 1  295D	22				ret

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 35



 Line  I  Addr  Code            Source

 1880: 1
 1881: 1
 1882: 1  295E	20 05 FD	cout:		jb	serbusy, cout
 1883: 1  2961	D2 05				setb	serbusy
 1884: 1  2963	F5 99				mov	sbuf, a
 1885: 1  2965	22				ret
 1886: 1
 1887: 1
 1888: 1  2966	30 99 FD	cout_x:		jnb	ti, cout_x
 1889: 1  2969	C2 99				clr	ti			;clr ti before the mov to sbuf!
 1890: 1  296B	F5 99				mov	sbuf, a
 1891: 1  296D	22				ret
 1892: 1
 1893: 1  296E	C0 00		cin:		push	ar0
 1894: 1  2970	E5 34		cin_2:		mov	a, serstart
 1895: 1  2972	B5 35 02			cjne	a, serend, cin_1
 1896: 1  2975	80 F9				sjmp	cin_2
 1897: 1  2977	C2 AC		cin_1:		clr	ES			;no serial interrupt
 1898: 1  2979	04				inc	a
 1899: 1  297A	F8				mov	r0, a
 1900: 1  297B	B8 50 00			cjne	r0, #serbuf+16, $+3
 1901: 1  297E	40 02				jc	cin_3
 1902: 1  2980	78 40				mov	r0, #serbuf
 1903: 1  2982	E6		cin_3:		mov	a, @r0
 1904: 1  2983	88 34				mov	serstart, r0
 1905: 1  2985	15 36				dec	sercount
 1906: 1			;		push	acc
 1907: 1			;		mov	a, sercount
 1908: 1			;		call	phex
 1909: 1			;		pop	acc
 1910: 1
 1911: 1  2987	A8 36		cin_5:		mov	r0, sercount
 1912: 1  2989	B8 00 08			cjne	r0, #0, cin_4
 1913: 1
 1914: 1  298C	30 04 05			jnb	xonoff, cin_4
 1915: 1
 1916: 1  298F	75 99 11	cin_7:		mov	SBUF, #C_XON
 1917: 1  2992	C2 04				clr	xonoff
 1918: 1			;		mov	r0, #80
 1919: 1			;		djnz	r0, $
 1920: 1
 1921: 1  2994	D0 00		cin_4:		pop	ar0
 1922: 1  2996	D2 AC				setb	ES
 1923: 1  2998	22				ret
 1924: 1
 1925: 1
 1926: 1			;cin_x:		jnb	ri, cin
 1927: 1			;		clr	ri
 1928: 1			;		mov	a, sbuf
 1929: 1			;		ret
 1930: 1
 1931: 1			; Highly code efficient resursive call phex contributed
 1932: 1			; by Alexander B. Alexandrov <abalex@cbr.spb.ru>
 1933: 1
 1934: 1  2999			phex:
 1935: 1  2999			phex8:

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 36



 Line  I  Addr  Code            Source

 1936: 1  2999	31 9B				acall	phex_b
 1937: 1  299B	C4		phex_b:		swap	a		;SWAP A will be twice => A unchanged
 1938: 1  299C	C0 E0		phex1:		push	acc
 1939: 1  299E	54 0F				anl	a, #15
 1940: 1  29A0	24 90				add	a, #90h	; acc is 0x9X, where X is hex digit
 1941: 1  29A2	D4				da	a		; if A to F, C=1 and lower four bits are 0..5
 1942: 1  29A3	34 40				addc	a, #40h
 1943: 1  29A5	D4				da	a
 1944: 1  29A6	31 5E				call	cout
 1945: 1  29A8	D0 E0				pop	acc
 1946: 1  29AA	22				ret
 1947: 1
 1948: 1  29AB			phex16:
 1949: 1  29AB	C0 E0				push	acc
 1950: 1  29AD	E5 83				mov	a, dph
 1951: 1  29AF	31 99				call	phex
 1952: 1  29B1	E5 82				mov	a, dpl
 1953: 1  29B3	31 99				call	phex
 1954: 1  29B5	D0 E0				pop	acc
 1955: 1  29B7	22				ret
 1956: 1
 1957: 1			;a not so well documented feature of pstr is that you can print
 1958: 1			;multiple consecutive strings without needing to reload dptr
 1959: 1			;(which takes 3 bytes of code!)... this is useful for inserting
 1960: 1			;numbers or spaces between strings.
 1961: 1
 1962: 1  29B8	C0 E0		pstr:		push	acc
 1963: 1  29BA	E4		pstr1:		clr	a
 1964: 1  29BB	93				movc	a, @a+dptr
 1965: 1  29BC	A3				inc	dptr
 1966: 1  29BD	60 0A				jz	pstr2
 1967: 1  29BF	A2 E7				mov	c, acc.7
 1968: 1  29C1	55 7F				anl	a, 7Fh
 1969: 1  29C3	31 5E				call	cout
 1970: 1  29C5	40 02				jc	pstr2
 1971: 1  29C7	80 F1				sjmp	pstr1
 1972: 1  29C9	D0 E0		pstr2:		pop	acc
 1973: 1  29CB	22				ret
 1974: 1
 1975: 1			;converts the ascii code in Acc to uppercase, if it is lowercase
 1976: 1
 1977: 1			; Code efficient (saves 6 byes) upper contributed
 1978: 1			; by Alexander B. Alexandrov <abalex@cbr.spb.ru>
 1979: 1
 1980: 1			;upper:
 1981: 1			;		cjne	a, #97, upper2
 1982: 1			;upper2:		jc	upper4		;end if acc < 97
 1983: 1			;		cjne	a, #123, upper3
 1984: 1			;upper3:		jnc	upper4		;end if acc >= 123
 1985: 1			;		add	a, #224		;convert to uppercase
 1986: 1			;upper4:		ret
 1987:
 1988:				;===============================================
 1989:				; decode scancode
 1990:				;===============================================
 1991:	  29CC			keydecode:	;mov	a, keyrxval

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 37



 Line  I  Addr  Code            Source

 1992:						;call	phex
 1993:
 1994:	  29CC	74 E0				mov	a, #EXTENDED			;extended?
 1995:	  29CE	B5 3B 03			cjne	a, keyrxval, keybreak
 1996:	  29D1	D2 09				setb	keyrxextended			;set extended flag
 1997:	  29D3	22				ret
 1998:
 1999:	  29D4	74 F0		keybreak:	mov	a, #BREAK			;break?
 2000:	  29D6	B5 3B 03			cjne	a, keyrxval, keyshift
 2001:	  29D9	D2 0A				setb	keyrxbreak
 2002:	  29DB	22				ret
 2003:
 2004:	  29DC	74 12		keyshift:	mov	a, #CLSHIFT			;left-shift?
 2005:	  29DE	B5 3B 02			cjne	a, keyrxval, keyshift1
 2006:	  29E1	80 05				sjmp	keyshift2
 2007:	  29E3	74 59		keyshift1:	mov	a, #CRSHIFT			;right shift?
 2008:	  29E5	B5 3B 07			cjne	a, keyrxval, keyStrg
 2009:	  29E8	A2 0A		keyshift2:	mov	c, keyrxbreak
 2010:	  29EA	B3				cpl	c
 2011:	  29EB	92 0B				mov	keyrxshift, c
 2012:	  29ED	80 16				sjmp	keyCheckBrk1
 2013:
 2014:	  29EF	74 14		keyStrg:	mov	a, #CLSTRG
 2015:	  29F1	B5 3B 07			cjne	a, keyrxval, keyCheckBrk
 2016:	  29F4	A2 0A				mov	c, keyrxbreak
 2017:	  29F6	B3				cpl	c
 2018:	  29F7	92 0D				mov	keyrxstrg, c
 2019:	  29F9	80 0A				sjmp	keyCheckBrk1
 2020:
 2021:	  29FB	30 0A 0C	keyCheckBrk:	jnb	keyrxbreak, keynormal		;break active?
 2022:	  29FE	74 11				mov	a, #ALTGR			;ALT-GR?
 2023:	  2A00	B5 3B 02			cjne	a, keyrxval, keyCheckBrk1
 2024:	  2A03	C2 0C				clr	keyrxaltgr			;clear ALT-GR
 2025:	  2A05	C2 0A		keyCheckBrk1:	clr	keyrxbreak
 2026:	  2A07	C2 09				clr	keyrxextended
 2027:	  2A09	22				ret
 2028:
 2029:	  2A0A	C0 00		keynormal:	push	ar0
 2030:	  2A0C	30 0B 05			jnb	keyrxshift, keyMakeExt
 2031:	  2A0F	12 2A EA			call	keygetshift
 2032:	  2A12	80 3A				sjmp	keyExitOK
 2033:
 2034:	  2A14	30 09 1A	keyMakeExt:	jnb	keyrxextended, keyAltGr
 2035:	  2A17	C2 09				clr	keyrxextended			;clear extended
 2036:	  2A19	78 0D				mov	r0, #13
 2037:	  2A1B	12 2B 95	keyMakeExt2:	call	keygetextind
 2038:	  2A1E	B5 3B 0C			cjne	a, keyrxval, keyMakeExt1	;found?
 2039:	  2A21	12 2B A5			call	keygetext
 2040:	  2A24	B4 11 04			cjne	a, #ALTGR, keyMakeExt3		;ALTGR-pressed?
 2041:	  2A27	D2 0C				setb	keyrxaltgr			;set ALTGR-flag
 2042:	  2A29	80 27				sjmp	keyExit
 2043:	  2A2B	80 21		keyMakeExt3:	sjmp	keyExitOK
 2044:	  2A2D	D8 EC		keyMakeExt1:	djnz	r0, keyMakeExt2
 2045:	  2A2F	80 21				sjmp	keyExit
 2046:
 2047:	  2A31	30 0C 11	keyAltGr:	jnb	keyrxaltgr, keyMake		;AltGR pressed?

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 38



 Line  I  Addr  Code            Source

 2048:	  2A34	78 08				mov	r0, #8
 2049:	  2A36	12 2B 7F	keyAltGr2:	call	keygetaltgrind
 2050:	  2A39	B5 3B 05			cjne	a, keyrxval, keyAltGr1		;found?
 2051:	  2A3C	12 2B 8A			call	keygetaltgr
 2052:	  2A3F	80 0D				sjmp	keyExitOK
 2053:	  2A41	D8 F3		keyAltGr1:	djnz	r0, keyAltGr2
 2054:	  2A43	80 0D				sjmp	keyExit
 2055:
 2056:	  2A45	12 2A 55	keyMake:	call	keygetnoshift
 2057:	  2A48	30 0D 03			jnb	keyrxstrg, keyExitOK
 2058:	  2A4B	C3				clr	c
 2059:	  2A4C	94 60				subb	a, #96
 2060:
 2061:	  2A4E	F5 3B		keyExitOK:	mov	keyrxval, a
 2062:	  2A50	D2 08				setb	keyavail
 2063:
 2064:				;		mov	p2, #High(08000h + 24*160 + 77*2)
 2065:				;		mov	r0, #Low(08000h + 24*160 + 77*2);
 2066:				;		movx	@r0, a
 2067:
 2068:	  2A52	D0 00		keyExit:	pop	ar0
 2069:	  2A54	22				ret
 2070:
 2071:
 2072:	  2A55	E5 3B		keygetnoshift:	mov	a, keyrxval
 2073:	  2A57	04				inc	a
 2074:	  2A58	83				movc	a, @a+pc
 2075:	  2A59	22				ret
 2076:	  2A5A			CHARTABLE_NOSHIFT:
 2077:				;		 	 00   01   02   03   04   05   06   07   08   09   0A   0B   0C   0D   0E
				0F
 2078:	  2A5A	00 88 00 84			db	  0,  F9,   0,  F5,  F3,  F1,  F2, F12,   0, F10,  F8,  F6,  F4,TABU, '^',
	  2A5E	82 80 81 8B	 0	; 00
	  2A62	00 89 87 85
	  2A66	83 09 5E 00
 2079:	  2A6A	00 00 00 00			db     	  0,   0,   0,   0,   0, 'q', '1',   0,   0,   0, 'y', 's', 'a', 'w', '2',
	  2A6E	00 71 31 00	 0	; 10
	  2A72	00 00 79 73
	  2A76	61 77 32 00
 2080:	  2A7A	00 63 78 64			db	  0, 'c', 'x', 'd', 'e', '4', '3',   0,   0, ' ', 'v', 'f', 't', 'r', '5',
	  2A7E	65 34 33 00	 0	; 20
	  2A82	00 20 76 66
	  2A86	74 72 35 00
 2081:	  2A8A	00 6E 62 68			db	  0, 'n', 'b', 'h', 'g', 'z', '6',   0,   0,   0, 'm', 'j', 'u', '7', '8',
	  2A8E	67 7A 36 00	 0	; 30
	  2A92	00 00 6D 6A
	  2A96	75 37 38 00
 2082:	  2A9A	00 2C 6B 69			db	  0, ',', 'k', 'i', 'o', '0', '9',   0,   0, '.', '-', 'l', 246, 'p', 223,
	  2A9E	6F 30 39 00	 0	; 40 	5c = \, 223 = ß
	  2AA2	00 2E 2D 6C
	  2AA6	F6 70 DF 00
 2083:	  2AAA	00 00 E4 58			db	  0,   0, 228,  'X',252, 180,   0,   0,   0,   0,C_CR, '+',   0, '#',   0,
	  2AAE	FC B4 00 00	 0	; 50
	  2AB2	00 00 0D 2B
	  2AB6	00 23 00 00
 2084:	  2ABA	00 3C 00 00			db	  0, '<',   0,   0,   0,   0,C_DEL,  0,   0, '1',   0, '4', '7',   0,   0,

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 39



 Line  I  Addr  Code            Source

	  2ABE	00 00 7F 00	 0	; 60
	  2AC2	00 31 00 34
	  2AC6	37 00 00 00
 2085:	  2ACA	30 2E 32 35			db	 '0', '.', '2', '5', '6', '8',ESC,   0, F11, '+', '3', '-', '*', '9', CLS,
	  2ACE	36 38 1B 00	 0	; 70
	  2AD2	8A 2B 33 2D
	  2AD6	2A 39 01 00
 2086:	  2ADA	00 00 00 86			db	  0,   0,   0,  F7,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
	  2ADE	00 00 00 00	 0	; 80
	  2AE2	00 00 00 00
	  2AE6	00 00 00 00
 2087:
 2088:	  2AEA	E5 3B		keygetshift:	mov	a, keyrxval
 2089:	  2AEC	04				inc	a
 2090:	  2AED	83				movc	a, @a+pc
 2091:	  2AEE	22				ret
 2092:	  2AEF			CHARTABLE_SHIFT:
 2093:				;		 	 00   01   02   03   04   05   06   07   08   09   0A   0B   0C   0D   0E
				0F
 2094:	  2AEF	00 09 00 05			db	  0,   9,   0,   5,   3,   1,   2,  12,   0,  10,   8,   6,   4,TABU,0B0h,
	  2AF3	03 01 02 0C	 0	; 00
	  2AF7	00 0A 08 06
	  2AFB	04 09 B0 00
 2095:	  2AFF	00 00 00 00			db        0,   0,   0,   0,   0, 'Q', '!',   0,   0,   0, 'Y', 'S', 'A', 'W', '"',
	  2B03	00 51 21 00	 0	; 10
	  2B07	00 00 59 53
	  2B0B	41 57 22 00
 2096:	  2B0F	00 43 58 44			db	  0, 'C', 'X', 'D', 'E', '$', 167,   0,   0, ' ', 'V', 'F', 'T', 'R', '%',
	  2B13	45 24 A7 00	 0	; 20 	167=§
	  2B17	00 20 56 46
	  2B1B	54 52 25 00
 2097:	  2B1F	00 4E 42 48			db	  0, 'N', 'B', 'H', 'G', 'Z', '&',   0,   0,   0, 'M', 'J', 'U', '/', '(',
	  2B23	47 5A 26 00	 0	; 30
	  2B27	00 00 4D 4A
	  2B2B	55 2F 28 00
 2098:	  2B2F	00 3B 4B 49			db	  0, ';', 'K', 'I', 'O', '=', ')',   0,   0, ':', '_', 'L', 214, 'P', '?',
	  2B33	4F 3D 29 00	 0	; 40
	  2B37	00 3A 5F 4C
	  2B3B	D6 50 3F 00
 2099:	  2B3F	00 00 C4 00			db	  0,   0, 196,   0, 220, '`',   0,   0,   0,   0,  LF, '*',   0,027h,   0,
	  2B43	DC 60 00 00	 0	; 50
	  2B47	00 00 0A 2A
	  2B4B	00 27 00 00
 2100:	  2B4F	00 3E 00 00			db	  0, '>',   0,   0,   0,   0,CDCH,   0,   0, '1',   0, CCLF, '7',   0,  0,
	  2B53	00 00 FE 00	 0	; 60
	  2B57	00 31 00 1E
	  2B5B	37 00 00 00
 2101:	  2B5F	30 2E 1D 35			db	'0', '.', CCDN, '5', CCRT, CCUP,  0,   0,  11, '+', '3', '-', '*', '9', 0,
	  2B63	1F 1C 00 00	 0  ; 70
	  2B67	0B 2B 33 2D
	  2B6B	2A 39 00 00
 2102:	  2B6F	00 00 00 07			db	  0,   0,   0,   7,   0,   0,   0,   0,   0,   0,   0,   0,   0,  0,    0,
	  2B73	00 00 00 00	 0	; 80
	  2B77	00 00 00 00
	  2B7B	00 00 00 00
 2103:

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 40



 Line  I  Addr  Code            Source

 2104:
 2105:	  2B7F	E8		keygetaltgrind:	mov	a, r0
 2106:	  2B80	83				movc	a, @a+pc
 2107:	  2B81	22				ret
 2108:	  2B82			ALTGR_TABLE_IND:
 2109:	  2B82	15				db	015h	; q = @
 2110:	  2B83	61				db	061h	; <> = |
 2111:	  2B84	5B				db	05Bh	; *+ = ~
 2112:	  2B85	4E				db	04Eh	; ?ß = \
 2113:	  2B86	3E				db	03Eh	; 8( = [
 2114:	  2B87	46				db	046h	; 9) = ]
 2115:	  2B88	3D				db	03Dh	; 7/ = {
 2116:	  2B89	45				db	045h	; 0= = }
 2117:
 2118:
 2119:	  2B8A	E8		keygetaltgr:	mov	a, r0
 2120:	  2B8B	83				movc	a, @a+pc
 2121:	  2B8C	22				ret
 2122:	  2B8D	40		ALTGR_TABLE:	db	'@'
 2123:	  2B8E	7C				db	'|'
 2124:	  2B8F	7E				db	'~'
 2125:	  2B90	5C				db	05Ch
 2126:	  2B91	5B				db	'['
 2127:	  2B92	5D				db	']'
 2128:	  2B93	7B				db	'{'
 2129:	  2B94	7D				db	'}'
 2130:
 2131:
 2132:	  2B95	E8		keygetextind:	mov	a, r0
 2133:	  2B96	83				movc	a, @a+pc
 2134:	  2B97	22				ret
 2135:	  2B98	11		EXT_TABLE_IND:	db	ALTGR
 2136:	  2B99	4A				db	04Ah	; /
 2137:	  2B9A	5A				db	05Ah	; ENTER
 2138:	  2B9B	69				db	069h	; END
 2139:	  2B9C	6B				db	06Bh	; LEFT
 2140:	  2B9D	6C				db	06Ch	; HOME
 2141:	  2B9E	70				db	070h	; INS
 2142:	  2B9F	71				db	071h	; DEL
 2143:	  2BA0	72				db	072h	; DOWN
 2144:	  2BA1	74				db	074h	; RIGHT
 2145:	  2BA2	75				db	075h	; Up
 2146:	  2BA3	7A				db	07Ah	; PAGE DOWN
 2147:	  2BA4	7D				db	07Dh	; PAGE UP
 2148:
 2149:	  2BA5	E8		keygetext:	mov	a, r0
 2150:	  2BA6	83				movc	a, @a+pc
 2151:	  2BA7	22				ret
 2152:	  2BA8	11		EXT_TABLE:	db	ALTGR
 2153:	  2BA9	2F				db	'/'	; NumPad division symbol
 2154:	  2BAA	0D				db	C_CR	; ENTER
 2155:	  2BAB	1D				db	CCBT	; cursor bottom with SuperFlag
 2156:	  2BAC	13				db	19	; cursor left	CTRL-S
 2157:	  2BAD	1C				db	CCHM	; cursor home with SuperFLag
 2158:	  2BAE	16				db	22	; insert	CTRL-V
 2159:	  2BAF	07				db	7	; delete	CTRL-G

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 41



 Line  I  Addr  Code            Source

 2160:	  2BB0	18				db	24	; cursor down	CTRL-X
 2161:	  2BB1	04				db	4	; cursor right	CTRL-D
 2162:	  2BB2	05				db	5	; cursor up	CTRL-E
 2163:	  2BB3	03				db	3	; pagedown CTRL-C
 2164:	  2BB4	12				db	18	; pageup CTRL-R
 2165:				;
 2166:				;
 2167:				;
 2168:	  2BB5	E8		getbaud:	mov	a, r0
 2169:	  2BB6	04				inc	a
 2170:	  2BB7	83				movc	a, @a+pc
 2171:	  2BB8	22				ret
 2172:	  2BB9	FF				db	0ffh	;115200
 2173:	  2BBA	F4				db	0f4h	;9600
 2174:	  2BBB	FA				db	0fah	;19200
 2175:	  2BBC	FD				db	0fdh	;38400
 2176:	  2BBD	FE				db	0feh	;57600
 2177:
 2178:	  2BBE	83		getbdtxt:	movc	a, @a+pc
 2179:	  2BBF	22				ret
 2180:	  2BC0	31 31 35 32			db	"1152"
 2181:	  2BC4	20 20 39 36			db	"  96"
 2182:	  2BC8	20 31 39 32			db	" 192"
 2183:	  2BCC	20 33 38 34			db	" 384"
 2184:	  2BD0	20 35 37 36			db	" 576"
 2185:
 2186:				;
 2187:				;
 2188:	  2BD4	90 8F 00	prtstatus:	mov	dptr, #08000h + 24 * WIDTH * 2
 2189:	  2BD7	78 01				mov	r0, #1
 2190:	  2BD9	91 1A		prtstatus1:	acall	getstatus			;get status line
 2191:	  2BDB	F0				movx	@dptr, a
 2192:	  2BDC	A3				inc	dptr
 2193:	  2BDD	74 06				mov	a, #TURQUOISE			;color turquoise
 2194:	  2BDF	F0				movx	@dptr, a
 2195:	  2BE0	A3				inc	dptr
 2196:	  2BE1	08				inc	r0
 2197:	  2BE2	B8 51 F4			cjne	r0, #81, prtstatus1
 2198:
 2199:	  2BE5	90 8F 10			mov	dptr, #08000h + 24 * WIDTH * 2 + 8 * 2
 2200:	  2BE8	E5 2A				mov	a, baudidx
 2201:	  2BEA	23				rl	a				;mul2
 2202:	  2BEB	23				rl	a				;mul4
 2203:	  2BEC	04				inc	a
 2204:	  2BED	F8				mov	r0, a
 2205:	  2BEE	79 00				mov	r1, #0
 2206:	  2BF0	71 BE		prtbaud:	call	getbdtxt
 2207:	  2BF2	F0				movx	@dptr, a
 2208:	  2BF3	A3				inc	dptr
 2209:	  2BF4	A3				inc	dptr
 2210:	  2BF5	08				inc	r0
 2211:	  2BF6	E8				mov	a, r0
 2212:	  2BF7	09				inc	r1
 2213:	  2BF8	B9 04 F5			cjne	r1, #4, prtbaud
 2214:
 2215:	  2BFB	74 FB				mov	a, #251				;Haken

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 42



 Line  I  Addr  Code            Source

 2216:	  2BFD	30 12 04			jnb	newlinemode, prtstatus2
 2217:	  2C00	90 8F 34			mov	dptr, #08000h + 24 * WIDTH * 2 + 26 * 2
 2218:	  2C03	F0				movx	@dptr, a
 2219:	  2C04	30 13 04	prtstatus2:	jnb	insert	, prtstatus3
 2220:	  2C07	90 8F 4C			mov	dptr, #08000h + 24 * WIDTH * 2 + 38 * 2
 2221:	  2C0A	F0				movx	@dptr, a
 2222:	  2C0B	30 11 04	prtstatus3:	jnb	origin, prtstatus4
 2223:	  2C0E	90 8F 64			mov	dptr, #08000h + 24 * WIDTH * 2 + 50 * 2
 2224:	  2C11	F0				movx	@dptr, a
 2225:	  2C12	30 10 04	prtstatus4:	jnb	wrap, prtstatus5
 2226:	  2C15	90 8F 78			mov	dptr, #08000h + 24 * WIDTH * 2 + 60 * 2
 2227:	  2C18	F0				movx	@dptr, a
 2228:	  2C19	22		prtstatus5:	ret
 2229:
 2230:	  2C1A	E8		getstatus:	mov	a, r0
 2231:	  2C1B	83				movc	a, @a + pc
 2232:	  2C1C	22				ret
 2233:				;			"0         1         2         3         4         5         6         7
				     "
 2234:				;			"012345678901234567890123456789012345678901234567890123456789012345678901234
				56789
 2235:	  2C1D	7C 20 42 61	status:		db	"| Baud:     00 | Newline: - | Insert: - | Origin: - | Wrap: - |     VT102
	  2C21	75 64 3A 20	    |"
	  2C25	20 20 20 20
	  2C29	30 30 20 7C
	  2C2D	20 4E 65 77
	  2C31	6C 69 6E 65
	  2C35	3A 20 2D 20
	  2C39	7C 20 49 6E
	  2C3D	73 65 72 74
	  2C41	3A 20 2D 20
	  2C45	7C 20 4F 72
	  2C49	69 67 69 6E
	  2C4D	3A 20 2D 20
	  2C51	7C 20 57 72
	  2C55	61 70 3A 20
	  2C59	2D 20 7C 20
	  2C5D	20 20 20 20
	  2C61	56 54 31 30
	  2C65	32 20 20 20
	  2C69	20 20 20 7C
 2236:						END





                     register banks used:  0

                     no errors




ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 43





	       L I S T   O F   S Y M B O L S
	       =============================


SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
??ASEM_51			  NUMBER    8051
??VERSION			  NUMBER    0130
AC				  BIT	      D6	 102
ACC				  DATA	      E0	  44
ALR				  NUMBER    0011	 195
ALTGR				  NUMBER    0011	 194
ALTGR_TABLE			  CODE	    2B8D	2122
ALTGR_TABLE_IND			  CODE	    2B82	2108
ANSIOUT				  CODE	    21E4	 504
ANSIOUT1			  CODE	    21EC	 510
ANSIOUT2			  CODE	    21F3	 514
ANSI_MOVE			  CODE	    26BD	1264
ANSI_MOVE_EX			  CODE	    270F	1327
ANSI_MOVE_M1			  CODE	    26E4	1293
ANSI_MOVE_X1			  CODE	    26CA	1278
ANSI_MOVE_X3			  CODE	    26D1	1281
ANSI_MOVE_Y			  CODE	    26E9	1301
ANSI_MOVE_Y1			  CODE	    26F8	1311
ANSI_MOVE_Y2			  CODE	    26F4	1306
ANSI_MOVE_Y3			  CODE	    2702	1317
ANSI_TAB			  CODE	    21F7	 518
ARG0				  NUMBER    0026	 244
ARG1				  NUMBER    0027	 245
ARG2				  NUMBER    0028	 246
ARG3				  NUMBER    0029	 247
ARGS_GR_ZERO			  CODE	    26A9	1247
ARGS_GR_ZERO_1			  CODE	    26B5	1253
ARGS_GR_ZERO_2			  CODE	    26B1	1251
AUXR				  DATA	      8E	  27
AUXR1				  DATA	      A2	  32
B				  DATA	      F0	  45
BACK				  NUMBER    0008	 167
BAUDIDX				  NUMBER    002A	 248
BLACK				  NUMBER    0000	 132
BLUE				  NUMBER    0004	 136
BOTTOM				  NUMBER    0032	 256
BREAK				  NUMBER    00F0	 202
CCAPS				  NUMBER    0058	 199
CCBT				  NUMBER    001D	 160
CCDN				  NUMBER    001D	 172
CCHM				  NUMBER    001C	 159
CCLF				  NUMBER    001E	 173
CCLM				  NUMBER    001E	 161
CCRM				  NUMBER    001F	 162
CCRT				  NUMBER    001F	 174
CCUP				  NUMBER    001C	 171
CDCH				  NUMBER    00FE	 177
CHARTABLE_NOSHIFT		  CODE	    2A5A	2076
CHARTABLE_SHIFT			  CODE	    2AEF	2092
CHAR_OUT			  CODE	    228E	 617

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 44



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
CHAR_OUT_1			  CODE	    22EF	 678
CHAR_OUT_2			  CODE	    22C7	 655
CHAR_OUT_2A			  CODE	    22D5	 663
CHAR_OUT_2B			  CODE	    22DD	 667
CHAR_OUT_3			  CODE	    22A4	 629
CHAR_OUT_4			  CODE	    22E4	 671
CICH				  NUMBER    00FF	 178
CILN				  NUMBER    009D	 176
CIN				  CODE	    296E	1893
CIN_1				  CODE	    2977	1897
CIN_2				  CODE	    2970	1894
CIN_3				  CODE	    2982	1903
CIN_4				  CODE	    2994	1921
CIN_5				  CODE	    2987	1911
CIN_7				  CODE	    298F	1916
CLEARARGS			  CODE	    278D	1428
CLEARARGS1			  CODE	    2791	1430
CLEARTABU			  CODE	    2765	1395
CLEARTABU1			  CODE	    2769	1397
CLEAR_LINES			  CODE	    2835	1590
CLEAR_LINES1			  CODE	    2856	1617
CLEAR_LINES2			  CODE	    2851	1615
CLEAR_SCREEN			  CODE	    2828	1581
CLEAR_V1			  CODE	    2751	1379
CLEAR_VARS			  CODE	    274D	1377
CLS				  NUMBER    0001	 166
CLSHIFT				  NUMBER    0012	 196
CLSTRG				  NUMBER    0014	 197
COLOR				  NUMBER    002D	 251
COMP_DPTR			  CODE	    28AC	1699
COPYFONT			  CODE	    290B	1811
COPYFONT1			  CODE	    2915	1817
COUT				  CODE	    295E	1882
COUT_X				  CODE	    2966	1888
CPRL2				  BIT	      C8	  89
CRSHIFT				  NUMBER    0059	 198
CSPACE				  NUMBER    0020	 175
CT2				  BIT	      C9	  90
CURSORPOS			  NUMBER    002E	 252
CURSORPOS1			  NUMBER    002F	 253
CURSORSAVE			  NUMBER    0030	 254
CURSORX				  NUMBER    0037	 261
CURSORY				  NUMBER    0038	 262
CURSOR_OFF			  CODE	    2889	1666
CURSOR_ON			  CODE	    2877	1646
CY				  BIT	      D7	 103
C_BACKSP			  NUMBER    0008	 146
C_BELL				  NUMBER    0007	 145
C_CR				  NUMBER    000D	 151
C_DEL				  NUMBER    007F	 157
C_ESC				  NUMBER    001B	 156
C_FF				  NUMBER    000C	 150
C_NEWLINE			  NUMBER    000A	 148
C_SI				  NUMBER    000F	 153
C_SO				  NUMBER    000E	 152
C_TAB				  NUMBER    0009	 147

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 45



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
C_TIME				  NUMBER    000A	 143
C_VT				  NUMBER    000B	 149
C_XOFF				  NUMBER    0013	 155
C_XON				  NUMBER    0011	 154
DECANM				  NUMBER    0002	 206
DECARM				  NUMBER    0008	 212
DECAWM				  NUMBER    0007	 211
DECCKM				  NUMBER    0001	 205
DECCOLM				  NUMBER    0003	 207
DECINLM				  NUMBER    0009	 213
DECOM				  NUMBER    0006	 210
DECSCLM				  NUMBER    0004	 208
DECSCNM				  NUMBER    0005	 209
DEFAULTCOLOR			  NUMBER    0070	 141
DEFCOL				  NUMBER    003D	 267
DO_CMD_ARG			  CODE	    2680	1212
DO_CMD_ARG_1			  CODE	    2695	1228
DO_CMD_ARG_2			  CODE	    269B	1235
DO_CMD_ARG_3			  CODE	    26A2	1238
DO_CMD_ARG_4			  CODE	    26A7	1240
DO_CR				  CODE	    2259	 579
DO_CSI				  CODE	    2362	 751
DO_CSI_B			  CODE	    2382	 771
DO_CSI_C			  CODE	    238B	 777
DO_CSI_CC			  CODE	    248A	 908
DO_CSI_CC1			  CODE	    248F	 910
DO_CSI_CC2			  CODE	    248D	 909
DO_CSI_D			  CODE	    2394	 783
DO_CSI_END			  CODE	    261A	1116
DO_CSI_END1			  CODE	    2549	1005
DO_CSI_G			  CODE	    254B	1007
DO_CSI_G1			  CODE	    2555	1011
DO_CSI_H			  CODE	    23A0	 792
DO_CSI_H1			  CODE	    23A5	 794
DO_CSI_H2			  CODE	    23A8	 795
DO_CSI_HH			  CODE	    25B3	1059
DO_CSI_HH1			  CODE	    25C4	1067
DO_CSI_HH2			  CODE	    25C9	1069
DO_CSI_HHX			  CODE	    25CE	1071
DO_CSI_J			  CODE	    24E0	 953
DO_CSI_JA			  CODE	    24E5	 955
DO_CSI_JB			  CODE	    24F7	 965
DO_CSI_JC			  CODE	    24E8	 956
DO_CSI_JD			  CODE	    2508	 974
DO_CSI_K			  CODE	    251F	 986
DO_CSI_KA			  CODE	    2534	 996
DO_CSI_KB			  CODE	    253F	1001
DO_CSI_KEYS			  CODE	    236F	 758
DO_CSI_L			  CODE	    255E	1018
DO_CSI_L1			  CODE	    2571	1026
DO_CSI_L2			  CODE	    2576	1028
DO_CSI_LL			  CODE	    25D2	1075
DO_CSI_LL1			  CODE	    25DD	1080
DO_CSI_LL2			  CODE	    25E2	1082
DO_CSI_LLX			  CODE	    25E7	1084
DO_CSI_M			  CODE	    23CB	 817

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 46



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
DO_CSI_MA			  CODE	    23D9	 823
DO_CSI_MB			  CODE	    23E9	 830
DO_CSI_MC			  CODE	    23DB	 824
DO_CSI_MD			  CODE	    23E6	 829
DO_CSI_ME			  CODE	    23ED	 832
DO_CSI_MF			  CODE	    23F0	 833
DO_CSI_MG			  CODE	    23FF	 842
DO_CSI_MH			  CODE	    2406	 845
DO_CSI_MM			  CODE	    2585	1037
DO_CSI_MM1			  CODE	    2598	1045
DO_CSI_MM2			  CODE	    259F	1048
DO_CSI_MX			  CODE	    2417	 854
DO_CSI_MX1			  CODE	    241C	 856
DO_CSI_MX2			  CODE	    2429	 862
DO_CSI_MX3			  CODE	    2434	 867
DO_CSI_N			  CODE	    2438	 871
DO_CSI_N1			  CODE	    2442	 875
DO_CSI_N6			  CODE	    244E	 881
DO_CSI_P			  CODE	    25EB	1088
DO_CSI_P1			  CODE	    2606	1103
DO_CSI_P2			  CODE	    25F2	1091
DO_CSI_Q			  CODE	    261B	1135
DO_CSI_QUES			  CODE	    2518	 982
DO_CSI_Q_END			  CODE	    2663	1170
DO_CSI_Q_H			  CODE	    2627	1141
DO_CSI_Q_H1			  CODE	    2638	1149
DO_CSI_Q_H2			  CODE	    263D	1151
DO_CSI_Q_HX			  CODE	    2644	1154
DO_CSI_Q_L			  CODE	    2648	1158
DO_CSI_Q_L1			  CODE	    2654	1163
DO_CSI_Q_L2			  CODE	    2659	1165
DO_CSI_Q_LX			  CODE	    2660	1168
DO_CSI_R			  CODE	    249A	 917
DO_CSI_RA			  CODE	    24A9	 923
DO_CSI_RB			  CODE	    24BA	 930
DO_CSI_RC			  CODE	    24D1	 943
DO_CSI_RD			  CODE	    24DE	 950
DO_CSI_RE			  CODE	    24CE	 940
DO_CSI_S			  CODE	    23B6	 805
DO_CSI_U			  CODE	    23C0	 811
DO_ESC				  CODE	    2302	 693
DO_ESC_7			  CODE	    2312	 701
DO_ESC_8			  CODE	    231C	 706
DO_ESC_C			  CODE	    234D	 733
DO_ESC_CSI			  CODE	    230B	 697
DO_ESC_D			  CODE	    2328	 711
DO_ESC_EX			  CODE	    2361	 746
DO_ESC_H			  CODE	    2352	 736
DO_ESC_HA			  CODE	    2338	 721
DO_ESC_HASH			  CODE	    2668	1183
DO_ESC_HASH_END			  CODE	    2673	1189
DO_ESC_LBR			  CODE	    233F	 725
DO_ESC_LBRACK			  CODE	    2674	1200
DO_ESC_LB_1			  CODE	    267D	1205
DO_ESC_M			  CODE	    2330	 716
DO_ESC_Q			  CODE	    2664	1176

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 47



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
DO_ESC_RBR			  CODE	    2346	 729
DO_ESC_RBRACK			  CODE	    2674	1196
DO_ESC_Z			  CODE	    235C	 743
DO_IDLE				  CODE	    2209	 525
DO_IDLE_BS			  CODE	    2222	 544
DO_IDLE_CR			  CODE	    2256	 578
DO_IDLE_DEL			  CODE	    2213	 534
DO_IDLE_END			  CODE	    2280	 602
DO_IDLE_ESC			  CODE	    2262	 584
DO_IDLE_FF			  CODE	    227B	 599
DO_IDLE_NL			  CODE	    224C	 572
DO_IDLE_PRE			  CODE	    2219	 538
DO_IDLE_SI			  CODE	    2270	 592
DO_IDLE_SO			  CODE	    226A	 588
DO_IDLE_TAB			  CODE	    2228	 548
DO_IDLE_TAB1			  CODE	    2242	 563
DO_IDLE_TAB2			  CODE	    2247	 566
DO_IDLE_TAB3			  CODE	    222D	 550
DO_IDLE_VT			  CODE	    2276	 596
DO_NEWLINE			  CODE	    224F	 573
DP0H				  DATA	      83	  17
DP0L				  DATA	      82	  16
DP1H				  DATA	      85	  19
DP1L				  DATA	      84	  18
DPH				  NUMBER    0083	 116
DPL				  NUMBER    0082	 117
DRAW_CHAR			  CODE	    2280	 606
DRAW_CHAR_1			  CODE	    22F9	 685
DRAW_CURSOR			  CODE	    2869	1634
EA				  BIT	      AF	  74
ES				  BIT	      AC	  72
ESC				  NUMBER    001B	 170
ET0				  BIT	      A9	  69
ET1				  BIT	      AB	  71
ET2				  BIT	      AD	  73
EX0				  BIT	      A8	  68
EX1				  BIT	      AA	  70
EXEN2				  BIT	      CB	  92
EXF2				  BIT	      CE	  95
EXINT0				  CODE	    2079	 356
EXINT0A				  CODE	    209A	 373
EXINT0B				  CODE	    2084	 363
EXINT0EX			  CODE	    20A1	 378
EXTENDED			  NUMBER    00E0	 201
EXTI0				  CODE	    0003	 106
EXTI1				  CODE	    0013	 108
EXT_TABLE			  CODE	    2BA8	2152
EXT_TABLE_IND			  CODE	    2B98	2135
F0				  BIT	      D5	 101
F1				  NUMBER    0080	 180
F10				  NUMBER    0089	 189
F11				  NUMBER    008A	 190
F12				  NUMBER    008B	 191
F2				  NUMBER    0081	 181
F3				  NUMBER    0082	 182
F4				  NUMBER    0083	 183

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 48



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
F5				  NUMBER    0084	 184
F6				  NUMBER    0085	 185
F7				  NUMBER    0086	 186
F8				  NUMBER    0087	 187
F9				  NUMBER    0088	 188
FILL_LINES			  CODE	    2837	1592
FILL_SCREEN			  CODE	    282A	1582
FLAGS				  NUMBER    0020	 220
FLAGS1				  NUMBER    0021	 228
FLAGS2				  NUMBER    0022	 236
FREE0				  NUMBER    005A	 273
FREE1				  NUMBER    005B	 274
FREE2				  NUMBER    005C	 275
FREE3				  NUMBER    005D	 276
FREE4				  NUMBER    005E	 277
FREE5				  NUMBER    005F	 278
GETBAUD				  CODE	    2BB5	2168
GETBDTXT			  CODE	    2BBE	2178
GETBIT				  CODE	    2781	1421
GETBITTAB			  CODE	    2785	1425
GETREPORT			  CODE	    247D	 903
GETSTATUS			  CODE	    2C1A	2230
GREEN				  NUMBER    0002	 134
HARDWARE			  NUMBER    0001	 113
HEIGHT				  NUMBER    0018	 120
HEX2DEZ				  CODE	    289F	1686
IE				  DATA	      A8	  34
IE0				  BIT	      89	  48
IE1				  BIT	      8B	  50
INIT				  CODE	    2157	 424
INIT6845			  CODE	    28C0	1719
INIT_1				  CODE	    2177	 441
INIT_2				  CODE	    2182	 448
INIT_LOOP			  CODE	    216F	 437
INSERT				  NUMBER    0013	 240
INT0				  BIT	      B2	  77
INT1				  BIT	      B3	  78
INVERSE				  NUMBER    0003	 224
IP				  DATA	      B8	  36
IRM				  NUMBER    0004	 214
ISDIGIT				  CODE	    271E	1345
ISDIGIT1			  CODE	    2721	1346
ISDIGIT2			  CODE	    2725	1349
ISDIGIT3			  CODE	    2728	1350
ISPARM				  CODE	    2713	1334
ISPARM1				  CODE	    271C	1339
ISPARMEX			  CODE	    271B	1338
IT0				  BIT	      88	  47
IT1				  BIT	      8A	  49
KEYALTGR			  CODE	    2A31	2047
KEYALTGR1			  CODE	    2A41	2053
KEYALTGR2			  CODE	    2A36	2049
KEYAVAIL			  NUMBER    0008	 229
KEYBREAK			  CODE	    29D4	1999
KEYCHECKBRK			  CODE	    29FB	2021
KEYCHECKBRK1			  CODE	    2A05	2025

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 49



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
KEYDECODE			  CODE	    29CC	1991
KEYEXIT				  CODE	    2A52	2068
KEYEXITOK			  CODE	    2A4E	2061
KEYGETALTGR			  CODE	    2B8A	2119
KEYGETALTGRIND			  CODE	    2B7F	2105
KEYGETEXT			  CODE	    2BA5	2149
KEYGETEXTIND			  CODE	    2B95	2132
KEYGETNOSHIFT			  CODE	    2A55	2072
KEYGETSHIFT			  CODE	    2AEA	2088
KEYMAKE				  CODE	    2A45	2056
KEYMAKEEXT			  CODE	    2A14	2034
KEYMAKEEXT1			  CODE	    2A2D	2044
KEYMAKEEXT2			  CODE	    2A1B	2037
KEYMAKEEXT3			  CODE	    2A2B	2043
KEYNORMAL			  CODE	    2A0A	2029
KEYRXALTGR			  NUMBER    000C	 233
KEYRXBREAK			  NUMBER    000A	 231
KEYRXCNT			  NUMBER    003A	 264
KEYRXEXTENDED			  NUMBER    0009	 230
KEYRXSHIFT			  NUMBER    000B	 232
KEYRXSTRG			  NUMBER    000D	 234
KEYRXVAL			  NUMBER    003B	 265
KEYSHIFT			  CODE	    29DC	2004
KEYSHIFT1			  CODE	    29E3	2007
KEYSHIFT2			  CODE	    29E8	2009
KEYSTRG				  CODE	    29EF	2014
LASTCHAR			  NUMBER    0001	 222
LCHARTMP			  NUMBER    0002	 223
LF				  NUMBER    000A	 169
LNM				  NUMBER    0014	 215
LOCAT				  NUMBER    2100	 384
LOOP_CIN			  CODE	    21D0	 490
LOOP_TEST			  CODE	    217A	 443
MAGENTA				  NUMBER    0005	 137
MAIN_COUT			  CODE	    21BB	 480
MAIN_F6				  CODE	    2192	 459
MAIN_F6A			  CODE	    219D	 464
MAIN_F7				  CODE	    21AC	 472
MAIN_LOOP			  CODE	    2186	 454
MAIN_SERIN			  CODE	    21C9	 486
MAIN_STATUS			  CODE	    21DF	 497
MISO				  BIT	      96	  58
MOSI				  BIT	      95	  57
MOVE_CURSOR			  CODE	    2866	1633
NARGS				  NUMBER    0025	 243
NEWLINE				  CODE	    2954	1875
NEWLINEMODE			  NUMBER    0012	 239
OLDSTATUS			  NUMBER    003C	 266
ORIGIN				  NUMBER    0011	 238
OV				  BIT	      D2	  98
P				  BIT	      D0	  97
P0				  DATA	      80	  14
P1				  DATA	      90	  28
P2				  DATA	      A0	  31
P3				  DATA	      B0	  35
PCON				  DATA	      87	  20

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 50



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
PHEX				  CODE	    2999	1934
PHEX1				  CODE	    299C	1938
PHEX16				  CODE	    29AB	1948
PHEX8				  CODE	    2999	1935
PHEX_B				  CODE	    299B	1937
PRINT				  CODE	    2797	1436
PRINT1				  CODE	    279C	1440
PRTBAUD				  CODE	    2BF0	2206
PRTSTATUS			  CODE	    2BD4	2188
PRTSTATUS1			  CODE	    2BD9	2190
PRTSTATUS2			  CODE	    2C04	2219
PRTSTATUS3			  CODE	    2C0B	2222
PRTSTATUS4			  CODE	    2C12	2225
PRTSTATUS5			  CODE	    2C19	2228
PS				  BIT	      BC	  87
PSTR				  CODE	    29B8	1962
PSTR1				  CODE	    29BA	1963
PSTR2				  CODE	    29C9	1972
PSW				  DATA	      D0	  43
PT0				  BIT	      B9	  84
PT1				  BIT	      BB	  86
PT2				  BIT	      BD	  88
PX0				  BIT	      B8	  83
PX1				  BIT	      BA	  85
RB8				  BIT	      9A	  62
RCAP2H				  DATA	      CB	  40
RCAP2L				  DATA	      CA	  39
RCLK				  BIT	      CD	  94
RD				  BIT	      B7	  82
RED				  NUMBER    0001	 133
REN				  BIT	      9C	  64
REPORTDA			  CODE	    2483	 906
REPORTOK			  CODE	    247F	 905
RESET				  CODE	    0000	 105
RESETTABU			  CODE	    2757	1385
RESETTABU1			  CODE	    275B	1387
RETSTATE			  NUMBER    0023	 242
RI				  BIT	      98	  60
RS0				  BIT	      D3	  99
RS1				  BIT	      D4	 100
RXD				  BIT	      B0	  75
SBUF				  DATA	      99	  30
SCK				  BIT	      97	  59
SCON				  DATA	      98	  29
SCROLL				  CODE	    27A1	1461
SCROLL_DOWN_1			  CODE	    27CE	1497
SCROLL_DOWN_2			  CODE	    27DC	1507
SCROLL_DOWN_3			  CODE	    27E4	1512
SCROLL_DOWN_4			  CODE	    27CC	1495
SCROLL_DOWN_5			  CODE	    27EE	1523
SCROLL_DOWN_6			  CODE	    27EB	1520
SCROLL_R4			  CODE	    27A7	1465
SCROLL_UP			  CODE	    27F3	1530
SCROLL_UP_1			  CODE	    2810	1549
SCROLL_UP_2			  CODE	    2812	1552
SCROLL_UP_3			  CODE	    2823	1565

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 51



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
SCROLL_UP_4			  CODE	    2820	1562
SCURSORX			  NUMBER    002B	 249
SCURSORY			  NUMBER    002C	 250
SENDPOS				  CODE	    2471	 896
SERBUF				  NUMBER    0040	 269
SERBUSY				  NUMBER    0005	 226
SERCOUNT			  NUMBER    0036	 260
SEREND				  NUMBER    0035	 259
SERINT				  CODE	    2023	 293
SERINT1				  CODE	    2038	 305
SERINTEX			  CODE	    2055	 320
SERINTTI			  CODE	    204E	 316
SERSTART			  NUMBER    0034	 258
SETREGS				  CODE	    28D0	1729
SINT				  CODE	    0023	 110
SM0				  BIT	      9F	  67
SM1				  BIT	      9E	  66
SM2				  BIT	      9D	  65
SP				  DATA	      81	  15
SPACE				  CODE	    294A	1869
SPECIAL				  NUMBER    0000	 221
STACK				  NUMBER    0080	 115
START				  CODE	    2140	 401
STATE				  NUMBER    0033	 257
STATUS				  CODE	    2C1D	2235
ST_CMD_ARG			  NUMBER    000A	 127
ST_CSI				  NUMBER    0004	 124
ST_CSI_Q			  NUMBER    000E	 129
ST_ESC				  NUMBER    0002	 123
ST_ESC_HASH			  NUMBER    0008	 126
ST_ESC_LBRACK			  NUMBER    000C	 128
ST_ESC_Q			  NUMBER    0006	 125
ST_ESC_RBRACK			  NUMBER    0010	 130
ST_IDLE				  NUMBER    0000	 122
SYDATA				  CODE	    28F7	1787
T0				  BIT	      B4	  79
T0CNT				  NUMBER    0039	 263
T1				  BIT	      B5	  80
T2				  BIT	      90	  55
T2CON				  DATA	      C8	  37
T2EX				  BIT	      91	  56
T2MOD				  DATA	      C9	  38
TABU				  NUMBER    0009	 168
TABUTAB				  NUMBER    0050	 271
TAB_SET_R0_R1			  CODE	    2771	1408
TB8				  BIT	      9B	  63
TCLK				  BIT	      CC	  93
TCON				  DATA	      88	  21
TERM_RESET			  CODE	    2729	1357
TESTSCREEN			  CODE	    2924	1837
TESTSCREEN1			  CODE	    292D	1842
TESTSCREEN2			  CODE	    293A	1854
TESTSCREEN3			  CODE	    2929	1840
TESTSCREEN4			  CODE	    293E	1857
TF0				  BIT	      8D	  52
TF1				  BIT	      8F	  54

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 52



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
TF2				  BIT	      CF	  96
TH0				  DATA	      8C	  25
TH1				  DATA	      8D	  26
TH2				  DATA	      CD	  42
TI				  BIT	      99	  61
TIMER0				  CODE	    000B	 107
TIMER0INT			  CODE	    205C	 330
TIMER0INT_EX			  CODE	    2078	 346
TIMER1				  CODE	    001B	 109
TIMER2				  CODE	    002B	 111
TL0				  DATA	      8A	  23
TL1				  DATA	      8B	  24
TL2				  DATA	      CC	  41
TMOD				  DATA	      89	  22
TOP				  NUMBER    0031	 255
TR0				  BIT	      8C	  51
TR1				  BIT	      8E	  53
TR2				  BIT	      CA	  91
TURQUOISE			  NUMBER    0006	 138
TXD				  BIT	      B1	  76
VARS				  NUMBER    0020	 218
WDTRST				  DATA	      A6	  33
WHITE				  NUMBER    0007	 139
WIDTH				  NUMBER    0050	 119
WR				  BIT	      B6	  81
WRAP				  NUMBER    0010	 237
XONOFF				  NUMBER    0004	 225
YELLOW				  NUMBER    0003	 135
